!function(){"use strict";var a={paths:{checkbox:"plugins/checkbox",radio:"plugins/radio",timeinputer:"plugins/timeinputer",placeholder:"plugins/placeholder",submitter:"plugins/submitter",msg:"plugins/msg",validate:"plugins/validate",jquery:"//libs.baidu.com/jquery/1.11.1/jquery.min",underscore:"//libs.baidu.com/underscore/1.6.0/underscore",bootstrap:"//libs.baidu.com/bootstrap/3.2.0/js/bootstrap.min",ZeroClipboard:"ZeroClipboard.min",datepicker:"bootstrap-datepicker.min",ueditorConfig:"../ueditor/ueditor.config",ueditor:"../ueditor/ueditor.all.min"}};a.paths["echarts/chart/line"]="echarts",a.paths["echarts/chart/bar"]="echarts",a.paths["echarts/chart/pie"]="echarts",require.config(a),require(["jquery","underscore"],function(a){require(["welife","bootstrap","checkbox","radio","timeinputer","placeholder","submitter","msg","validate"],function(b){a(function(){var c=a(".main");c.data("welife",new b(c[0],c.data("module")))})})})}(),define("welife",["jquery"],function(a){"use strict";var b=function(c,d){this.$element=b.$main=a(c),this.options=a.isPlainObject(d)?d:{},this.init()},c=a("body");return window.console||(window.console={log:a.noop}),b.DEFAULTS={name:"WeLife",version:"0.0.1"},b.MESSAGES={loading:"正在加载……",keyword:"请添加关键词",content:"内容不能为空",error:{loading:"加载失败"}},a.extend(b.DEFAULTS,window._pageConfig||{}),b.prototype={constructor:b,init:function(){var b=this,c=this.$element.data("module");return c?(this.setup(),this.initNavbar(c),this.initPagination(),console.log(c+" is loading..."),c=this.parse(c),void(c&&require([c,"modules/utilities"],function(d){a.isFunction(d)&&(b.Controller=d,b.controller=new d,console.log(c+" is running..."))}))):void console.log("No dependency.")},parse:function(a){switch(a){case"news":case"news/text":case"activity":case"sms/record":case"sms/balance":case"sms/recharge-success":case"template/intro":case"template/help":case"cardset/view":a=null;break;case"activity/all":case"activity/new":case"activity/old":case"activity/active":case"activity/silent":a="activity/opened";break;case"activity/birthday":a="activity/perfect";break;case"activity/spend":a="activity/total";break;case"recharge":a="recharge/set";break;case"point":a="point/set";break;case"statistic/trade-point":case"statistic/trade-recharge":a="statistic/trade-spend";break;case"statistic/recharge-detail":a="statistic/recharge-settle"}return a},setup:function(){var d=window.location.host;("localhost"===d||"welife.com"===d)&&(console.log("No cache!"),a.ajaxSetup({cache:!1})),a.fn.submitter.setDefaults({ajaxOptions:{type:"post",cache:!1,dataType:"json"},messages:{start:"提交开始",done:"提交成功",fail:"提交失败",end:"提交结束"},fail:function(){b.msg("网络连接超时或服务器没有响应，请稍候再试",5)}}),c.msg({toggle:!1}),b.msg=function(a,b,d){"hide"===a?c.msg("hide",b,d):"string"==typeof a&&""!==a&&c.msg("show",a,b,d)}},initNavbar:function(b){var c=b.split("/"),d=c.length>0?c[0]:!1,e=c.length>1?c.slice(0,2).join("/"):!1;if(d){switch(d){case"coupon":d="activity";break;case"material":case"sms":d="message";break;case"account":case"cardset":case"autoreply":case"code2d":case"template":case"wechat":d="setting"}switch(e){case"message/list":e="message/add";break;case"material/add":e="material/list";break;case"sms/list":e="sms/add";break;case"sms/record":case"sms/balance":case"sms/invoice":case"sms/recharge-success":e="sms/recharge";break;case"statistic/member":case"statistic/spend":case"statistic/recharge":e="statistic/common";break;case"statistic/activity":e="statistic/market";break;case"statistic/trade-spend":case"statistic/trade-point":case"statistic/trade-recharge":case"statistic/recharge-settle":case"statistic/recharge-detail":e="statistic/trade";break;case"account/add":e="account/list";break;case"cardset/set":e="cardset/view";break;case"autoreply/add":e="autoreply/list";break;case"code2d/add":case"code2d/detail":e="code2d/list";break;case"template/set":case"template/help":e="template/intro"}this.$element.find(".sidebar > .nav > li").each(function(){var b,c=a(this),f=c.data("module"),g=!1;!g&&e&&(b=c.find("[data-module='"+e+"']"),b.length&&(g=!0,c.addClass("open").find(".collapse").addClass("in"),b.addClass("active"))),g||d!==f||c.addClass("active"),c.click(function(){c.toggleClass("open")})})}},initPagination:function(){var a=this.$element.find(".we-pagination-group form"),b=a.find("input[name='page']"),c=function(){var a=parseInt(b.val(),10)||0,c=!1;return a>0?c=!0:a="",b.val(a),c};b.on("change keyup",c),a.submit(function(a){return c()?void 0:(a.preventDefault(),!1)})}},b}),function(a){"function"==typeof define&&define.amd?define("checkbox",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.defaults=a.extend({},b.defaults,a.isPlainObject(d)?d:{}),this.$checkbox=this.$element.find(":checkbox"),this.init(),this.defaults.toggle&&this.toggle()};b.defaults={toggle:!0},b.prototype={constructor:b,init:function(){var a=this.$element,b=this.$checkbox;a.hasClass("checked")&&b.prop("checked",!0)},check:function(){var b,c=this.$element;c.hasClass("disabled")||c.hasClass("readonly")||c.hasClass("checked")||(b=a.Event("check.we.checkbox"),c.trigger(b),b.isDefaultPrevented()||(c.addClass("checked"),this.$checkbox.prop("checked",!0),c.trigger("checked.we.checkbox").trigger("change.we.checkbox")))},uncheck:function(){var b,c=this.$element;c.hasClass("disabled")||c.hasClass("readonly")||!c.hasClass("checked")||(b=a.Event("uncheck.we.checkbox"),c.trigger(b),b.isDefaultPrevented()||(c.removeClass("checked"),this.$checkbox.prop("checked",!1),c.trigger("unchecked.we.checkbox").trigger("change.we.checkbox")))},toggle:function(){this.$element.hasClass("checked")?this.uncheck():this.check()},enable:function(){this.$element.removeClass("disabled"),this.$checkbox.prop("disabled",!1)},disable:function(){this.$element.addClass("disabled"),this.$checkbox.prop("disabled",!0)}},a.fn.checkbox=function(c){return this.each(function(){var d=a(this),e=d.data("we.checkbox");e||d.data("we.checkbox",e=new b(this,c)),"string"==typeof c&&a.isFunction(e[c])&&e[c]()})},a.fn.checkbox.Constructor=b,a(document).on("click.we.checkbox","[data-toggle='checkbox']",function(b){var c=a(this),d=c.data();b.target===this&&c.is("label")&&b.preventDefault(),d=c.data("we.checkbox")?"toggle":d,c.checkbox(d)})}),function(a){"function"==typeof define&&define.amd?define("msg",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.defaults=a.extend({},b.defaults,a.isPlainObject(d)?d:{}),this.$msg=a(b.template),this.$msg.appendTo("body"),this.defaults.toggle&&this.toggle()};b.defaults={toggle:!0,msg:"",duration:2e3,state:"default"},b.states=["default","primary","success","info","warning","danger"],b.template='<div class="we-msg fade"><span class="msg"></span></div>',b.prototype={constructor:b,show:function(c,d,e,f){var g,h=this.$msg,i=this.defaults;if(!this.transitioning&&!h.hasClass("in")&&(g=a.Event("show.we.msg"),this.$element.trigger(g),!g.isDefaultPrevented())){if(-1===a.inArray(d,b.states)&&(d=parseInt(d,10)||0,d=d>0&&6>d?b.states[d]:i.state),e&&(this.duration=e),h.show().get(0).offsetHeight,h.find(".msg").attr("class","msg "+d).text(c),this.transitioning=!0,!a.support.transition||f)return h.addClass("in"),void this.shown();h.one(a.support.transition.end,a.proxy(this.shown,this)).emulateTransitionEnd(150),h.addClass("in")}},shown:function(){this.transitioning=!1,this.$element.trigger("shown.we.msg"),setTimeout(a.proxy(this.hide,this),this.duration||this.defaults.duration||2e3)},hide:function(b){var c,d=this.$msg;if((!this.transitioning||d.hasClass("in"))&&(c=a.Event("hide.we.msg"),this.$element.trigger(c),!c.isDefaultPrevented())){if(this.transitioning=!0,!a.support.transition||b)return d.removeClass("in"),void this.hidden();d.one(a.support.transition.end,a.proxy(this.hidden,this)).emulateTransitionEnd(150),d.removeClass("in")}},hidden:function(){this.transitioning=!1,this.$msg.hide(),this.$element.trigger("hidden.we.msg")},toggle:function(){this.$msg.hasClass("in")?this.hide():this.show()}},a.fn.msg=function(c){var d=[].slice.call(arguments,1);return this.each(function(){var e=a(this),f=e.data("we.msg");f||e.data("we.msg",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&f[c].apply(f,d)})},a.fn.msg.constructor=b}),function(a){"function"==typeof define&&define.amd?define("placeholder",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=".placeholder",c="submit"+b,d=function(b){this.$element=a(b),this.placeholder=this.$element.attr("placeholder"),this.contenteditable="true"===this.$element.prop("contenteditable")?!0:!1,this.init()};d.prototype={constructor:d,support:{placeholder:"undefined"!=typeof a('<input type="text" placeholder="placeholder">').prop("placeholder")},init:function(){var a=this.$element;this.support.placeholder&&!this.contenteditable||!this.placeholder||(this.$form=a.closest("form"),this.addListener(),a.trigger("blur"))},addListener:function(){this.$element.on({focus:a.proxy(this.focus,this),blur:a.proxy(this.blur,this)}),this.$form.on(c,a.proxy(this.submit,this))},removeListener:function(){this.$element.off({focus:this.focus,blur:this.blur}),this.$form.off(c,this.submit)},submit:function(){var a=this.$element;a.val()===this.placeholder&&a.val("")},show:function(){var a=this.$element,b=this.placeholder;this.$element.addClass("placeholder"),this.contenteditable?a.text(b):a.val(b)},hide:function(){var a=this.$element;this.$element.removeClass("placeholder"),this.contenteditable?a.text(""):a.val("")},focus:function(){var b=this.$element,c=this.contenteditable?b.text():b.val();a.trim(c)===this.placeholder&&this.hide()},blur:function(){var b=this.$element,c=this.contenteditable?b.text():b.val();""===a.trim(c)&&this.show()},destory:function(){this.removeListener(),this.$element.data("placeholder",null)}},a.fn.placeholder=function(b){return this.each(function(){var c=a(this),e=c.data("placeholder");e||c.data("placeholder",e=new d(this,b)),"string"==typeof b&&a.isFunction(e[b])&&e[b]()})},a.fn.placeholder.Constructor=d,a(function(){a("input[placeholder],textarea[placeholder],[contenteditable][placeholder]").placeholder()})}),function(a){"function"==typeof define&&define.amd?define("radio",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=a("body"),c=function(b){this.$element=a(b),this.$radio=this.$element.find(":radio"),this.init()};c.prototype={constructor:c,init:function(){var a=this.$element,b=this.$radio;a.hasClass("checked")&&b.prop("checked",!0)},check:function(){var c,d=this.$element;d.hasClass("disabled")||d.hasClass("readonly")||d.hasClass("checked")||(c=a.Event("check.we.radio"),d.trigger(c),c.isDefaultPrevented()||(b.find("[data-name='"+d.attr("data-name")+"']").radio("uncheck"),d.addClass("checked"),this.$radio.prop("checked",!0),d.trigger("checked.we.radio").trigger("change.we.radio")))},uncheck:function(){var b,c=this.$element;c.hasClass("disabled")||c.hasClass("readonly")||!c.hasClass("checked")||(b=a.Event("uncheck.we.radio"),c.trigger(b),b.isDefaultPrevented()||(c.removeClass("checked"),this.$radio.prop("checked",!1),c.trigger("unchecked.we.radio").trigger("change.we.radio")))},enable:function(){this.$element.removeClass("disabled"),this.$radio.prop("disabled",!1)},disable:function(){this.$element.addClass("disabled"),this.$radio.prop("disabled",!0)}},a.fn.radio=function(b){return this.each(function(){var d=a(this),e=d.data("we.radio");e||d.data("we.radio",e=new c(this)),"string"==typeof b&&a.isFunction(e[b])&&e[b]()})},a.fn.radio.Constructor=c,a(document).on("click.we.radio","[data-toggle='radio']",function(b){b.target===this&&a(this).is("label")&&b.preventDefault(),a(this).radio("check")})}),function(a){"function"==typeof define&&define.amd?define("submitter",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){d=a.isPlainObject(d)?d:{},this.$form=a(c),this.defaults=a.extend(!0,{},b.defaults,d),this.init()};b.prototype={constructor:b,support:{formData:!!window.FormData},init:function(){var b,c,d,e=this.$form,f=this.defaults.ajaxOptions.url||this.defaults.url||e.attr("action")||"";f&&(this.action=this.url=f,c={type:e.attr("method")||"GET"},b={beforeSend:a.proxy(this.start,this),success:a.proxy(this.done,this),error:a.proxy(this.fail,this),complete:a.proxy(this.end,this)},this.ajaxOptions=a.extend({},c,this.defaults.ajaxOptions,b),this.defaults.async||this.initIframe(),e.find(":file").length>0&&!this.support.formData&&(this.defaults.async=!1,this.initIframe()),this.preSubmit=!1,this.preventSubmit=!1,this.defaults.resetAfterDone&&(d=e.find(":reset"),0===d.length&&(d=a('<button type="reset" style="display:none;">Reset</button>'),e.append(d)),this.$reset=d),this.formTarget=e.attr("target"),this.enable())},setDefaults:function(b){var c=this.defaults;a.isPlainObject(b)?a.extend(c,b):"string"==typeof b&&(c[b]=arguments[1])},enable:function(){this.$form.on("click",":submit",a.proxy(this.click,this)),this.$form.on("submit",a.proxy(this.submit,this))},disable:function(){this.$form.off("click",":submit",this.click),this.$form.off("submit",this.submit).attr("target",this.formTarget),this.$form=null,this.$iframe&&(this.$iframe.off("load").remove(),this.$iframe=null),this.$reset=null,this.ajaxOptions=null,this.defaults=null},click:function(b){var c=a(b.target).data(),d=c.submit?this.$form.data(c.submit):!1;this.preventSubmit="preview"===c.submit,"string"==typeof d&&""!==d?(this.url=d,this.$form.attr("action",this.url),this.preSubmit=!0):(this.url=this.action,this.$form.attr("action",this.url),this.preSubmit=!1)},submit:function(){return!this.defaults.isValidated()||this.preventSubmit?!1:(this.beforeStart(),this.defaults.async?(this.ajaxSubmit(),!1):void this.start(null))},beforeStart:function(){this.$form.find("input[placeholder],textarea[placeholder]").each(function(){var b=a(this);b.val()===b.attr("placeholder")&&b.val("")})},start:function(){this.$form.find(":submit").prop("disabled",!0),a.isFunction(this.defaults.start)&&this.defaults.start("submitStart"),a.isFunction(this.defaults.ajaxOptions.beforeSend)&&this.defaults.ajaxOptions.beforeSend(arguments)},done:function(b){a.isFunction(this.defaults.done)&&this.defaults.done(b,"submitSuccess"),a.isFunction(this.defaults.ajaxOptions.success)&&this.defaults.ajaxOptions.success(arguments),this.defaults.resetAfterDone&&this.$reset&&this.$reset.click()},fail:function(){a.isFunction(this.defaults.fail)&&this.defaults.fail("submitError"),a.isFunction(this.defaults.ajaxOptions.error)&&this.defaults.ajaxOptions.error(arguments)},end:function(){this.defaults.disableAfterDone||this.$form.find(":submit").prop("disabled",!1),a.isFunction(this.defaults.end)&&this.defaults.end("submitComplete"),a.isFunction(this.defaults.ajaxOptions.complete)&&this.defaults.ajaxOptions.complete(arguments),this.preSubmit&&(this.url=this.action,this.$form.attr("action",this.url),this.preSubmit=!1)},ajaxSubmit:function(){var b=a.extend({},this.ajaxOptions);this.support.formData?(b.data=new FormData(this.$form[0]),b.type="POST",b.processData=!1,b.contentType=!1):b.data=this.$form.serialize(),a.ajax(this.url,b)},initIframe:function(){var b="submitter-"+Math.random().toString().replace("0.",""),c=a('<iframe name="'+b+'" style="display:none;"></iframe>'),d=this;c.on("load",function(){var b,c,e;try{c=this.contentWindow,e=this.contentDocument,e=e?e:c.document,b=e?e.body.innerText:null,b="string"==typeof b?a.parseJSON(b):b}catch(f){d.fail(null,"submitError",f.message)}b&&(a.isPlainObject(b)?d.done(b,"submitSuccess",null):d.fail(null,"submitError","The response data must be JSON."),d.end(null,"submitComplete"))}),this.defaults.ajaxOptions.type&&this.$form.attr("method",this.defaults.ajaxOptions.type),this.$form.attr("target",b).after(c),this.$iframe=c}},b.defaults={async:!0,resetAfterDone:!1,disableAfterDone:!1,url:void 0,ajaxOptions:{dataType:"json"},messages:{start:"Submit start.",done:"Submit done.",fail:"Submit fail.",end:"Submit end."},isValidated:function(){return!0},start:function(){},done:function(){},fail:function(){},end:function(){}},b.setDefaults=function(c){a.extend(b.defaults,c)},a.fn.submitter=function(c){var d=[].slice.call(arguments,1);return this.each(function(){var e=a(this),f=e.data("submitter");f||e.data("submitter",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&f[c].apply(f,d)})},a.fn.submitter.Constructor=b,a.fn.submitter.setDefaults=b.setDefaults}),function(a){"function"==typeof define&&define.amd?define("timeinputer",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=/^\d{2}\:\d{2}$/,c=function(b,d){this.$element=a(b),this.defaults=a.extend({},c.DEFAULTS,a.isPlainObject(d)?d:{}),this.init()},d=function(a){return Math.abs(parseInt(a,10))},e=function(a){return 10>a?"0"+a:a};c.prototype={constructor:c,support:{timeInput:"time"===a('<input type="time">').prop("type")},init:function(){var b,d=this.$element;this.support.timeInput||(this.$inputer=b=a(c.TEMPLATE),d.hide().after(b),this.$hours=b.find("[data-input='hh']"),this.$minutes=b.find("[data-input='mm']"),this.$buttons=b.find("[data-input='+'],[data-input='-']"),this.$inputs=this.$hours.add(this.$minutes),this.activate(this.$hours,!0),this.inputing=null,this.valid=!1,this.addListeners(),this.initTime(),this.output())},initTime:function(){var a,c,f,g=this.defaults,h=g.time||this.$element.val();b.test(h)?(h=h.match(/\d{2}/g),c=d(h[0]),f=d(h[1]),!isNaN(c)&&!isNaN(f)&&24>c&&60>f&&(this.$hours.val(e(c)),this.$minutes.val(e(f)))):(a=new Date,this.$hours.val(e(a.getHours())),this.$minutes.val(e(a.getMinutes())))},addListeners:function(){this.$inputer.on({mousedown:a.proxy(this.mousedown,this),mouseup:a.proxy(this.mouseup,this)}),this.$inputs.on({keydown:a.proxy(this.keydown,this),keyup:a.proxy(this.keyup,this),blur:a.proxy(this.blur,this),paste:a.proxy(this.paste,this)}),this.$buttons.on({mouseout:a.proxy(this.mouseout,this)})},removeListeners:function(){this.$inputer.off({mousedown:this.mousedown,mouseup:this.mouseup}),this.$inputs.off({keydown:this.keydown,keyup:this.keyup,blur:this.blur,paste:this.paste}),this.$buttons.off({mouseout:this.mouseout})},activate:function(a,b){var c;this.$inputs.removeClass("active"),b||a.addClass("active").focus(),this.$active=a,this.active=c=a.data("input"),this.max="hh"===c?24:60},input:function(a,b){var c=this.getVal()||0,d=this.max;b?c=(c+a+d)%d:10>c?(c=10*c+a,c>d&&(c=a),c===d&&(c=0)):c=a,this.setVal(c),this.output()},keydown:function(a){var b=a.which;if(b>=48&&57>=b)a.preventDefault(),this.input(b-48);else if(b>=37&&40>=b)switch(a.preventDefault(),b){case 37:this.activate(this.$hours);break;case 38:this.input(1,!0);break;case 39:this.activate(this.$minutes);break;case 40:this.input(-1,!0)}else(b>=65&&90>=b||b>=186&&192>=b||b>=219&&222>=b)&&a.preventDefault()},keyup:function(){this.validate()},blur:function(){this.validate()},paste:function(a){a.preventDefault()},mousedown:function(b){var c=a(b.target).data("input");switch(c){case"hh":case"mm":this.valid=!1,this.activate("hh"===c?this.$hours:this.$minutes);break;case"+":case"-":this.$active.addClass("active"),this.inputing=setInterval(a.proxy(function(){this.input("+"===c?1:-1,!0)},this),50)}},mouseout:function(){clearInterval(this.inputing)},mouseup:function(){clearInterval(this.inputing)},getVal:function(){return d(this.$active.val())},setVal:function(a){this.$active.val(isNaN(a)?"":e(a))},output:function(){var a,b=this.$hours.val(),c=this.$minutes.val();b&&c&&(a=b+":"+c,this.$element.val(a))},validate:function(){var a,b;this.valid||(a=this.getVal(),b=this.max,isNaN(a)?this.setVal(a):a>=b&&this.setVal(a%b),this.valid=!0)},destroy:function(){this.$inputs.removeClass("active"),this.removeListeners(),this.$element.removeData("timeinputer")}},c.DEFAULTS={time:!1},c.TEMPLATE='<div class="timeinputer"><input data-input="hh" type="text" name="hour" value="--" maxlength="2"><span data-input=":">:</span><input data-input="mm" type="text" name="minute" value="--" maxlength="2"><button data-input="+" type="button">+</button><button data-input="-" type="button">-</button></div>',c.setDefaults=function(b){a.extend(c.DEFAULTS,b)},c.other=a.fn.timeinputer,a.fn.timeinputer=function(b){var d,e=[].slice.call(arguments,1);return this.each(function(){var f,g=a(this),h=g.data("timeinputer");h||g.data("timeinputer",h=new c(this,b)),"string"==typeof b&&a.isFunction(f=h[b])&&(d=f.apply(h,e))}),"undefined"!=typeof d?d:this},a.fn.timeinputer.Constructor=c,a.fn.timeinputer.setDefaults=c.setDefaults,a.fn.timeinputer.noConflict=function(){return a.fn.timeinputer=c.other,this},a(function(){a("input[type='time']").timeinputer()})}),function(a){"function"==typeof define&&define.amd?define("validate",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.isPlainObject(d)?d:{},this.defaults=a.extend(!0,{},b.defaults),this.valid=!1,this.init()};b.defaults={rules:{},trim:!1,trimOverflow:!1,charCodeLength:!1,filter:null,showErrors:null,hideErrors:null},b.regexps={email:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,nonempty:/\S+/,number:/^\d+$/,password:/^.{6,20}$/,chinese:/[\u4e00-\u9fa5]+/g,name:/^[a-zA-Z\u4e00-\u9fa5]+$/,phone:/^\d{11}$/,code:/^\d{4,6}$/},b.rules=["number","email","password","required","minlength","maxlength","min","max"],b.messages={required:"此项为必填项",email:"请输入有效的电子邮件",url:"请输入有效的网址",date:"请输入有效的日期",dateISO:"请输入有效的日期 (YYYY-MM-DD)",number:"请输入正确的数字",digits:"只可输入数字",creditcard:"请输入有效的信用卡号码",equalTo:"你的输入不相同",extension:"请输入有效的后缀",maxlength:"最多 %s 个字",minlength:"最少 %s 个字",rangelength:"请输入长度为 %s 至 %s 之間的字串",range:"请输入 %s 至 %s 之间的数值",max:"请输入不大于 %s 的数值",min:"请输入不小于 %s 的数值",name:"姓名只能包含汉字和字母",phone:"手机号码必须为11位数字",code:"请输入有效的验证码"},b.prototype={constructor:b,init:function(){this.update(),this.addListener()},update:function(c){var d=this.$element,e=d.attr("type");c=a.isPlainObject(c)?c:{},a.each(b.rules,function(a,b){var f=b===e?e:d.attr(b);f&&(/^\d+$/.test(f)&&(f=parseFloat(f)),c[b]=f)}),a.extend(!0,this.defaults,{rules:c},this.options)},addListener:function(){this.$element.on("keyup change",a.proxy(this.validate,this)),this.defaults.trim&&this.$element.on("change",a.proxy(this.trim,this))},trim:function(){var b=this.$element;b.val(a.trim(b.val()))},validate:function(c){var d,e=this,f=this.defaults,g=this.$element,h=g.get(0),i=g.val(),j=f.showErrors,k=f.hideErrors,l=!0;return g.hasClass("disabled")?l:(a.isFunction(f.filter)&&(i=f.filter.call(h,i)),f.trim&&(i=a.trim(i)),a.each(f.rules,function(c,g){var m=e[c];return a.isFunction(m)&&(l=m.call(e,i,g)),l?void(a.isFunction(k)&&k(h)):(d=b.messages[c],d&&-1!==d.indexOf("%s")&&("number"==typeof g?(f.charCodeLength&&(g/=2),d=d.replace("%s",g)):a.isArray(g)&&a.each(g,function(a,b){d=d.replace("%s",b)})),a.isFunction(j)&&j(h,d),!1)}),this.valid=l,!l&&f.preventInput&&c.preventDefault(),l)},required:function(){return b.regexps.nonempty.test(this.$element.val())},number:function(){return b.regexps.number.test(this.$element.val())},min:function(a,b){return a=parseFloat(a),!isNaN(a)&&a>=b},max:function(a,b){return a=parseFloat(a),!isNaN(a)&&b>=a},minlength:function(a,b){var c="string"==typeof a?a.length:0;return c>=b},maxlength:function(a,b){var c,d=this.defaults,e="string"==typeof a?a.length:0,f=0,g="";if(e&&d.charCodeLength){for(c=0;e>c;c++)f+=a.charCodeAt(c)>255?2:1,b>=f&&(g+=a.charAt(c));e=f,f>b&&d.trimOverflow&&(e=b,this.$element.val(g))}return b>=e},name:function(){return b.regexps.name.test(this.$element.val())},phone:function(){return b.regexps.phone.test(this.$element.val())},code:function(){return b.regexps.code.test(this.$element.val())}},a.fn.validate=function(c){var d;return this.each(function(){var e=a(this),f=e.data("we.validate");f||e.data("we.validate",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&(d=f[c]())}),"undefined"!=typeof d?d:this},a.fn.validate.Constructor=b,a.fn.validate.setDefaults=function(c){a.isPlainObject(c)&&a.extend(!0,b.defaults,c)}}),define("modules/card-selector",["jquery","welife"],function(a,b){"use strict";b.cardSelector=function(c){var d=c?c.find(".card-selector"):a(".card-selector"),e=d.find(".card-style-id"),f=d.find(".card-style-name"),g=d.find(".card-style"),h=g.find(".card-style-list"),i=g.find(".card-style-template").text();d.on("click","[data-toggle^='card']",function(){var c,d=a(this),j=d.data(),k=j.toggle.replace("card.","");if(!d.hasClass("disabled")&&!d.hasClass("selected"))switch(k){case"load":j.loaded?g.modal("show"):a.ajax(j.url,{data:j,dataType:"json",beforeSend:function(){b.msg(b.MESSAGES.loading,3),d.addClass("disabled")},success:function(c){var f=_.template(i),j="";0===c.errcode?(b.msg("hide"),d.data("loaded",!0),g.modal("show"),a.isArray(c.result)&&(a.each(c.result,function(){j+=f(arguments[1])}),h.html(j).find("[data-id='"+e.val()+"']").addClass("selected"))):b.msg(c.errmsg,5)},error:function(){b.msg(b.MESSAGES.error.loading,5),console.log(arguments)},complete:function(){d.removeClass("disabled")}});break;case"select":h.find(".selected").removeClass("selected"),d.addClass("selected");break;case"selected":c=h.find(".selected"),c.length&&(j=c.data(),e.val(j.id),f.text(j.name)),g.modal("hide")}})}}),define("modules/chart",["jquery","echarts","echarts/chart/line","echarts/chart/bar","echarts/chart/pie"],function(a,b){"use strict";var c=function(b,d){this.element=b,this.$element=a(b),this.defaults=a.extend({},c.defaults,this.$element.data(),a.isPlainObject(d)?d:{}),this.caches={},this.cacheId=0,this.options=null,this.chart=null,this.charting=!1,this.active=!1,this.defaults.toggle&&this.toggle()};c.defaults={cacheId:0,type:"line",params:null,options:null,url:"",width:0/0,height:0/0,overview:"",toggle:!0},c.prototype={constructor:c,init:function(){var b=this.defaults;a.isPlainObject(b.options)&&(this.options=b.options,this.cacheId=b.cacheId||0,this.cache(this.cacheId,this.options)),"string"==typeof b.params&&(b.params=a.parseJSON(b.params)),this.$source=a(b.source),this.$category=a(b.category),this.$source.addClass("hide"),this.$category.addClass("hide"),this.addListeners(),this.active=!0},addListeners:function(){this.$category.on("checked.we.radio",a.proxy(this.changeCategory,this))},removeListeners:function(){this.$category.off("checked.we.radio")},changeCategory:function(b){var c,d,e=a(b.target);this.$element.hasClass("charted")&&(c=e.find(":radio"),d=a.extend({},e.data(),c.data()),d[c.attr("name")]=c.val(),d["we.radio"]=null,this.load(d.url,d,function(){this.initChart()}))},cache:function(b,c){var d=this.caches;return b=parseInt(b,10)||this.cacheId,a.isPlainObject(c)?void(d[b]=c):d[b]},load:function(b,c,d){var e,f=this,g=this.defaults;if(d||(a.isFunction(b)?(d=b,b=!1):a.isFunction(c)?(d=c,c=null):d=a.noop),b=b||g.url,c=a.isPlainObject(c)?c:{},a.extend(c,g.params),"undefined"!=typeof c.cacheId){if(e=this.cache(c.cacheId))return this.options=e,this.cacheId=c.cacheId,void d.call(this);if(a.isPlainObject(c.options))return this.options=c.options,c.cacheId&&(this.cacheId=c.cacheId),this.cache(this.cacheId,c.options),void d.call(this)}"string"==typeof b&&b&&a.ajax(b,{data:c,dataType:"json",success:function(a){"object"==typeof a&&(f.options=a,c.cacheId&&(f.cacheId=c.cacheId),f.cache(f.cacheId,a),d.call(f))}})},initChart:function(){var a=this.options;this.chart&&(this.chart.clear(),this.chart.dispose(),this.chart=null),"bar"===this.defaults.type&&(a=this.filter(a)),this.chart=b.init(this.element),this.chart.setOption(a),this.shown()},filter:function(a){try{a.xAxis[0].axisLabel={formatter:function(a){return a&&String(a).substr(0,5)}}}catch(b){console.log(b.message)}return a},setOptions:function(b){a.isPlainObject(b)&&(this.options=b,this.cache(this.cacheId,b),this.initChart())},getOptions:function(){return this.options},show:function(){var a=this.$element;this.charting||a.hasClass("charted")||(this.active||this.init(),this.charting=!0,a.addClass("charted loading"),this.options?this.initChart():this.load(function(){this.initChart()}))},shown:function(){var a=this.defaults,b=this.options?this.options.total||0:0,c=a.overview;b="<b>"+b+"</b>",c="string"==typeof c?c.replace("%s",b):b,this.$element.removeClass("loading").closest(".we-chart").find(".chart-overview").html(c),this.$source.removeClass("hide"),this.$category.removeClass("hide"),this.charting=!1,this.$element.trigger("shown.we.chart")},hide:function(){var a=this.$element;a.hasClass("charted")&&(a.removeClass("charted"),this.hidden())},hidden:function(){this.cacheId>0&&(this.cacheId=this.defaults.cacheId,this.options=this.cache(this.cacheId),this.$category.radio("uncheck")),this.$source.addClass("hide"),this.$category.addClass("hide"),this.$element.trigger("hidden.we.chart")},toggle:function(){this.$element.hasClass("charted")?this.hide():this.show()}},a.fn.chart=function(b){var d,e=[].slice.call(arguments,1);return this.each(function(){var f=a(this),g=f.data("we.chart");g||f.data("we.chart",g=new c(this,b)),"string"==typeof b&&a.isFunction(g[b])&&(d=g[b].apply(g,e))}),"undefined"!=typeof d?d:this},a.fn.chart.constructor=c,a(document).on("click.we.chart","[data-toggle='chart']",function(b){var c=a(this),d=c.data(),e=a(d.target||c.attr("href"));b.preventDefault(),c.hasClass("active")||(c.addClass("active").siblings(".active").removeClass("active"),e.addClass("active").siblings(".active").removeClass("active").chart("hide")),d=e.data("we.chart")?"toggle":d,e.chart(d)}),a(function(){a(".active[data-toggle='chart']").click(),a("[data-toggle='chart.render']").chart()})}),define("modules/code-sender",["jquery","welife"],function(a,b){"use strict";var c=function(b,d){this.$element=a(b),this.defaults=a.extend({},c.defaults,d||{}),this.init()};return c.defaults={countdown:60,text:"发送验证码",countdownText:"%s秒后重新发送",waiting:!1,done:a.noop},c.prototype.init=function(){var b=this.$element,c=this.defaults;b.on("click",a.proxy(this.send,this)),this.count=c.countdown,this.counting=!1,c.waiting&&this.countdown()},c.prototype.send=function(c){var d,e=this,f=this.$element,g=this.defaults;f.prop("disabled")||f.hasClass("disabled")||(f.addClass("disabled"),this.countdown(),c&&"click"===c.type&&(d=f.data(),a.ajax(d.url,{type:"post",data:d,dataType:"json",success:function(c){b.respond(c,{success:function(){a.isFunction(g.done)&&g.done()},error:function(){e.complete()}})},fail:function(){e.complete()}})))},c.prototype.countdown=function(){this.$element.text(this.defaults.countdownText.replace("%s",this.count)),this.count-->0?this.counting=setTimeout(a.proxy(this.countdown,this),1e3):this.complete()},c.prototype.complete=function(){var a=this.defaults;clearTimeout(this.counting),this.counting=!1,this.count=a.countdown,this.$element.text(a.text).removeClass("disabled")},c}),define("modules/color-selector",["jquery","welife"],function(a,b){"use strict";b.colorSelector=function(c){var d=c?c.find(".color-selector"):a(".color-selector"),e=d.find(".color-style-id"),f=d.find(".color-style-name"),g=d.find(".color-style"),h=g.find(".color-style-list"),i=g.find(".color-style-template").text();d.on("click","[data-toggle^='color']",function(){var c,d=a(this),j=d.data(),k=j.toggle.replace("color.","");if(!d.hasClass("disabled")&&!d.hasClass("selected"))switch(k){case"load":j.loaded?g.modal("show"):a.ajax(j.url,{data:j,dataType:"json",beforeSend:function(){b.msg(b.MESSAGES.loading,3),d.addClass("disabled")},success:function(c){var f=_.template(i),j="";0===c.errcode?(b.msg("hide"),d.data("loaded",!0),g.modal("show"),a.isArray(c.result)&&(a.each(c.result,function(){j+=f(arguments[1])}),h.html(j).find("[data-id='"+e.val()+"']").addClass("selected"))):b.msg(c.errmsg,5)},error:function(){b.msg(b.MESSAGES.error.loading,5),console.log(arguments)},complete:function(){d.removeClass("disabled")}});break;case"select":h.find(".selected").removeClass("selected"),d.addClass("selected");break;case"selected":c=h.find(".selected"),c.length&&(j=c.data(),e.val(j.id),f.css("background-color",j.color)),g.modal("hide")}})}}),define("modules/coupon",["jquery","welife","modules/date","modules/popovers","modules/shop","modules/text-editor"],function(a,b){"use strict";b.couponEditor=function(c){function d(b){var c=k.hasClass("in");
c||p.addClass("disabled").prop("disabled",!0),a.ajax(b.remote,{data:b,success:function(a){c?k.empty().html(a):k.html(a).collapse("show"),"create"===b.page&&e(),"search"===b.page&&f()},error:function(){c||p.removeClass("disabled").prop("disabled",!1),console.log(arguments)}})}function e(){var c=k.find(".coupon-create"),d=c.find(".we-form"),e=d.find(".input-type"),f=d.find(".input-value"),i=d.find(".input-name-prefix"),j=d.find(".input-name"),l=d.find(".input-term"),m=d.find(".term-absolute"),n=d.find(".term-relative"),o=n.find(".input-term-count"),p=d.find(".input-shop"),q=d.find(".input-restriction"),r=c.find(".voucher-detail"),s=_.template(c.find("#voucher-detail-template").text()),t={},u={count:function(){return n.is(":visible")?o.validate("validate"):!0}};n.is(":visible")&&(n.data("active",!0),o.validate()),m.is(":visible")&&(m.data("active",!0),b.date(c,{startDate:new Date})),c.on("click","[data-toggle^='coupon']",function(){var i=a(this),k=i.data(),v=k.toggle.replace("coupon.","");switch(v){case"relative":n.removeClass("hide"),m.addClass("hide"),n.data("active")||(n.data("active",!0),o.validate()),n.parent().find(".highlight").addClass("hide");break;case"absolute":n.addClass("hide"),m.removeClass("hide"),m.data("active")||(m.data("active",!0),b.date(c,{startDate:new Date})),m.parent().find(".highlight").addClass("hide");break;case"create":if(f.length&&!f.validate("validate"))return;if(!(j.validate("validate")&&u.count()&&q.validate("validate")))return;l.val(function(){var b=a(this).val();return n.hasClass("hide")?m.hasClass("hide")||(b=["absolute",m.find(".input-term-start").val(),m.find(".input-term-end").val()]):b=["relative",n.find(".input-term-count").val(),n.find(".input-term-unit").val()],a.isArray(b)?b.join():b}),t.value=f.val(),t.name=j.val(),t.term=l.val().split(/\s*\,\s*/),t.shop=p.closest(".form-group").hasClass("hide")?"":p.data("shop"),t.restriction=q.val(),r.html(s(t)),d.addClass("hide"),r.removeClass("hide");break;case"cancel":h();break;case"apply":if(f.length&&!f.validate("validate"))return;if(!(j.validate("validate")&&u.count()&&q.validate("validate")))return;l.val(function(){var b=a(this).val();return n.hasClass("hide")?m.hasClass("hide")||(b=["absolute",m.find(".input-term-start").val(),m.find(".input-term-end").val()]):b=["relative",n.find(".input-term-count").val(),n.find(".input-term-unit").val()],a.isArray(b)?b.join():b}),k[e.attr("name")]=e.val(),k[j.attr("name")]=j.val(),f.length?k[f.attr("name")]=f.val():k.value="",k[l.attr("name")]=l.val(),k[p.attr("name")]=p.val(),k[q.attr("name")]=q.val(),a.ajax(k.url,{type:"POST",data:k,dataType:"json",success:function(a){b.respond(a,{success:function(){g(a.result)}})}});break;case"modify":d.removeClass("hide"),r.addClass("hide")}}),f.validate(),f.on("keyup change",function(){var b=parseInt(a(this).val(),10);i.text(b&&b>0?b+"元":"")}),j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),n.find(".input-term-count").validate(),q.validate({filter:function(){return a(this).data("text")}}),b.popoverNotice(c),b.shop(c),b.textEditor(c)}function f(){var b=k.find(".coupon-search"),c=i.find(".voucher-list"),d=_.template(i.find(".voucher-list-template").text()),e=i.find(".voucher-load"),f=e.find("a"),j=i.find(".detail-modal"),l=j.find(".modal-body"),m=_.template(j.find(".modal-body-template").text());f.data("originalText",f.text()),b.on("click","[data-toggle^='coupon']",function(b){var i=a(this),k=i.data(),n=k.toggle.replace("coupon.","");if(!i.hasClass("disabled"))switch(b.preventDefault(),n){case"detail":j.data("coupon",k=i.closest("li").data()),k=a.extend({},k),k.name=k.value?String(k.name).replace(/^\d+\u5143/,""):k.name,k.term=k.term.split(/\s*\,\s*/),l.empty().html(m(k)),j.modal("show");break;case"detailApply":j.one("hidden.bs.modal",function(){g(j.data("coupon"))}).modal("hide");break;case"cancel":h();break;case"apply":g(i.closest("li").data());break;case"load":a.ajax(k.url,{data:k,dataType:"json",beforeSend:function(){f.addClass("disabled").text(f.data("loading"))},success:function(b){var f,g="";0===b.errcode?(i.data("pageId",++k.pageId),f=b.result,f.data.length>0&&(a.each(f.data,function(a,b){b.name=b.value?b.name.replace(/^\d+\u5143/,""):b.name,b.term=b.term.split(/\s*\,\s*/),g+=d(b)}),c.append(g)),f.more||e.addClass("hide")):console.log(b.errmsg)},complete:function(){f.removeClass("disabled").text(f.data("originalText"))}})}}),b.on("keyup",".input-search",function(b){var c=a(this),d=c.next("button");d.data(c.attr("name"),c.val()),13===b.which&&(b.preventDefault(),d.click())})}function g(b){b=a.extend({},b),b.value&&(b.name=String(b.name).replace(/^\d+\u5143/,"")),m.append(o(b)),k.hasClass("in")&&h(),m.children().length>=3&&p.addClass("hide")}function h(){k.one("hidden.bs.collapse",function(){k.empty(),p.removeClass("disabled").prop("disabled",!1)}).collapse("hide")}var i=c?c.find(".coupon-settings"):a(".coupon-settings"),j=i.find(".we-coupon"),k=i.find(".we-sandbox"),l=i.find(".coupon-condition"),m=j.find(".coupon-list"),n=m.data("existedCoupons"),o=_.template(j.find(".coupon-list-template").text()),p=j.find(".coupon-toggle"),q=j.find(".coupon-menu"),r=i.find(".preview-modal"),s=r.find(".modal-body"),t=_.template(r.find(".modal-body-template").text());a.isArray(n)&&n.length&&a.each(n,function(a,b){g(b)}),q.add(k).on("click","[data-toggle='page']",function(b){b.preventDefault(),d(a(this).data())}),m.on("click","[data-toggle='coupon.preview']",function(b){var c=a(this).closest("li").data();b.preventDefault(),c=a.extend({},c),c.value&&(c.name=String(c.name).replace(/^\d+\u5143/,"")),c.term=c.term.split(/\s*\,\s*/),s.empty().html(t(c)),r.modal("show")}),l.find(".condition-type").on("change",function(){l.find(".condition-unit").text(a(this).find(":selected").data("unit"))}),b.popoverConfirm({message:"确定要删除此券么？",confirm:function(){console.log("Yes"),a(this).popover("destroy").closest("li").remove(),m.children().length<3&&p.removeClass("hide")},cancel:function(){console.log("No")}})}}),define("modules/date",["jquery","welife","datepicker"],function(a,b){"use strict";a.fn.datepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今日",format:"yyyy年mm月dd日",weekStart:1},b.date=function(b,c){var d,e=b?b.find(".we-date-group"):a(".we-date-group"),f=e.find(".date-start"),g=e.find(".date-end"),h=e.find(".date-time"),i=new Date,j=/\d{4}(-\d{2}){2}/,k={autoclose:!0,format:"yyyy-mm-dd",language:"zh-CN",customDateRange:!1,startViewDate:i,endViewDate:function(a){return new Date(a.getFullYear(),a.getMonth()+1,a.getDate())}(new Date)},l=function(a,b){b=[b.getFullYear(),b.getMonth()+1,b.getDate()],b[1]=b[1]<10?"0"+b[1]:b[1],b[2]=b[2]<10?"0"+b[2]:b[2],a.val(b.join("-"))};a.isPlainObject(c)&&a.extend(k,c),k.endDate&&(k.startViewDate>k.endDate&&(k.startViewDate=k.endDate),k.endViewDate>k.endDate&&(k.endViewDate=k.endDate),k.startViewDate===k.endViewDate&&(k.startViewDate=function(a){var b;return b=k.customDateRange?new Date(a.valueOf()-k.customDateRange):new Date(a.getFullYear(),a.getMonth()-1,a.getDate())}(k.endDate))),f.datepicker(k),!j.test(f.val())&&k.startViewDate&&(l(f,k.startViewDate),f.datepicker("update")),g.length&&(f.on("changeDate",function(){var a,b=f.datepicker("getDate"),c=g.datepicker("getDate");b>c&&l(g,b),k.customDateRange&&(a=new Date(b.valueOf()+k.customDateRange),k.endDate&&(a=a<k.endDate?a:k.endDate),c>a&&l(g,a),g.datepicker("setEndDate",a)),g.datepicker("setStartDate",b)}),g.datepicker(k),!j.test(g.val())&&k.endViewDate&&(l(g,k.endViewDate),g.datepicker("update")),f.trigger("changeDate")),h.length&&(d=h.val(),d&&"00:00"!==d||h.val(function(){var a=i.getHours(),b=i.getMinutes();return a=10>a?"0"+a:a,b=10>b?"0"+b:b,a+":"+b})),e.find(".caret").click(function(){a(this).parent().find("input").focus()})}}),define("modules/exporter",["jquery","welife"],function(a,b){"use strict";b.exporter=function(c){var d=c?c.find(".we-exporter"):a(".we-exporter"),e=d.find(".export-toggle"),f=d.find(".export-progress"),g=d.find(".export-result"),h=d.find(".progressbar"),i=d.find(".percentage"),j=d.find(".exported-name"),k=d.find(".exported-url");e.on("click",function(c){var d=a(this).data(),l=new XMLHttpRequest;c.preventDefault(),l.onprogress=function(a){var b;a.lengthComputable&&(b=a.loaded/a.total*100+"%",h.width(b),i.text(b))},a.ajax(d.url,{type:"POST",data:d,dataType:"json",xhr:function(){return l},beforeSend:function(){e.addClass("hide"),f.removeClass("hide")},success:function(a){var c=a.result;0===a.errcode?(j.text(c.name),k.attr("href",c.url),f.addClass("hide"),g.removeClass("hide")):(b.msg(a.errmsg,5),e.removeClass("hide"),f.addClass("hide"))}})}),k.on("click",function(){e.removeClass("hide"),f.addClass("hide"),g.addClass("hide")})}}),define("modules/keyword-editor",["jquery","welife"],function(a,b){"use strict";b.keywordEditor=function(c){function d(){j.val(""),k.text(m.helpText.replace("%s",m.maxlength)),l.checkbox("uncheck")}function e(a){a.keyword&&j.val(a.keyword),a.matched&&l.checkbox("check")}var f=c?c.find(".keyword-editor"):a(".keyword-editor"),g=f.find(".keyword-list"),h=_.template(f.find(".keyword-template").text()),i=f.find(".keyword-modal"),j=i.find(".keyword-content"),k=i.find(".keyword-help-text"),l=i.find(".we-checkbox"),m=j.data(),n=null;m.maxlength=j.attr("maxlength"),i.on("hidden.bs.modal",function(){n=null,d()}).on("shown.bs.modal",function(){j.focus().trigger("keyup")}),j.on("keyup blur",function(){var b=a.trim(j.val()).length;b<=m.maxlength&&k.text(m.helpText.replace("%s",m.maxlength-b))}),j.on("change blur",function(){j.val(a.trim(j.val()))}),f.on("click","[data-toggle^='keyword']",function(){var c,f,k,o=a(this),p=o.data("toggle").replace("keyword.","");if(!o.hasClass("disabled")&&!o.hasClass("selected"))switch(p){case"show":g.children().length<o.data("maxlength")?i.modal("show"):b.msg(o.data("message"),4);break;case"add":c=j.val(),f=l.hasClass("checked"),c?(k=h({keyword:c,matched:f}),n?(n.replaceWith(k),n=null):g.removeClass("hide").append(k),i.modal("hide"),d()):b.msg(m.required,4);break;case"del":o.parent().remove();break;case"edit":n=o.parent(),e(n.data()),i.modal("show")}})}}),define("modules/message-editor",["jquery","welife"],function(a,b){"use strict";b.messageEditor=function(c){var d,e=c?c.find(".message-editor"):a(".message-editor"),f=e.find(".editor-menu"),g=e.find(".editor-input"),h=e.find(".editor-output"),i=e.find(".editor-type"),j=e.find(".editor-help"),k=e.find(".editor-modal"),l=k.find(".editor-modal-menu > li"),m=k.find(".editor-material-list"),n=m.children(),o=_.template(k.find(".editor-material-template").text()),p=k.find(".editor-material-load > a"),q=k.find("[data-toggle='material.selected']"),r=g.data(),s={},t=p.data(),u={page:1},v=function(c){a.isPlainObject(c)&&a.extend(u,c),a.ajax(t.url,{data:u,dataType:"json",beforeSend:function(){p.addClass("disabled").text(p.data("loading"))},success:function(c){var d,e=[];0===c.errcode?(d=c.result,a.isArray(d.data)&&(e=d.data,a.each(e,function(a,b){w(o(b))})),d.more||(p.parent().addClass("hide"),1===u.page&&0===e.length&&k.find(".we-nothing").removeClass("hide")),u.page++):b.msg(c.errmsg,5)},complete:function(){p.removeClass("disabled").text(p.data("originalText"))}})},w=function(b){var c=m.height(),d=0;n.each(function(b){var e=a(this).height();c>e&&(c=e,d=b)}),n.eq(d).append("<li>"+b+"</li>")},x=function(){var a=f.find(".active > a").data("toggle").replace("message.","");a&&(s[a]=g.html())},y=function(a){return a.replace(/<(\/?\w+)?[^<]*>/gim,function(a,b){var c="";switch(b.toLowerCase()){case"br":case"/h1":case"/h2":case"/h3":case"/h4":case"/h5":case"/h6":case"/p":case"/div":c="<br>"}return c}).replace(/&nbsp;/g," ")},z=function(){var a,b,c=f.find(".active > a").data();i.val(c.type).data("typeName",c.typeName),"true"===g.prop("contenteditable")?A():(a=g.html(),b=g.find(".material").data("id"),h.val(b).data("content",a).trigger("change"))},A=function(a){var b,c,d,e,f,i=g[0],k=!0;"false"!==g.prop("contenteditable")&&(b=g.html(),b=b.replace(/&nbsp;/g," ").replace(/\s+$/,""),/<[^<]+>/.test(b)&&(c=y(b),c!==b&&(b=c,g.html(b),13===a&&window.getSelection&&(d=window.getSelection(),d.selectAllChildren(i),d.collapseToEnd()))),e=b.replace(/<br>/g," ").length,e<r.minLength?f=r.minText.replace("%s",r.minLength):e>r.maxLength?(k=!1,f=r.maxText.replace("%s",r.maxLength).replace("%s",e-r.maxLength)):r.required&&0===e?(k=!1,f=r.helpText.replace("%s",r.maxLength)):f=r.helpText.replace("%s",r.maxLength-e),j.text(f),g.data("valid",k),h.val(b).data("content",b).trigger("change"))};return"undefined"!=typeof g.attr("disabled")?(f.find("a").addClass("disabled"),g.prop("contenteditable",!1).data("valid",!0),e.find(".editor-clear").addClass("hide"),void e.find(".editor-btns").addClass("invisible")):(a.trim(g.text()).length&&g.data("valid",!0),z(),p.data("originalText",p.text()),f.on("click","[data-toggle^='message']",function(b){var c=a(this),e=c.parent(),f=e.hasClass("active"),h=c.data(),i=h.toggle.replace("message.","");if(b.preventDefault(),!c.hasClass("disabled"))switch(d=e,x(),i){case"text":f||(d.addClass("active").siblings().removeClass("active"),g.prop("contenteditable",!0),g.empty().html(s[i]),z());break;case"single":case"multiple":f||(q.addClass("disabled"),p.text(p.data("loading")).addClass("disabled")),k.one("shown.bs.modal",function(){f?1===u.page&&v(h):(u.page=1,n.empty(),v(h))}).one("hidden.bs.modal",function(){d&&!d.hasClass("active")&&(u.page=1,n.empty())}),l.removeClass("active"),"single"===i?l.first().addClass("active"):l.last().addClass("active"),k.modal("show")}}),A(),g.on("keyup blur",function(a){A(a.which)}),g.on("paste",function(){console.log("Pasted!"),setTimeout(function(){A()},50)}),void k.on("click","[data-toggle^='material']",function(){var b,c=a(this),e=c.data(),f=e.toggle.replace("material.","");if(!c.hasClass("disabled"))switch(f){case"load":v();break;case"select":c.hasClass("selected")||(n.find(".selected").removeClass("selected"),c.addClass("selected"),q.addClass("disabled"),q.hasClass("disabled")&&q.removeClass("disabled"));break;case"selected":b=n.find(".selected"),b.length&&(b=b.clone().removeClass("selected").removeAttr("data-toggle"),g.prop("contenteditable",!1).empty().html(b),j.empty(),d&&!d.hasClass("active")&&d.addClass("active").siblings().removeClass("active"),z()),k.modal("hide")}}))}}),define("modules/popovers",["jquery","welife"],function(a,b){"use strict";b.popoverNotice=function(b,c){var d=b?b.find(".we-notice-toggle"):a(".we-notice-toggle");return c?void d.popover("destroy"):void d.each(function(){var b=a(this);b.popover({trigger:"hover",content:b.find(".notice-template").text(),html:!0,template:'<div class="popover we-popover-notice" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})})},b.popoverConfirm=function(b,c){var d=a.isPlainObject(b)?b:{},e=function(){return'<div class="popover we-popover-confirm" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'},f=function(a){var b='<div class="popover-message">'+a+'</div><div class="popover-buttons"><button class="btn we-btn-sm" type="button" data-toggle="popover.confirm.submit">确认</button><button class="btn we-btn-sm" type="button" data-toggle="popover.confirm.cancel">取消</button></div>';return b},g={trigger:"click",content:f(d.message),html:!0,placement:"bottom",template:e()},h="click.bs.popover.confirm"+(d.namespace||""),i="[data-toggle='popover.confirm"+(d.namespace||"")+"']";return"destroy"===b||c?void a(document).off(h):void a(document).on(h,i,function(c){var d,e,h,i=a(this);return c.preventDefault(),i.hasClass("disabled")?void(i.data("bs.popover")&&i.popover("destroy")):void(i.data("bs.popover")?i.popover("show"):(d=i.data(),e=a.extend({},b),h=a.extend({},g),d.message&&(h.content=f(d.message)),i.on("hidden.bs.popover",function(){console.log("hidden"),i.data("bs.popover").$tip.off("click.popover.confirm").off("click.popover.cancel")}).on("shown.bs.popover",function(){console.log("shown"),i.data("bs.popover").$tip.on("click.popover.confirm","[data-toggle='popover.confirm.submit']",function(b){b.stopPropagation(),a.isFunction(e.confirm)&&!i.hasClass("disabled")&&i.one("hidden.bs.popover",function(){e.confirm.call(this)}),i.popover("hide")}).on("click.popover.cancel","[data-toggle='popover.confirm.cancel']",function(b){b.stopPropagation(),a.isFunction(e.cancel)&&!i.hasClass("disabled")&&i.one("hidden.bs.popover",function(){e.cancel.call(this)}),i.popover("hide")})}),i.popover(h).popover("show")))})}}),define("modules/shop",["jquery","welife"],function(a,b){"use strict";var c=a(document);b.shop=function(d,e){function f(){var b=i.val();if(b){if(o)return void p.filter("[data-shop-id='"+b+"']").radio("check");"all"===b.toLowerCase()?(m.checkbox("check"),p.checkbox("check")):(b=b.match(/\d+/g),b&&b.length&&(m.checkbox("uncheck"),p.checkbox("uncheck"),a.each(b,function(a,b){p.filter("[data-shop-id='"+b+"']").checkbox("check")})))}}function g(b){var c,d;a.isArray(b)&&(c=s({shops:b}),p.append(c),p=p.children(),o=p.filter(".we-radio").length>0,o||(p.checkbox("enable"),d=p.length,e||p.on("checked.we.checkbox",function(){p.filter(".checked").length===d&&(n=!1,m.checkbox("check"))}),p.on("unchecked.we.checkbox",function(){p.filter(".checked").length!==d&&(n=!1,m.checkbox("uncheck"))})),f(),l.collapse("show"))}var h=d?d.find(".we-shop-container"):a(".we-shop-container"),i=h.find(".shop-checked-ids"),j=h.find(".shop-toggle"),k=h.find(".shop-checked-list"),l=h.find(".we-shop"),m=l.find(".shop-check-all"),n=!0,o=!1,p=l.find(".shop-list"),q=p.data("viewTemplate"),r=q?a(q):l.find(".shop-list-template"),s=_.template(r.text()),t=l.find(".shop-confirm"),u=l.find(".shop-cancel"),v=j.data(),w=!1;j.click(function(c){return c.stopPropagation(),c.preventDefault(),w?(f(),l.collapse("toggle")):b.shop.data?(w=!0,g(b.shop.data)):a.ajax(v.url,{data:v,dataType:"json",success:function(a){0===a.errcode?(w=!0,b.shop.data=a.result,g(a.result)):console.log(a.errmsg)}}),!1}),m.on({"checked.we.checkbox":function(){n&&p.checkbox("check"),n=!0},"unchecked.we.checkbox":function(){n&&p.checkbox("uncheck"),n=!0}}),t.click(function(){var c=[],d=[];m.hasClass("checked")?(d.push("全部门店"),c.push("all")):p.filter(".checked").each(function(){var b=a(this);d.push(b.text()),c.push(b.data("shopId"))}),d.length?(k.html("<li>"+d.join("</li><li>")+"</li>"),i.val(c.join()).data("shop",d.join("&nbsp;&nbsp;")).trigger("change.we.shop"),l.collapse("hide"),j.text("更改")):b.msg("请选择门店",4)}),u.click(function(){l.collapse("hide")}),l.on("shown.bs.collapse",function(){var a=this;c.on("click.we.shop",function(b){for(var c=b.target,d=!0;"BODY"!==c.tagName;){if(c===a){d=!1;break}c=c.parentNode}d&&l.collapse("hide")})}).on("hidden.bs.collapse",function(){c.off("click.we.shop")})},b.shop.data=null}),define("modules/sms-editor",["jquery","welife"],function(a,b){"use strict";b.smsEditor=function(b,c){var d=b?b.find(".smsbox"):a(".smsbox"),e=d.find(".smsbox-input"),f=d.find("[data-counter='input']"),g=parseInt(e.attr("maxlength"),10),h=f.data("text"),i=d.find("[data-counter='msg']"),j=i.data("text"),k=i.data("msgLength");c=a.isPlainObject(c)?c:{},isNaN(g)||e.on("keyup blur",function(){var b,d=e.val(),l=d.length;return l>g?void e.val(d.substr(0,g)):(e.data("count",b=Math.ceil(l/k)),f.text(h.replace("%s",g-l)),i.text(j.replace("%s",b)),void(a.isFunction(c.change)&&c.change(b)))}).triggerHandler("blur")}}),define("modules/text-editor",["jquery","welife"],function(a,b){"use strict";b.textEditor=function(b,c){var d=b?b.find(".we-editor"):a(".we-editor"),e=d.find(".editor-output"),f=d.find(".editor-input"),g=f.attr("placeholder"),h=/<ul>.*<\/ul>/m,i=/[\r\n]+/g,j=function(b){return a.trim(b.replace(/\s{2,}/g,""))},k=function(){var a=j(f.html()),b=j(f.text());b===g&&(a=b=""),e.val(a).data("text",b),e.trigger("change")},l=function(b){var c,d=f.html(),g=a.trim(f.text());return g.length?(h.test(d)||(g=g.split(i),d="<ul><li>"+g.join("</li><li>")+"</li></ul>",f.html(d),b&&window.getSelection&&(this.focus(),c=window.getSelection(),c.selectAllChildren(this),c.collapseToEnd())),void k()):(e.val(""),void f.empty())};return c?void f.off():(k(),void f.on({keyup:function(a){var b=a.which;(13===b||a.ctrlKey&&86===b)&&l.call(this,!0)},blur:function(){l.call(this)}}))}}),define("modules/time-range-selector",["jquery","welife"],function(a,b){"use strict";b.timeRange=function(){function b(b){var c=s.children().length,d=a(j);c>0&&d.find(".time-range-title").addClass("hide"),c>=3?d.find(".btn-plus").addClass("hide"):b&&s.find(".btn-plus").addClass("hide"),b&&d.find(".time-range-item").val(b),s.append(d)}function c(){u=0,v=0,w=0,d="",e="",r.removeClass("active enable"),l.removeClass("hide"),m.removeClass("show"),n.empty()}var d,e,f,g,h=a(".we-time-range-group"),i=h.find(".time-range-toggle"),j=h.find("#time-range-template").text(),k=h.find(".time-range"),l=k.find(".time-range-help"),m=k.find(".time-range-note"),n=m.find(".time-range-hours"),o=k.find(".time-range-confirm"),p=k.find(".time-range-cancel"),q=k.find(".time-table-list"),r=q.children(),s=h.find(".time-range-list"),t=s.data("existedTimeRanges"),u=0,v=0,w=0;a.isArray(t)&&t.length&&(i.addClass("hide"),s.addClass("show"),a.each(t,function(a,c){b(c)})),i.click(function(){i.addClass("hide"),s.addClass("show"),b()}),s.on("click","[data-toggle^='time.range']",function(){var d,e,g=a(this),h=g.data("toggle");switch(f=null,h){case"time.range.val":f=g,g.after(k),c(),k.addClass("show");break;case"time.range.add":c(),b(),g.addClass("hide");break;case"time.range.del":s.after(k),g.parent().remove(),d=s.find(".btn-plus"),e=s.find(".time-range-title"),e.addClass("hide"),e.first().removeClass("hide"),d.addClass("hide"),d.last().removeClass("hide"),s.children().length||(i.removeClass("hide"),s.removeClass("show"))}}),r.each(function(b){a(this).attr("data-index",b)}),q.on("click","li",function(){var b,c=a(this),f=w;c.hasClass("active")||(b=c.data("index"),0===u?(u++,v=b,l.addClass("hide"),m.addClass("show")):1===u?(u++,v>b?(w=v,v=b):w=b,r.slice(v+1,w).addClass("enable")):2===u&&(v>b?(r.slice(b+1,v).addClass("enable"),r.slice(v+1,w).removeClass("enable"),w=v,v=b):b>w?(r.slice(w,b).addClass("enable"),w=b):(v+w)/2>b?(r.slice(v+1,b+1).removeClass("enable"),f=v,v=b):(r.slice(b,w).removeClass("enable"),w=b),r.eq(f).removeClass("active")),c.addClass("active"),d=r.eq(v).text(),e=w?r.eq(w).text():"",g=d+" - "+e,n.text(g))}),o.click(function(){d&&e&&f.val(g),k.removeClass("show")}),p.click(function(){k.removeClass("show")})}}),define("modules/uploader",["jquery","welife","modules/popovers"],function(a,b){"use strict";b.uploader=function(c){var d=c&&"undefined"!=typeof c.selector?c:a(".we-uploader"),e=d.find(".upload-step-one"),f=d.find(".upload-step-two"),g=d.find(".upload-step-three"),h=d.find(".progressbar"),i=d.find(".percentage"),j=d.find(".upload-preview"),k=d.find(".upload-view"),l=d.find(".js-uploaded"),m=d.find(".js-uploaded-id"),n=d.find(":file"),o=d.find(".help-block"),p=n.attr("name"),q=n.data(),r=!!window.FormData,s=function(a){var b;a.lengthComputable&&(b=a.loaded/a.total*100+"%",h.width(b),i.text(b))},t=function(d){var h,i=new XMLHttpRequest;r&&(h=new FormData,h.append(p,d),i.upload.onprogress=s,a.ajax(q.url,{type:"POST",data:h,dataType:"json",processData:!1,contentType:!1,xhr:function(){return i},beforeSend:function(){e.addClass("hide"),f.removeClass("hide"),j.html(d.name+" <span>"+(Math.round(d.size/1024)+"KB")+"<span")},success:function(h){var i;0===h.errcode?(i=h.result,l.val(i.url).data("imageId",i.id),m.val(i.id),k.html('<img src="'+i.url+'" alt="'+d.name+'">'),f.addClass("hide"),g.removeClass("hide"),a.isFunction(c.done)&&c.done(i)):(b.msg(h.errmsg,5),e.removeClass("hide"),f.addClass("hide"),j.empty())},complete:function(){n.val(null)}}))};return"destroy"===c?(n.off(),void b.popoverConfirm("destroy")):(c&&"undefined"!=typeof c.selector&&(c=arguments[1]),c=a.isPlainObject(c)?c:{},n.on("change",function(){var a,b,c,d=this.files;d&&d.length>0&&(a=d[0],b=a.size/1024,/image\/(jpg|jpeg|png|gif)/.test(a.type)?b<=q.maxsize?t(a):c=o.data("size").replace(/\d+/,q.maxsize):c=o.data("type"),c?(o.text(c),n.val(null)):o.text(""))}),b.popoverConfirm({namespace:c.namespace,message:"确定要删除该图片吗？",confirm:function(){l.val(""),m.val(""),k.empty(),j.empty(),o.text(""),e.removeClass("hide"),f.addClass("hide"),g.addClass("hide"),a.isFunction(c.fail)&&c.fail()}}),void(l.val()&&(e.addClass("hide"),f.addClass("hide"),g.removeClass("hide"),k.html('<img src="'+l.val()+'" alt="">'))))}}),define("modules/utilities",["jquery","welife"],function(a,b){"use strict";b.assign=function(a,c){a&&"string"==typeof a&&(c="number"==typeof c?c:2e3,"reload"===a?b.reload(c):setTimeout(function(){window.location.assign(a)},c))},b.reload=function(a,b){"number"!=typeof b&&(b="number"==typeof a?a:2e3),"boolean"!=typeof a&&(a=!1),setTimeout(function(){window.location.reload(a)},b)},b.showError=function(a,b){var c=a.closest(".form-group").find(".control-label").next(),d=c.find(".highlight");d.length?b?(a.focus(),d.text(b).removeClass("hide")):d.empty().addClass("hide"):c.append('<p class="help-block highlight">'+(b||"")+"</p>")},b.respond=function(c,d){var e=!1;if(a.isPlainObject(c)){switch(c.errcode){case 0:e=!0,b.msg(c.errmsg,2),b.$main.find(".form-group .highlight").empty().addClass("hide"),(c.returnurl||c.redirect)&&b.assign(c.returnurl||c.redirect);break;case 1:b.msg(c.errmsg,5),b.$main.find("form :submit").prop("disabled",!1);break;case 100:b.msg(c.errmsg,5),function(c){var d=b.$main.find("form");a.each(c,function(a,c){var e,f=d.find("[name^='"+a.replace("[]","")+"']");try{if("activityExisted"===a)return e=b.$main.find(".existed-modal"),e.find(".modal-body").text(c.message),"continue"===c.style?(e.find(".btn-primary").removeClass("hide"),e.find(".btn-default").text("取消")):"break"===c.style&&(e.find(".btn-primary").addClass("hide"),e.find(".btn-default").text("确定")),void e.modal("show")}catch(g){console.log(g.message)}f.length&&b.showError(f,c)})}(c.result);break;default:b.msg(c.errmsg,5)}e?d&&a.isFunction(d.success)&&d.success():d&&a.isFunction(d.error)&&d.error()}},a.fn.validate.setDefaults({showErrors:function(c,d){b.showError(a(c),d)},hideErrors:function(c){b.showError(a(c))}}),b.util={back:function(){window.history.back()},captcha:function(){var b=a(this),c=b.data("originalSrc");b.is("img")&&(c||b.data("originalSrc",c=b.attr("src").replace(/\?.*?$/,"")),b.attr("src",c+"?timestamp="+(new Date).getTime()))},toggle:function(){var b=a(this).data();b.target&&(a(b.target).removeClass("hide"),b.parent&&a(b.parent).addClass("hide"))},formatNumber:function(a,b){var c,d,e=[];for(a=parseFloat(a)||0,c=0>a?"-":"","number"==typeof b?(a=a.toFixed(b),b=a.toString().substr(-++b)):b="",a=Math.abs(Math.floor(a))||0,a=a.toString().split(""),d=a.length;d>0;d-=3)e.unshift((a[d-3]||"")+(a[d-2]||"")+(a[d-1]||""));return c+e.join()+b}},a(document).on("click","[data-click]",function(){var c=a(this).data("click"),d=b[c]||b.util[c];a.isFunction(d)&&d.call(this)})}),define("user/forgot-done",["jquery","welife","modules/code-sender"],function(a,b,c){"use strict";var d=function(){var d=a(".main");d.find("[data-toggle='codesender']").each(function(){var d=a(this);new c(this,a.extend({text:d.text(),done:function(){b.msg("账号密码发送成功",2)}},d.data()))})};return d}),define("user/forgot",["jquery","welife","modules/code-sender"],function(a,b,c){"use strict";var d=function(){var d=a(".main"),e=d.find(".we-form"),f=e.find(".input-phone"),g=e.find(".input-code"),h=e.find(".btn-send"),i=new c(h[0],a.extend({text:h.text(),done:function(){g.focus().val("")}},h.data()));f.validate({rules:{phone:"phone"}}),g.validate({rules:{code:"code"}}),f.on("keyup change",function(){f.validate("validate")?(h.data(f.attr("name"),f.val()),i.counting||h.removeClass("disabled")):h.addClass("disabled")}),e.submitter({isValidated:function(){return f.validate("validate")&&g.validate("validate")},done:function(a){b.respond(a)}})};return d}),define("user/login",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".main"),d=c.find(".we-form"),e=d.find(".captcha"),f=function(){e.find(".input-captcha").val(""),e.find("img").click()};d.submitter({done:function(a){b.respond(a,{error:function(){f()}})},fail:function(){f()}})};return c}),define("activity/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".activity-list"),e=c.find(".activity-modal"),f=e.find(".activity-detail"),g=_.template(e.find("#activity-detail-template").text());d.on("click","[data-toggle='activity.detail']",function(b){var c=a(this).closest("tr").data();b.preventDefault(),c.message=c.message||"",c.shop=c.shop||"",f.html(g(c)),e.modal("show")}),b.popoverConfirm({message:"确定删除该活动？",confirm:function(){var c=a(this),d=c.data("id");a.ajax(b.DEFAULTS.ajaxDeleteUrl,{async:!1,type:"POST",data:{id:d},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}}),b.popoverConfirm({namespace:".terminate",message:"确定终止该活动？",confirm:function(){var c=a(this),d=c.data("id");a.ajax(b.DEFAULTS.ajaxTerminateUrl,{async:!1,type:"POST",data:{id:d},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}})};return c}),define("activity/open",["jquery","welife","modules/date","modules/popovers","modules/coupon","modules/message-editor"],function(a,b){"use strict";var c=function(){var c,d=a(".mainbody"),e=d.find(".we-step"),f=d.find(".we-alert"),g=d.find(".we-form"),h=g.find(".form-input"),i=g.find(".input-skip"),j=h.find(".input-name"),k=h.find(".coupon-list"),l=h.find(".input-coupon"),m=h.find(".input-start-date"),n=h.find(".input-end-date"),o=g.find(".form-next"),p=o.find(".input-type"),q=o.find(".input-content"),r=g.find(".form-output"),s=g.find(".form-output-template").text(),t=!0,u={},v={coupon:function(){return 0===k.children().length?(b.msg("请设置赠券",4),!1):!0}};d.on("click","[data-toggle^='activity']",function(){var b=a(this),d=b.data(),w=d.toggle.replace("activity.","");switch(c=w,w){case"next":t=!0,i.val("false");break;case"skip":t=!1,i.val("true"),f.addClass("hide"),e.find("li:eq(1)").addClass("active"),h.addClass("hide"),o.removeClass("hide");break;case"prev":f.removeClass("hide"),e.removeClass("hide").find("li:eq(1)").removeClass("active"),h.removeClass("hide"),o.addClass("hide"),r.addClass("hide");break;case"save":if(!v.message())break;t&&(u.coupons=[],l.val(function(){var b=[];return k.find("li").each(function(){var c=a(this),d=a(this).data();d.value&&(d=a.extend({},d),d.name=String(d.name).replace(/^\d+\u5143/,"")),u.coupons.push(d),d.count=c.find(".coupon-input").val(),b.push(d.id+","+d.count)}),b.join(";")}),u.name=j.val(),u.startDate=m.val(),u.endDate=n.val()),u.messageType=p.data("typeName"),u.messageContent=q.data("content"),r.empty().html(_.template(s,u)),e.addClass("hide"),o.addClass("hide"),r.removeClass("hide");break;case"confirm":g.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":e.removeClass("hide"),o.removeClass("hide"),r.addClass("hide")}}),v.message=function(){return q.val()?!0:(b.msg("消息内容不能为空",4),!1)},j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),g.submitter({isValidated:function(){return"next"===c?j.validate("validate")&&v.coupon():v.message()},done:function(a){b.respond(a,{success:function(){"next"===c&&(f.addClass("hide"),e.find("li:eq(1)").addClass("active"),h.addClass("hide"),o.removeClass("hide"))}})}}),b.date(d,{startDate:new Date,endViewDate:function(a){return new Date(a.getFullYear()+1,a.getMonth(),a.getDate())}(new Date)}),b.popoverNotice(d),b.couponEditor(d),b.messageEditor(d)};return c}),define("activity/opened",["jquery","welife","modules/date","modules/coupon","modules/shop","modules/popovers","modules/message-editor","modules/sms-editor"],function(a,b){"use strict";
var c=function(b,c){this.$element=a(b?b:".mainbody"),this.options=a.isPlainObject(c)?c:{},this.toggle="",this.shopRequired=!1,this.msgInitialized=!1,this.msgRequired=!1,this.smsInitialized=!1,this.smsRequired=!1,this.smsExceeded=!1,this.init()},d=c.prototype;return d.init=function(){var c=this,d=this.$element,e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),h=f.find(".coupon-list"),i=f.find(".input-shop"),j=f.find(".input-number"),k=e.find(".form-next"),l=k.find(".input-message"),m=k.find(".editor-input"),n=k.find(".input-short-message"),o=e.find(".form-output");this.$name=g,this.$list=h,this.$shop=i,this.$coupon=f.find(".input-coupon"),this.$date=f.find(".input-date"),this.$time=f.find(".input-time"),this.$message=l,this.$shortMessage=n,this.$next=k,this.$output=o,this.outputTemplate=e.find(".form-output-template").text(),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),i.length&&(this.shopRequired=!0),d.on("click","[data-toggle^='activity']",function(){var d=a(this),g=d.data(),h=g.toggle.replace("activity.","");switch(c.toggle=h,h){case"save":if(c.msgInitialized&&c.msgRequired){if(!l.val()){b.msg("请输入微信消息",4);break}if("true"===m.prop("contenteditable")&&!m.data("valid")){b.msg("微信消息字数超出限制",4);break}if(c.smsInitialized&&c.smsRequired){if(!n.val()){b.msg("请输入短信消息",4);break}if(c.smsExceeded){b.msg("本次预计扣费超过账户短信余额，不能发送",4);break}}}c.output(),f.addClass("hide"),k.addClass("hide"),o.removeClass("hide");break;case"prev":f.removeClass("hide"),k.addClass("hide");break;case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":c.msgInitialized?k.removeClass("hide"):f.removeClass("hide"),o.addClass("hide")}}),e.submitter({isValidated:function(){return g.validate("validate")?0===h.children().length?(b.msg("请设置赠券",4),!1):!0:!1},done:function(a){b.respond(a,{success:function(){"next"===c.toggle&&(f.addClass("hide"),k.removeClass("hide"),c.msgInitialized||c.initMessage())}})}}),b.couponEditor(d),b.date(d,{startDate:new Date}),this.shopRequired?(b.shop(d),i.on("change.we.shop",function(){j.data("value",a(this).val()),c.getShopMembers(j.data(),function(a){j.text(a)})}).trigger("change.we.shop")):this.getShopMembers(j.data(),function(a){j.text(a)})},d.initMessage=function(){var c=this,d=this.$element,e=this.$next,f=e.find(".msg-toggle"),g=e.find(".msg-section"),h=g.find(".sms-toggle"),i=g.find(".sms-section");this.msgInitialized||(this.msgRequired=!0,this.msgInitialized=!0,this.$smsSection=i,b.popoverNotice(d),b.messageEditor(d),g.collapse({toggle:!1}),i.collapse({toggle:!1}),f.find(".we-radio").on("checked.we.radio",function(){var b=1===a(this).data("value");c.msgRequired=b,g.collapse(b?"show":"hide")}).filter(".checked").trigger("checked.we.radio"),h.on("change.we.checkbox",function(){var b=a(this).hasClass("checked");c.smsRequired=b,i.collapse(b?"show":"hide"),c.smsInitialized||c.initShortMessage()}).trigger("change.we.checkbox"))},d.initShortMessage=function(){function c(a){"number"==typeof a?m.count=a:a=m.count,m.total=m.people*a,m.charge=(m.total*m.rate).toFixed(2),i.text(a),j.text(m.total),k.text(m.charge),l.toggleClass("hide",!(e.smsExceeded=m.charge>m.balance))}function d(a){m.people=a,h.text(a),c()}var e=this,f=this.$element,g=this.$smsSection,h=g.find("[data-sms='people']"),i=g.find("[data-sms='count']"),j=g.find("[data-sms='total']"),k=g.find("[data-sms='charge']"),l=g.find(".sms-notice"),m={rate:parseFloat(g.find("[data-sms='rate']").text())||0,balance:parseFloat(g.find("[data-sms='balance']").text())||0,people:parseInt(h.text(),10)||0,count:0,total:0,charge:0};this.smsInitialized||(this.smsInitialized=!0,this.sms=m,this.shopRequired?this.$shop.on("change.we.shop",function(){h.data("value",a(this).val()),e.getShopMembers(h.data(),d)}).trigger("change.we.shop"):this.getShopMembers(h.data(),d),b.smsEditor(f,{change:c}))},d.getShopMembers=function(c,d){a.isPlainObject(c)&&(c.name&&(c[String(c.name)]=c.value),a.ajax(c.url,{async:!1,type:"POST",data:c,dataType:"json",success:function(c){b.respond(c,{success:function(){var b=c.result;a.isPlainObject(b)&&a.isFunction(d)&&d(b.members||0)}})}}))},d.output=function(){var b=this,c={name:this.$name.val(),coupons:[],date:this.$date.val(),time:this.$time.val(),shop:this.shopRequired?this.$shop.closest(".form-group").hasClass("hide")?"":this.$shop.data("shop"):"",message:this.msgRequired?this.$message.data("content"):"",shortMessage:this.msgRequired&&this.smsRequired?this.$shortMessage.val():"",charge:this.msgRequired&&this.smsRequired?this.sms.charge:""};this.$coupon.val(function(){var d=[];return b.$list.find("li").each(function(){var b=a(this),e=a.extend({},b.data());e.value&&(e.name=String(e.name).replace(/^\d+\u5143/,"")),e.count=b.find(".coupon-input").val(),c.coupons.push(e),d.push([e.id,e.count].join())}),d.join(";")}),this.$output.empty().html(_.template(this.outputTemplate,c))},c}),define("activity/perfect",["jquery","welife","modules/coupon","modules/popovers","modules/text-editor"],function(a,b){"use strict";var c=function(){var c,d=a(".mainbody"),e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),h=f.find(".coupon-list"),i=f.find(".input-coupon"),j=f.find(".input-restriction"),k=e.find(".form-output"),l=d.find(".existed-modal"),m=l.data("existed"),n=e.find(".form-output-template").text(),o={},p={coupon:function(){return 0===h.children().length?(b.msg("请设置赠券",4),!1):!0}};m&&d.find("button[data-toggle='activity.save']").attr("type","button"),d.on("click","[data-toggle^='activity']",function(){var b=a(this),d=b.data(),g=d.toggle.replace("activity.","");switch(c=g,g){case"save":m&&l.modal("show");break;case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":f.removeClass("hide"),k.addClass("hide")}}),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),e.submitter({isValidated:function(){return m?!1:g.validate("validate")&&p.coupon()},done:function(d){b.respond(d,{success:function(){"save"===c&&(o.coupons=[],i.val(function(){var b=[];return h.find("li").each(function(){var c=a(this),d=a(this).data();d.value&&(d=a.extend({},d),d.name=String(d.name).replace(/^\d+\u5143/,"")),o.coupons.push(d),d.count=c.find(".coupon-input").val(),b.push(d.id+","+d.count)}),b.join(";")}),o.name=g.val(),o.restriction=j.val(),k.empty().html(_.template(n,o)),f.addClass("hide"),k.removeClass("hide"))}})}}),b.couponEditor(d),b.popoverNotice(d),b.textEditor(d)};return c}),define("activity/total",["jquery","welife","modules/date","modules/shop","modules/coupon","modules/popovers","modules/text-editor","modules/time-range-selector"],function(a,b){"use strict";var c=function(){var c,d=a(".mainbody"),e=d.find(".we-alert"),f=d.find(".we-form"),g=f.find(".form-input"),h=g.find(".input-name"),i=g.find(".input-type"),j=g.find(".input-amount"),k=g.find(".coupon-list"),l=g.find(".input-coupon"),m=g.find(".input-time-range"),n=g.find(".input-shop"),o=g.find(".input-restriction"),p=f.find(".form-output"),q=f.find(".form-output-template").text(),r={},s={coupon:function(){return 0===k.children().length?(b.msg("请设置赠券",4),!1):!0}};d.on("click","[data-toggle^='activity']",function(){var b=a(this),d=b.data(),h=d.toggle.replace("activity.","");switch(c=h,h){case"confirm":f.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":g.removeClass("hide"),e.removeClass("hide"),p.addClass("hide")}}),h.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),j.validate(),i.on("change",function(){"次"===i.find(":selected").data("unit")?j.prop("max",20).validate("update"):j.prop("max",999999).validate("update")}),o.validate({filter:function(){return a(this).data("text")}}),f.submitter({isValidated:function(){return h.validate("validate")&&j.validate("validate")&&s.coupon()&&o.validate("validate")},done:function(d){b.respond(d,{success:function(){"save"===c&&(r.startDate=g.find(".input-start-date").val(),r.endDate=g.find(".input-end-date").val(),r.timeRange="",m.length&&(r.timeRange=function(){var b=[];return g.find(".time-range-item").each(function(){b.push(a(this).val())}),m.val(b.join()),b.length?b.join(" / "):""}()),r.coupons=[],l.val(function(){var b=[];return k.find("li").each(function(){var c=a(this),d=a(this).data();d.value&&(d=a.extend({},d),d.name=String(d.name).replace(/^\d+\u5143/,"")),r.coupons.push(d),d.count=c.find(".coupon-input").val(),b.push(d.id+","+d.count)}),b.join(";")}),r.name=h.val(),r.amount=j.val(),i.length&&(r.amountUnit=g.find(".condition-unit").text()),r.shop=n.closest(".form-group").hasClass("hide")?"":n.data("shop"),r.restriction=o.val(),p.empty().html(_.template(q,r)),g.addClass("hide"),e.addClass("hide"),p.removeClass("hide"))}})}}),b.popoverNotice(d),b.couponEditor(d),b.date(d,{startDate:new Date,endViewDate:function(a){return new Date(a.getFullYear()+1,a.getMonth(),a.getDate())}(new Date)}),b.shop(d,!0),b.textEditor(d),b.timeRange()};return c}),define("coupon/add",["jquery","welife","modules/date","modules/popovers","modules/shop","modules/text-editor"],function(a,b){"use strict";var c=function(){var c,d=a(".mainbody"),e=d.find(".we-form"),f=e.find(".form-input"),g=e.find(".coupon-list"),h=e.find(".input-value"),i=e.find(".input-name-prefix"),j=e.find(".input-name"),k=e.find(".input-term"),l=e.find(".term-absolute"),m=e.find(".term-relative"),n=m.find(".input-term-count"),o=e.find(".input-shop"),p=e.find(".input-restriction"),q=e.find(".form-output"),r=e.find(".form-output-template").text(),s={},t={coupon:function(){return 0===g.children().length?(b.msg("请设置赠券",4),!1):!0}};t.count=function(){return m.is(":visible")?n.validate("validate"):!0},m.is(":visible")&&(m.data("active",!0),n.validate()),l.is(":visible")&&(l.data("active",!0),b.date(d,{startDate:new Date})),d.on("click","[data-toggle^='coupon']",function(){var e=a(this),g=e.data(),h=g.toggle.replace("coupon.","");switch(c=h,h){case"relative":m.removeClass("hide"),l.addClass("hide"),m.data("active")||(m.data("active",!0),n.validate()),m.parent().find(".highlight").addClass("hide");break;case"absolute":m.addClass("hide"),l.removeClass("hide"),l.data("active")||(l.data("active",!0),b.date(d,{startDate:new Date})),l.parent().find(".highlight").addClass("hide");break;case"cancel":f.removeClass("hide"),q.addClass("hide")}}),h.validate(),h.on("keyup change",function(){var b=parseInt(a(this).val(),10);i.text(b&&b>0?b+"元":"")}),j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),p.validate({filter:function(){return a(this).data("text")}}),b.popoverNotice(d),b.shop(d),b.textEditor(d),e.submitter({isValidated:function(){return(!h.length||h.validate("validate"))&&j.validate("validate")&&t.count()&&p.validate("validate")?j.validate("validate")&&p.validate("validate"):void 0},done:function(e){b.respond(e,{success:function(){"save"===c&&(k.val(function(){var b=a(this).val();return m.hasClass("hide")?l.hasClass("hide")||(b=["absolute",l.find(".input-term-start").val(),l.find(".input-term-end").val()]):b=["relative",m.find(".input-term-count").val(),m.find(".input-term-unit").val()],a.isArray(b)?b.join():b}),s.value=h.val(),s.name=j.val(),s.term=k.val().split(/\s*\,\s*/),s.shop=o.closest(".form-group").hasClass("hide")?"":o.data("shop"),s.restriction=p.val(),q.html(_.template(r,s)),f.addClass("hide"),q.removeClass("hide"))},error:function(){d.find("[data-toggle='coupon.cancel']").click()}})}})};return c}),define("coupon/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".voucher-list"),e=c.find(".voucher-modal"),f=e.find(".voucher-detail"),g=_.template(e.find("#voucher-detail-template").text());d.on("click","[data-toggle='voucher.detail']",function(b){var c=a(this).closest("li").data();b.preventDefault(),c=a.extend({},c),c.name=c.value?String(c.name).replace(/^\d+\u5143/,""):c.name,c.term=c.term.split(/\s*\,\s*/),f.html(g(c)),e.modal("show")}),b.popoverConfirm({message:"确定要删除此券么？",confirm:function(){var c=a(this),d=c.data("id");a.ajax(b.DEFAULTS.ajaxDeleteUrl,{async:!1,type:"POST",data:{id:d},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}})};return c}),define("message/add",["jquery","welife","modules/date","modules/message-editor"],function(a,b){"use strict";var c=function(){function c(){return console.log(i.val()),i.val()?"true"!==j.prop("contenteditable")||j.data("valid")?!0:(b.msg("消息内容字数超出限制",4),!1):(b.msg("消息内容不能为空",4),!1)}var d=a(".mainbody"),e=d.find("form"),f=e.find(".form-input"),g=e.find(".input-date"),h=e.find(".input-time"),i=e.find(".input-content"),j=e.find(".editor-input"),k=e.find(".send-remain-note > b"),l=e.find("[data-toggle='message.save']"),m=e.find(".form-output"),n=_.template(e.find(".form-output-template").text()),o={};d.on("click","[data-toggle^='message']",function(){var b=a(this),d=b.data(),e=d.toggle.replace("message.","");if(!b.hasClass("disabled")&&!b.prop("disabled"))switch(e){case"save":if(!c())break;o.date=g.val(),o.time=h.val(),o.content=i.data("content"),m.empty().html(n(o)),f.addClass("hide"),m.removeClass("hide");break;case"cancel":f.removeClass("hide"),m.addClass("hide")}}),g.on("changeDate",function(){var b=a(this);a.ajax(b.data("url"),{type:"POST",data:{date:b.val(),oldDate:b.data("oldDate")},dataType:"json",success:function(a){var b;0===a.errcode?(b=a.result.number,b&&b>0?l.removeClass("disabled").prop("disabled",!1):a.result.savable?l.removeClass("disabled").prop("disabled",!1):(l.addClass("disabled").prop("disabled",!0),b=0),k.text(b)):console.log(a.errmsg)}})}),e.submitter({disableAfterDone:!0,isValidated:function(){return c()},done:function(a){b.respond(a)}}),b.messageEditor(d),b.date(d,{startDate:new Date})};return c}),define("message/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".message-modal"),e=d.find(".message-detail"),f=_.template(d.find(".message-detail-template").text());c.on("click","[data-toggle^='message']",function(b){var c,g=a(this),h=g.data(),i=h.toggle.replace("message.","");switch(b.preventDefault(),i){case"detail":c=g.closest("tr"),h=c.data(),h.type>0&&(h.content=c.find(".message-content").html()),e.empty().html(f(h)),d.modal("show")}}),b.popoverConfirm({message:"确定删除该消息？",confirm:function(){var c=a(this),d=c.data();a.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}})};return c}),define("material/add",["jquery","welife","ZeroClipboard","modules/uploader"],function(a,b,c){"use strict";window.ZeroClipboard=c;var d=function(){function c(){!G&&window.UE&&a.isFunction(UE.getEditor)&&(console.log("Ueditor initialized!"),G=UE.getEditor("inputContent",{toolbars:[["bold","italic","underline","|","insertorderedlist","insertunorderedlist","|","simpleupload","|","removeformat","forecolor","backcolor"]],initialFrameWidth:500,initialFrameHeight:200,autoHeightEnabled:!1,autoFloatEnabled:!1,enableAutoSave:!1,saveInterval:6e4,maximumWords:2e4,elementPathEnabled:!1}),G.ready(function(){b.DEFAULTS.ueditorServerParam&&G.execCommand("serverparam",b.DEFAULTS.ueditorServerParam),H(),I()}))}var d=a(".mainbody"),e=d.find(".material"),f=e.data(),g=e.offset().top,h=e.find(".material-item").length>0?5:6,i=e.find(".material-mini-template").text(),j=d.find("form"),k=j.find(".material-editor"),l=j.find("#inputTitle"),m=j.find("#inputImage"),n=j.find("#inputImageId"),o=j.find(".we-file > :file"),p=j.find(".image-title"),q=j.find(".thumb-title"),r=j.find(".upload-step-one"),s=j.find(".upload-step-three"),t=j.find("#inputVisible"),u=j.find(".material-summary-toggle"),v=j.find(".material-summary"),w=j.find("#inputSummary"),x=j.find("#inputContent"),y=j.find(".auto-save-info"),z=j.find(".material-link-toggle"),A=j.find(".material-link"),B=j.find("#inputLink"),C=!1,D=!1,E={title:l.attr("name"),image:m.attr("name"),imageId:n.attr("name"),visible:t.attr("name"),summary:w.attr("name"),content:x.attr("name"),link:B.attr("name")},F=e.find(".active"),G=null,H=function(){var b=function(b){return"number"==typeof b||"boolean"==typeof b?b=String(b):"object"==typeof b&&null!==b&&(b=a.isFunction(b.toString)?b.toString():b),b||""};e.find(".material-unit").each(function(){var c=a(this),d=c.data();c.find("[data-view='title']").text(function(){var c=b(d[E.title]);return c?c:a(this).attr("placeholder")}),c.find("[data-view='summary']").html(function(){var a=b(d[E.summary]);return a?a.replace(/[\r\n]+/gim,"<br>"):""}),c.find("[data-view='image']").html(function(){var a=b(d[E.image]);return a?'<img src="'+a+'">':""})})},I=function(){var a=F.data(),b=a[E.title],c=a[E.image],d=a[E.imageId],e=a[E.visible],f=a[E.summary],h=a[E.content],i=a[E.link],j=F.hasClass("material-mini"),y='<img src="'+c+'" alt="">';a&&(k.css("marginTop",F.offset().top-g),l.val(b),p.toggleClass("hide",j),q.toggleClass("hide",!j),r.toggleClass("hide",!!c),s.toggleClass("hide",!c),m.val(c),n.val(d),c?s.find(".upload-view").html(y):(r.find(".help-block").empty(),s.find(".upload-view").empty()),j?o.data("maxsize",20):o.data("maxsize",50),t.parent().toggleClass("checked",e),t.prop("checked",e),u.toggleClass("hide",!!f),v.toggleClass("hide",!f),w.val(f),x.val(h),G.setContent(h),z.toggleClass("hide",!!i),A.toggleClass("hide",!i),B.val(i))},J=function(){var b=j.serializeArray();a.each(b,function(a,b){"on"===b.value&&(b.value=!0),F.data(b.name,b.value)}),F.data(E.visible,!!t.prop("checked"))},K={localStorage:window.localStorage||{getItem:a.noop,setItem:a.noop,removeItem:a.noop},token:b.DEFAULTS.token||"com.dianping.welife",formatDate:function(a){var b=new Date(a),c=[b.getHours(),b.getMinutes(),b.getSeconds()];return a=[b.getFullYear(),b.getMonth()+1,b.getDate()],a[1]=a[1]<10?"0"+a[1]:a[1],a[2]=a[2]<10?"0"+a[2]:a[2],c[0]=c[0]<10?"0"+c[0]:c[0],c[1]=c[1]<10?"0"+c[1]:c[1],c[2]=c[2]<10?"0"+c[2]:c[2],a.join("/")+" "+c.join(":")},getData:function(){var b=this.localStorage.getItem("localMaterial");try{"string"==typeof b&&(b=JSON.parse(b))}catch(c){console.log(c.message)}return b=a.isPlainObject(b)?b:{}},setData:function(a){try{(a.single.messages||a.multiple.messages)&&(a={}),"string"!=typeof a&&(a=JSON.stringify(a))}catch(b){console.log(b.message)}this.localStorage.setItem("localMaterial",a)},getOriginalMaterial:function(){var a;return a=5===h?{messages:[{link:"",content:"",visible:!0,image:"",title:"",imageId:"",summary:""}]}:{messages:[{link:"",content:"",visible:!0,image:"",title:"",imageId:""},{link:"",content:"",visible:!0,image:"",title:"",imageId:""}]}},setMaterial:function(){var b,c,d,g,i=e.find(".material-unit"),j=this.getData(),k=new Date,l=this.formatDate(k);return j.token!==this.token&&(j={token:this.token,single:{create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()},multiple:{create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()}}),J(),D=!1,c=5===h?"single":"multiple",d=f.id?"modify":"create",b=j[c],a.isPlainObject(b)?b=b[d]:(j[c]={create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()},b=j[c][d]),a.isPlainObject(b)||(b=j[c][d]={messages:[]}),i.each(function(c){var d=a(this).data();_.isEqual(d,b.messages[c])||(D=!0,b.id=f.id,b.date=k,b.messages[c]=d)}),i.length<b.messages.length&&(D=!0,b.messages=b.messages.slice(0,i.length)),this.setData(j),D&&(g="（自动保存："+l+"）",y.text(g)),g},removeMaterial:function(){var b,c,d=this.getData();d.token===this.token&&(b=5===h?"single":"multiple",c=f.id?"modify":"create",a.isPlainObject(d[b])&&(d[b][c]=this.getOriginalMaterial()),this.setData(d),y.empty())},restoreMaterial:function(){var b,c,d,g,j,k,l=this.getData(),m="";if(l.token===this.token){if(j=5===h?"single":"multiple",k=f.id?"modify":"create",b=l[j],a.isPlainObject(b)&&(b=b[k]),a.isPlainObject(b)||(b={messages:[]}),!f.id||f.id===b.id){if(6===h){for(g=b.messages.length,g>8&&(g=8),8===g&&e.find(".material-add").addClass("hide"),g-=e.find(".material-unit").length;g>0;)m+=i,g--;e.find(".material-add").before(m)}e.find(".material-unit").each(function(e){var f=a(this),g=b.messages[e];a.isPlainObject(g)&&(d=!0,c=b.date,a.each(g,function(a,b){f.data(a,b)}))})}d&&c&&(c=this.formatDate(c),y.html(function(){return"<span>（已载入 "+c+' 的草稿）</span><a href="javascript:void(0);" data-toggle="material.reset">取消</a>'}))}},autoSaveMaterial:function(){this.autoSave=setInterval(function(){K.setMaterial()},12e4)},destroy:function(){this.autoSave&&clearInterval(this.autoSave)}};K.restoreMaterial(),K.autoSaveMaterial(),require(["ueditorConfig","ueditor"],function(){var a=3,b=function(){console.log("Ueditor initializing!"),c(),a-->0&&!G&&setTimeout(b,1e3)};b()}),l.on("keyup blur",function(){var b=a(this),c=F.find("[data-view='title']"),d=a.trim(b.val());c.text(d?d:c.data("placeholder")),b.val(d)}),w.on("keyup blur",function(){var b=a(this).val();b=b.replace(/[\r\n]+/gim,"<br>"),F.find("[data-view='summary']").html(b)}),b.uploader({done:function(a){F.find("[data-view='image']").html('<img src="'+a.url+'">')},fail:function(){F.find("[data-view='image']").empty()}}),6===h&&e.find(".material-unit").length>2&&e.find(".material-mini").find(".icon-remove").removeClass("disabled"),d.on("click","[data-toggle^='material']",function(c){var d,g,j=a(this),k=j.data(),l=k.toggle.replace("material.",""),m=!0;if(c.preventDefault(),!j.prop("disabled")&&!j.hasClass("disabled"))switch(l){case"summary":u.addClass("hide"),v.removeClass("hide");break;case"link":z.addClass("hide"),A.removeClass("hide");break;case"modify":J(),g=j.closest(".material-unit"),j.addClass("disabled"),e.find(".active").removeClass("active").find(".icon-modify").removeClass("disabled"),F=g,F.addClass("active"),I();break;case"remove":g=j.closest(".material-unit"),J(),F=g.prev(),F.addClass("active"),I(),g.remove(),d=e.find(".material-unit"),d.length<=2&&d.find(".icon-remove").addClass("disabled"),d.length<8&&e.find(".material-add").removeClass("hide");break;case"add":J(),d=e.find(".material-unit"),g=j.parent(),d.length>=2&&d.filter(".material-mini").find(".icon-remove").removeClass("disabled"),d.length>=7&&g.addClass("hide"),d.filter(".active").removeClass("active").find(".icon-modify").removeClass("disabled"),F=a(i),F.addClass("active"),g.before(F),I();break;case"save":J(),a.extend(k,f),k.type=k.type||h,k.messages=[],d=e.find(".material-unit"),d.each(function(c){var d,e=a(this).data();return e.title?e.image?e.content||(d="%s正文不能为空"):(d="%s封面图片不能为空",6===h&&c>0&&(d="%s缩略图不能为空")):d="%s标题不能为空",d?(m=!1,d=d.replace("%s",5===h?"":"第"+(c+1)+"条消息的"),b.msg(d,4),!1):void k.messages.push(e)}),m&&a.ajax(k.url,{type:"POST",data:k,dataType:"json",beforeSend:function(){j.prop("disabled",!0).addClass("disabled")},success:function(a){0===a.errcode?(b.msg(a.errmsg,2),C=!0,K.removeMaterial(),K.destroy(),b.assign(a.returnurl||a.redirect)):(b.msg(a.errmsg,5),j.prop("disabled",!1).removeClass("disabled"))},complete:function(){}});break;case"reset":K.removeMaterial(),C=!0,b.reload(100)}}),a(window).on("beforeunload",function(){var a;return!C&&(a=K.setMaterial(),D)?a||"页面即将跳转……":void 0})};return d}),define("material/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){b.popoverConfirm({message:"确定删除该素材？",confirm:function(){var c=a(this),d=c.data();a.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}}),b.popoverConfirm({namespace:".edit",message:"确定编辑该素材？",confirm:function(){var b=a(this),c=b.data("url")||b.attr("href");c&&window.location.assign(c)}})};return c}),define("sms/add",["jquery","welife","modules/date","modules/shop","modules/sms-editor"],function(a,b){"use strict";var c=function(){function c(a){"number"==typeof a?t.count=a:a=t.count,t.total=t.people*a,t.charge=(t.total*t.rate).toFixed(2),q.text(a),r.text(t.total),s.text(t.charge),t.charge>t.balance?(v.addClass("disabled"),u.removeClass("hide")):(v.removeClass("disabled"),u.addClass("hide"))}function d(d){var e;d&&p.data("value",d),e=p.data(),e[e.name]=e.value,a.ajax(e.url,{async:!1,type:"POST",data:e,dataType:"json",success:function(d){b.respond(d,{success:function(){var b=d.result;a.isPlainObject(b)&&(p.text(t.people=b.members||0),c())}})}})}var e=a(".mainbody"),f=e.find("form"),g=f.find(".radio-group > .we-radio"),h=f.find(".we-date-group"),i=f.find(".input-date"),j=f.find(".input-time"),k=f.find(".input-shop"),l=f.find(".input-content"),m=f.find(".sms-charge"),n=m.find("[data-expicted='rate']"),o=m.find("[data-expicted='balance']"),p=m.find("[data-expicted='people']"),q=m.find("[data-expicted='count']"),r=m.find("[data-expicted='total']"),s=m.find("[data-expicted='charge']"),t={rate:parseFloat(n.text())||0,balance:parseFloat(o.text())||0,people:parseInt(p.text(),10)||0,count:0,total:0,charge:0},u=f.find(".sms-notice"),v=f.find("[data-toggle='message.save']"),w=e.find(".message-modal"),x=w.find(".message-detail"),y=w.find("#message-detail-template").text();b.date(e,{startDate:new Date}),b.shop(e),b.smsEditor(e,{change:c}),d(),k.on("change.we.shop",function(){d(k.val())}),g.on("checked.we.radio",function(){1===a(this).data("value")?h.removeClass("hide"):h.addClass("hide")}),e.on("click","[data-toggle^='message']",function(){var c=a(this),d=c.data(),e=d.toggle.replace("message.","");switch(e){case"save":if(t.people<=0){b.msg("预计发送人数为0，不能发送",4);break}if(!l.validate("validate"))break;d={content:l.val(),people:t.people,count:t.count},d.total=d.people*d.count,d.charge=(.1*d.total).toFixed(2),d.time=0===g.filter(".checked").data("value")?"立即发送":[i.val(),j.val()].join(" "),x.html(_.template(y,d)),w.modal("show")}}),f.submitter({isValidated:function(){return!0},done:function(a){b.respond(a,{success:function(){w.modal("hide")}})}})};return c}),define("sms/invoice",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find("form");d.submitter({done:function(a){b.respond(a)}})};return c}),define("sms/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".message-modal"),e=d.find(".message-detail"),f=d.find("#message-detail-template").text();c.on("click","[data-toggle^='message']",function(){var b=a(this),c=b.data(),g=c.toggle.replace("message.","");switch(g){case"detail":e.html(_.template(f,b.closest("tr").data())),d.modal("show")}}),b.popoverConfirm({message:"确定要删除么？",confirm:function(){var c=a(this),d=c.data();a.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}})};return c}),define("sms/recharge",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find("form"),e=d.find(".input-amount"),f=d.find(".input-payment"),g=c.find(".recharge-modal"),h=g.find(".recharge-pay-form"),i=c.find(".recharge-result-modal"),j=i.find(".modal-footer > a"),k=g.find(".recharge-detail"),l=g.find("#recharge-detail-template").text();e.validate(),c.on("click","[data-toggle^='recharge']",function(){var c=a(this),d=c.data(),e=d.toggle.replace("recharge.","");switch(e){case"pay":g.modal("hide"),i.modal({keyboard:!1,backdrop:"static",show:!1}).modal("show");break;case"result":b.assign(d.url+"?"+a.param(d),0)}}),d.submitter({isValidated:function(){return e.validate("validate")},done:function(c){a.isPlainObject(c)&&(0===c.errcode?(h.attr("action",c.result.url),j.data("id",c.result.id),k.html(_.template(l,{amount:e.val(),payment:f.filter(".checked").data("payment")})),g.modal({keyboard:!1,backdrop:"static",show:!1}).modal("show")):b.msg(c.errmsg,5))}})};return c}),define("recharge/set",["jquery","welife","modules/text-editor","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".we-form"),e=d.find(".form-start"),f=d.find(".prepaid-state"),g=f.data("prepaidState"),h=f.find(".prepaid-open"),i=f.find(".prepaid-close"),j=d.find(".prepaid-popover"),k=d.find(".form-input"),l=d.find(".prepaid-rule-list"),m=d.find(".prepaid-rule-template").text(),n=d.find(".prepaid-term"),o=d.find(".prepaid-restriction"),p=d.find(".form-output"),q=d.find(".form-output-template").text(),r={},s=function(){var c=!0;return l.find("input[type='number']").each(function(){var d,e=a(this),f=a.trim(e.val()),g=parseFloat(f)||0,h=parseFloat(e.attr("min"))||0;return f?h>g?d="请输入不小于"+h+"的整数":g%1>0&&(d="请输入正整数"):d="请输入赠送金额",d?(this.focus(),b.msg(d,4),c=!1):void 0}),c},t=function(){var b=[],c=!0;return l.find(".prepaid-note").addClass("hide"),l.find(".prepaid-value").each(function(d){var e=a(this),f=parseInt(e.val(),10);d>0&&a.each(b,function(a,b){f==b&&(c=!1,e.parent().find(".prepaid-note").removeClass("hide"))}),b.push(f)}),c},u=function(){l.find("input").prop("disabled",!0),l.find("button").prop("disabled",!0).addClass("disabled"),n.find(".we-radio").addClass("disabled"),n.find(".form-control").prop("disabled",!0),d.find(".editor-input").prop("contenteditable",!1).addClass("disabled"),d.find("button[data-toggle='prepaid.save']").data("disabled",!0).text("修改")},v=function(){l.find("input").prop("disabled",!1),l.find("button").prop("disabled",!1).removeClass("disabled"),n.find(".we-radio").removeClass("disabled"),n.find(".form-control").prop("disabled",!1),d.find(".editor-input").prop("contenteditable",!0).removeClass("disabled"),d.find("button[data-toggle='prepaid.save']").data("disabled",!1).text("保存")};"open"===g?(h.find(".we-radio").radio("check"),i.removeClass("disabled").find(".we-radio").radio("uncheck").addClass("disabled"),j.removeClass("in"),k.removeClass("hide"),o.validate()):i.addClass("disabled"),f.find(".we-radio").on("checked.we.radio",function(b){var c=a(this),d=c.data("state");if("open"===d)j.collapse("hide"),k.removeClass("hide");else if("close"===d){if(!c.parent().hasClass("disabled"))return void b.preventDefault();j.collapse("show"),k.addClass("hide"),p.addClass("hide")}}),l.find(".prepaid-value").on("change",t),l.on("click","[data-toggle^='rule']",function(b){var c,d,e,f,g,h=a(this),i=h.data("toggle").replace("rule.","");b.preventDefault(),h.hasClass("disabled")||("add"===i?(c=a(m),c.find(".prepaid-value").on("change",t),l.append(c),h.addClass("hide"),h.siblings(".prepaid-del").removeClass("hide"),e=l.children(),e.length>=10&&e.last().find(".prepaid-add").addClass("hide")):"del"===i&&(d=h.closest("li"),f=d.prev(),g=d.next(),d.empty().remove(),g.length||f.find(".prepaid-add").removeClass("hide"),e=l.children(),e.length<2&&e.first().find(".prepaid-del").addClass("hide"),e.length<10&&e.last().find(".prepaid-add").removeClass("hide")))}),c.on("click","[data-toggle^='prepaid']",function(){var b=a(this),c=b.data(),d=c.toggle.replace("prepaid.","");if(!b.hasClass("disabled"))switch(d){case"save":if(b.data("disabled")){v();break}if(!(t()&&s()&&o.validate("validate")))return;r.rules=[],l.children().each(function(){var b=a(this);r.rules.push({prepaid:b.find(".prepaid-value").val(),present:b.find(".present-value").val()})}),r.term=function(){var a=n.find(":radio:checked"),b=Number(a.val()),c=[];return 0===b?c.push(0):1===b&&(c.push(1),c.push(a.siblings(".prepaid-term-count").val()),c.push(a.siblings(".prepaid-term-unit").find(":selected").text())),c}(),r.restriction=o.val(),p.empty().html(_.template(q,r)),e.addClass("hide"),k.addClass("hide"),p.removeClass("hide");break;case"cancel":e.removeClass("hide"),k.removeClass("hide"),p.addClass("hide")}}),b.textEditor(c),b.popoverConfirm({message:"确定关闭储值功能？",confirm:function(){var b=a(this),c=b.data();a.ajax(c.url,{async:!1,type:"POST",data:{close:!0},dataType:"json",success:function(a){0===a.errcode?location.reload(!0):console.log(a.errmsg)}})}}),"open"===g&&u()};return c}),define("point/set",["jquery","welife","ZeroClipboard","modules/text-editor","modules/popovers"],function(a,b,c){"use strict";function d(b){var c=a(b),d=c.find("select[data-month]"),e=c.find("select[data-day]");this.$months=d,this.$days=e,this.month=parseInt(d.data("month"),10)||1,this.day=parseInt(e.data("day"),10)||1,this.fillMonths(),this.fillDays(),d.on("change",a.proxy(this.changeMonth,this))}window.ZeroClipboard=c;var e=function(b,c){this.$element=a(b?b:".mainbody"),this.options=a.isPlainObject(c)?c:{},this.point2gift=!1,this.modulesInitialized=!1,this.ueditorInitialized=!1,this.ueditor=null,this.init()
},f=e.prototype;return f.init=function(){var b=this,c=this.$element,d=c.find(".we-form"),e=d.find(".form-start"),f=d.find(".point-state"),g=f.find(".point-open"),h=f.find(".point-close"),i=d.find(".point-popover"),j=d.find(".form-input"),k=d.find(".form-output");this.$form=d,"open"===f.data("pointState")?(g.find(".we-radio").radio("check"),h.removeClass("disabled").find(".we-radio").radio("uncheck").addClass("disabled"),i.removeClass("in"),e.addClass("hide"),j.addClass("hide"),k.removeClass("hide")):(e.removeClass("hide"),j.addClass("hide"),k.addClass("hide"),h.addClass("disabled")),f.find(".we-radio").on("checked.we.radio",function(c){var d=a(this),e=d.data("state");if("open"===e)i.collapse("hide"),j.removeClass("hide"),b.initModules();else if("close"===e){if(!d.parent().hasClass("disabled"))return void c.preventDefault();i.collapse("show"),j.addClass("hide"),k.addClass("hide")}}),c.on("click","[data-toggle^='point']",function(){var c=a(this),d=c.data(),f=d.toggle.replace("point.","");if(!c.hasClass("disabled"))switch(f){case"modify":e.removeClass("hide"),j.removeClass("hide"),k.addClass("hide"),b.initModules()}})},f.initModules=function(){var c,e,f,g=this,h=this.$element;return this.modulesInitialized?void console.log("Modules initialized!"):(console.log("Modules initializing!"),this.modulesInitialized=!0,c=h.find("[data-toggle='daypicker']"),c.data("daypicker",new d(c[0])),h.find(".point-exchange").find(".we-checkbox").on("change.we.checkbox",function(){var b=a(this),c=b.hasClass("checked");b.siblings(".point-exchange-content").toggleClass("hide",!c),"gift"===b.data("exchange")&&(g.point2gift=c,c&&g.initUeditor())}).checkbox({toggle:!1}).trigger("change.we.checkbox"),e=h.find(".point-baseline"),f=h.find(".instructions"),e.validate(),f.validate(),this.$form.submitter({isValidated:function(){return e.validate("validate")?g.point2gift&&g.ueditor&&!g.ueditor.hasContents()?(b.msg("积分换礼规则不能为空",4),!1):f.validate("validate"):!1},done:function(a){b.respond(a)}}),b.textEditor(h),b.popoverNotice(h),void b.popoverConfirm({message:"确定关闭积分功能？",confirm:function(){var c=a(this),d=c.data();a.ajax(d.url,{async:!1,type:"POST",data:{close:!0},dataType:"json",success:function(a){b.respond(a,{success:function(){b.reload(!0)}})}})}}))},f.initUeditor=function(){var a,c=this;return this.ueditorInitialized?void console.log("Ueditor initialized!"):(console.log("Ueditor initializing!"),void require(["ueditorConfig","ueditor"],function(){c.ueditorInitialized=!0,c.ueditor=a=UE.getEditor("ueditor",{toolbars:[["bold","italic","underline","|","insertorderedlist","insertunorderedlist","|","simpleupload","|","removeformat","forecolor","backcolor"]],initialFrameWidth:500,initialFrameHeight:200,autoHeightEnabled:!1,autoFloatEnabled:!1,enableAutoSave:!1,saveInterval:6e4,maximumWords:500,elementPathEnabled:!1}),a.ready(function(){b.DEFAULTS.ueditorServerParam&&a.execCommand("serverparam",b.DEFAULTS.ueditorServerParam)})}))},d.prototype.getDaysInMonth=function(a){var b=this.months||(this.months=function(a){var b=a%4===0&&a%100!==0||a%400===0;return[31,b?29:28,31,30,31,30,31,31,30,31,30,31]}((new Date).getFullYear()+1));return b[a]},d.prototype.changeMonth=function(){this.month=this.$months.val(),this.day=1,this.fillDays()},d.prototype.fillMonths=function(){this.$months.html(this.getSelectOptions(12,this.month))},d.prototype.fillDays=function(){var a=this.getDaysInMonth(this.month-1);this.$days.html(this.getSelectOptions(a,this.day))},d.prototype.getSelectOptions=function(a,b){for(var c="",d=0;d++<a;)c+='<option value="'+d+'"'+(d===b?" selected":"")+">"+d+"</option>";return c},e}),define("statistic/activity",["jquery","welife","modules/chart","modules/date"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-f.valueOf()})};return c}),define("statistic/common",["jquery","welife","modules/chart","modules/date","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-f.valueOf()}),b.popoverNotice(c)};return c}),define("statistic/market",["jquery","welife","modules/chart","modules/popovers"],function(a,b){"use strict";function c(b){var c=window.sessionStorage,d=c?JSON.parse(c.getItem(b)):[];this.storage=c,this.key=b,this.sessions=a.isArray(d)?d:[]}var d=function(b,c){this.$element=a(b?b:".mainbody"),this.options=a.isPlainObject(c)?c:{},this.init()},e=d.prototype,f=function(a){return(a.couponUsed/a.couponSent*100||0).toFixed(2)},g=function(a,b){return((a.spendValue+a.rechargeValue)*(1-b)-a.couponValue*b||0).toFixed(2)};return e.init=function(){var a=this.$element,b=a.find(".table");this.$input=a.find(".percentage-input"),this.$submit=a.find(".percentage-submit"),this.$output=a.find(".percentage-output"),this.$hidden=a.find(".percentage-hidden"),this.$reserve=a.find(".percentage-reserve"),this.$total=a.find(".total-marketing-earning"),this.$chartCouponUsage=a.find(".chart-coupon-usage"),this.$chartMarketingEarning=a.find(".chart-marketing-earning"),this.$chartDefaultOptions=b.find(".chart-default-options > tr"),this.$chartCustomOptions=b.find(".chart-custom-options > tr"),this.$checkboxes=this.$chartCustomOptions.find(".we-checkbox"),this.$compareBtn=b.find("#compare-btn"),this.refreshing=null,this.percentage=Math.abs(parseInt(this.$input.val(),10)/100)||.4,this.initSession(),this.initComponents(),this.addListeners()},e.initSession=function(){var b=new c("chartOptions"),d=[],e=[];this.$chartDefaultOptions.each(function(){d.push(a(this).data())}),this.$chartCustomOptions.each(function(){var c=a(this),f=c.find(".we-checkbox"),g=c.data();b.size()?a.each(b.sessions,function(a,b){return b.id===g.id?(f.checkbox("check"),!1):void 0}):a.each(d,function(a,b){return b.id===g.id?(f.checkbox("check"),e.push(b),!1):void 0})}),this.defaultOptions=d,b.size()||a.each(e,function(a,c){b.add(c)}),this.session=b},e.initComponents=function(){b.popoverNotice(this.$element)},e.addListeners=function(){function c(){d&&e&&f.compare()}var d,e,f=this,g=this.session,h=this.$checkboxes,i=this.$compareBtn,j=a.proxy(this.checkInput,this);this.$input.on({keyup:j,change:j,paste:function(){setTimeout(j,50)}}),h.on("check.we.checkbox",function(a){g.size()>=5&&(a.preventDefault(),b.msg("最多选5个",4))}),h.on("checked.we.checkbox",function(){g.add(a(this).closest("tr").data())}).on("unchecked.we.checkbox",function(){g.remove(a(this).closest("tr").data())}),i.on("click",a.proxy(function(){g.size()<2?b.msg("最少选2个",4):this.compare()},this)),this.$chartCouponUsage.on("shown.we.chart",function(){d||(d=!0,c())}),this.$chartMarketingEarning.on("shown.we.chart",function(){e||(e=!0,c())})},e.checkInput=function(){var a=Math.abs(parseInt(this.$input.val(),10))||0;a>100&&(a=a.toString().substr(0,2)),this.$input.val(a),this.$output.text(a),this.$hidden.val(a),this.$reserve.text(100-a)},e.compute=function(){var c=Math.abs(parseInt(this.$input.val(),10)/100)||0;this.percentage=c,this.$chartCustomOptions.each(function(){var d=a(this),e=d.data();a.isPlainObject(e)&&d.find("[data-name='marketing-earning']").text(b.util.formatNumber(g(e,c),2))}),clearTimeout(this.refreshing),this.refreshing=setTimeout(a.proxy(function(){this.compare({couponUsage:!1})},this),200),this.$total.text(function(){return b.util.formatNumber(g(a(this).data(),c),2)})},e.compare=function(b){var c,d,e={couponUsage:!0,marketingEarnings:!0},h=this.session,i=h.size()?h.sessions:this.defaultOptions,j=this.percentage,k=[],l=[],m=[];i.length<2||i.length>5||(a.each(i,function(a,b){k.push(b.name),l.push(f(b)),m.push(g(b,j))}),b=a.extend(e,b),b.couponUsage&&(c=this.$chartCouponUsage.chart("getOptions"),c.xAxis[0].data=k,c.series[0].data=l,this.$chartCouponUsage.chart("setOptions",c)),b.marketingEarnings&&(d=this.$chartMarketingEarning.chart("getOptions"),d.xAxis[0].data=k,d.series[0].data=m,this.$chartMarketingEarning.chart("setOptions",d)))},c.prototype.add=function(b){var c=this.sessions,d=!0;a.isPlainObject(b)&&(a.each(c,function(a,c){return c.id===b.id?d=!1:void 0}),d&&(b.time=b.date?new Date(b.date).valueOf()||0:0,c.push(b)),c.sort(function(a,b){return b.time-a.time}),this.store())},c.prototype.remove=function(b){var c=this.sessions;a.isPlainObject(b)&&(a.each(c,function(a,d){return d.id===b.id?(c.splice(a,1),!1):void 0}),this.store())},c.prototype.size=function(){return this.sessions.length},c.prototype.store=function(){this.storage&&this.storage.setItem(this.key,JSON.stringify(this.sessions))},d}),define("statistic/member",["jquery","welife","modules/chart","modules/date","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-f.valueOf()}),b.popoverNotice(c)};return c}),define("statistic/recharge-settle",["jquery","welife","modules/date","modules/exporter"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-new Date(d.getFullYear(),d.getMonth()-1,d.getDate()-1).valueOf()}),b.exporter(c)};return c}),define("statistic/recharge",["jquery","welife","modules/chart","modules/date","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-f.valueOf()}),b.popoverNotice(c)};return c}),define("statistic/spend",["jquery","welife","modules/chart","modules/date","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate()-1);b.date(c,{endDate:e,customDateRange:e.valueOf()-f.valueOf()}),b.popoverNotice(c)};return c}),define("statistic/trade-spend",["jquery","welife","modules/date","modules/popovers","modules/exporter"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate());b.date(c,{endDate:e,customDateRange:e.valueOf()-new Date(d.getFullYear(),d.getMonth()-1,d.getDate()).valueOf()}),b.exporter(c),b.popoverNotice(c)};return c}),define("account/add",["jquery","welife","modules/shop"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".we-form"),e=d.find("[data-section='role']"),f=e.find(".we-radio"),g=d.find("#inputName"),h=d.find("#inputPhone"),i=d.find("[data-section='shop']"),j=d.find("[data-section='right']"),k=i.find(".shop-toggle"),l=i.find(".shop-checked-ids"),m=i.find(".shop-checked-list"),n=function(){var a=l.val(),b=l.data("shop");return/all/i.test(a)&&(a="",b=""),[a,b]}(),o=function(a){i.is(":hidden")||(a?(k.addClass("hide").text(""),l.val("all").data("shop","全部门店"),m.html("<li>全部门店</li>")):(k.removeClass("hide").text("选择门店"),l.val(n[0]).data("shop",n[1]),m.html(n[1]?"<li>"+n[1]+"</li>":"")))},p=function(){var a=f.filter(".checked").data("role");switch(a){case 1:o(!0),j.addClass("hide");break;case 2:o(),j.addClass("hide");break;case 3:o(),j.removeClass("hide")}};p(),f.on("checked.we.radio",p),g.validate({rules:{name:"name"}}),h.validate({rules:{phone:"phone"}}),b.shop(c),d.submitter({disableAfterDone:!0,isValidated:function(){return i.is(":visible")&&!i.find(".shop-checked-ids").val()?(b.msg("请选择门店",4),!1):g.validate("validate")&&h.validate("validate")},done:function(a){b.respond(a)}})};return c}),define("account/list",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".account-disable-modal"),e=c.find(".account-reset-modal"),f=c.find(".account-reset-success-modal"),g=c.find(".account-conflict-modal");g.data("conflicted")&&g.modal({backdrop:!1,keyboard:!1}),c.on("click","[data-toggle^='account']",function(){var c=a(this),g=c.data(),h=g.toggle.replace("account.","");if(!c.hasClass("disabled"))switch(h){case"disable":d.find("[data-toggle='account.disable.confirm']").data({$toggle:c,account:g}),d.modal();break;case"disable.confirm":g=g.account,a.ajax(g.url,{async:!1,type:"POST",data:{id:g.id},dataType:"json",success:function(a){0===a.errcode?(c.data("$toggle").addClass("disabled"),d.modal("hide"),b.reload()):b.msg(a.errmsg,5)}});break;case"reset":e.find("[data-toggle='account.reset.confirm']").data({$toggle:c,account:g}),e.modal();break;case"reset.confirm":g=g.account,a.ajax(g.url,{async:!1,type:"POST",data:{id:g.id},dataType:"json",success:function(a){0===a.errcode?(c.data("$toggle").addClass("disabled"),e.modal("hide"),f.modal()):b.msg(a.errmsg,5)}})}}),require(["ZeroClipboard"],function(a){var d,e=c.find("#copyToClipboard"),f=e.data();d=new a(e.get(0)),d.on("ready",function(){d.on("aftercopy",function(){b.msg(f.copiedMessage,2)})})})};return c}),define("cardset/set",["jquery","welife","modules/card-selector","modules/color-selector","modules/uploader"],function(a,b){"use strict";var c=function(){function c(){return s.find(".js-uploaded-id").val()?!0:(b.showError(s,"请上传卡面 logo"),!1)}function d(){return t.find(".js-uploaded-id").val()?!0:(b.showError(t,"请上传通用 logo"),!1)}function e(){return u.find(".js-uploaded-id").val()?!0:(b.showError(u,"请上传自定义卡"),!1)}function f(){return v.find(".js-uploaded-id").val()?!0:(b.showError(v,"请上传自定义卡背景图"),!1)}function g(){return w.find(".js-uploaded-id").val()?!0:(b.showError(w,"请上传自定义卡通用 logo"),!1)}var h,i,j=a(".mainbody"),k=j.find(".we-form"),l=k.find("[data-section='type']"),m=l.find(".we-radio"),n=l.find(".card-style-toggle"),o=l.find(".load-card-template"),p=k.find("[data-section='style']"),q=k.find("[data-section='name']"),r=q.find(".we-radio"),s=k.find("[data-section='logo.face']"),t=k.find("[data-section='logo.base']"),u=k.find("[data-section='face']"),v=k.find("[data-section='back']"),w=k.find("[data-section='logo']"),x=k.find("[data-section='color']"),y=function(){switch(h=m.filter(".checked").data("type")){case 1:n.removeClass("hide"),o.addClass("hide"),p.removeClass("hide"),q.removeClass("hide"),u.addClass("hide"),v.addClass("hide"),w.addClass("hide"),x.addClass("hide"),z();break;case 2:n.addClass("hide"),o.removeClass("hide"),p.addClass("hide"),q.addClass("hide"),s.addClass("hide"),t.addClass("hide"),u.removeClass("hide"),v.removeClass("hide"),w.removeClass("hide"),x.removeClass("hide")}},z=function(){switch(i=r.filter(".checked").data("type")){case 1:s.addClass("hide"),t.addClass("hide");break;case 2:s.removeClass("hide"),t.removeClass("hide")}};y(),m.on("checked.we.radio",y),r.on("checked.we.radio",z),b.cardSelector(j),b.colorSelector(j),j.find(".we-uploader").each(function(){var c=a(this),d=c.closest(".form-group");b.uploader(c,{namespace:"."+d.data("section")}),b.popoverNotice(d)}),k.submitter({disableAfterDone:!0,isValidated:function(){var a=!0;return 2===h?a=e()&&f()&&g():2===i&&(a=c()&&d()),a},done:function(a){b.respond(a)}})};return c}),define("autoreply/add",["jquery","welife","modules/keyword-editor","modules/message-editor"],function(a,b){"use strict";var c=function(){function c(){return g.val()?"true"!==h.prop("contenteditable")||h.data("valid")?!0:(b.msg("回复内容字数超出限制",4),!1):(b.msg("回复内容不能为空",4),!1)}var d=a(".mainbody"),e=d.find("form"),f=e.find("#inputName"),g=e.find(".input-content"),h=e.find(".editor-input"),i=e.find(".keyword-list");b.keywordEditor(d),b.messageEditor(d),f.on("change blur",function(){f.val(a.trim(f.val()))}),e.submitter({disableAfterDone:!0,isValidated:function(){return i.find("li").length?c():(b.msg(b.MESSAGES.keyword,4),!1)},done:function(a){b.respond(a)}})};return c}),define("autoreply/list",["jquery","welife","modules/popovers"],function(a,b){"use strict";var c=function(){b.popoverConfirm({message:"确定删除该关键词？",confirm:function(){var c=a(this),d=c.data();a.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(a){b.respond(a,{success:function(){c.addClass("disabled"),b.reload()}})}})}})};return c}),define("code2d/add",["jquery","welife","modules/shop","modules/popovers"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find("form"),e=d.find(".code-data"),f=d.find(".code-list"),g=c.find(".modal"),h={codeId:"",codeName:"",shopOnly:!1,shopId:"",shopName:"",readonly:!1},i=e.val(),j=_.template(d.find(".code-list-template").text()),k=function(c,d){var e,g,h="";a.isArray(c)?(g=c.length,a.each(c,function(a,b){b.index=a,b.length=g,h+=j(b)})):a.isPlainObject(c)&&(g=f.children().length,c.index=g,c.length=g+1,h=j(c)),e=a(h),e.each(function(){var c=a(this);d&&c.find(".input-code-name").prop("readonly",!0),c.find(".we-checkbox").each(function(){var c=a(this),d=b.shop.data||[];c.hasClass("checked")&&1===d.length&&c.siblings(".we-shop-container").addClass("hide")}).on("checked.we.checkbox",function(){var c=a(this).siblings(".we-shop-container"),d=b.shop.data||[];d.length>1?c.removeClass("hide"):1===d.length&&(d=d[0],c.find(".shop-checked-ids").val(d.id).data("shop",d.name),c.find(".shop-checked-list").html("<li>"+d.name+"</li>"))}).on("unchecked.we.checkbox",function(){var b=a(this).siblings(".we-shop-container");b.find(".shop-checked-ids").val("").data("shop",""),b.find(".shop-checked-list").html("<li></li>"),b.find(".shop-toggle").text("选择门店"),b.addClass("hide")}),b.shop(c)}),f.append(e),g=f.children().length,g>1&&f.find(".input-code-del").first().removeClass("hide")},l=function(b){var c=[];a.isArray(b)&&(a.each(b,function(a,b){c.push({codeId:"",codeName:b.name,shopOnly:!0,shopId:b.id,shopName:b.name,readonly:!0})}),k(c,!0))},m=function(){var c,d=f.find("> li > .input-code-name"),e=!0;return d.each(function(b,e){var f=a(this),g=f.val(),h=!1;return!f.prop("readonly")&&(d.each(function(d){var f=a(this);return this!==e&&f.val()===g?(h=!0,c="第 "+(d+1)+" 条二维码的名称与第 "+(b+1)+" 条二维码的名称重复，请修改后重试！",f.focus(),!1):void 0}),h)?!1:void 0}),c&&(e=!1,b.msg(c,4)),e},n=function(){var b=[];f.children().each(function(){var c=a(this),d=c.find(".input-code-id"),e=c.find(".input-code-name"),f=c.find(".input-code-shop-only"),g=c.find(".input-code-shop-id");b.push({codeId:d.val(),codeName:e.val(),shopOnly:f.prop("checked"),shopId:g.val(),shopName:g.data("shop"),readonly:e.prop("readonly")})});try{e.val(JSON.stringify(b))}catch(c){console.log(c.message)}},o=function(){var c,d=f.find(".we-checkbox");return d.each(function(b){var d=a(this);return d.hasClass("checked")&&!d.parent().find(".shop-checked-ids").val()?(c="第 "+(b+1)+" 条二维码（店内二维码）请选择门店",!1):void 0}),c?(b.msg(c,4),!1):!0};a.ajax(d.find("a[data-toggle='code.bulk']").data("url"),{async:!1,dataType:"json",success:function(a){0===a.errcode?b.shop.data=a.result:console.log(a.errmsg)}}),k(function(b){try{b=a.parseJSON(b)}catch(c){b=null}return b||(b=a.extend({},h)),b}(i)),c.on("click","[data-toggle^='code']",function(){var c=a(this),d=c.data(),e=d.toggle.replace("code.","");if(!c.hasClass("disabled"))switch(e){case"add":c.addClass("hide"),d=a.extend({},h),k(d);break;case"bulk":c.addClass("hide"),f.find(".input-code-add").last().addClass("hide"),l(b.shop.data)}}),b.popoverConfirm({message:"确定要删除么？",confirm:function(){a(this).closest(".code-item").empty().remove(),f.find(".input-code-add").last().removeClass("hide"),0===f.find(".input-code-name[readonly]").length&&d.find("[data-toggle='code.bulk']").removeClass("hide"),1===f.children().length&&f.find(".input-code-del").first().addClass("hide")}}),d.submitter({isValidated:function(){return f.find(".input-code-shop-only:not(:checked)").length>20?(g.modal("show"),!1):m()&&o()?(n(),!0):!1},done:function(a){b.respond(a)}})};return c}),define("code2d/detail",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".download-modal"),e=c.find(".code-delete-modal"),f=d.find("table a");c.on("click","[data-toggle^='code']",function(){var c=a(this),g=c.data(),h=g.toggle.replace("code.","");if(!c.hasClass("disabled"))switch(h){case"more":f.each(function(){var b=a(this),c=[];a.each(b.data(),function(a,b){c.push(a+"="+b)}),b.attr("href",g.url+(c.length?"?"+c.join("&"):""))}),d.modal("show");break;case"delete":e.find("[data-toggle='code.delete.confirm']").data("code",g),e.modal("show");break;case"delete.confirm":g=c.data("code"),a.ajax(g.url,{async:!1,type:"POST",data:{id:g.id},dataType:"json",success:function(a){b.respond(a,{success:function(){e.modal("hide"),b.reload()}})}})}})};return c}),define("code2d/list",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find(".code-delete-modal");c.on("click","[data-toggle^='code']",function(){var c=a(this),e=c.data(),f=e.toggle.replace("code.","");if(!c.hasClass("disabled"))switch(f){case"delete":d.find("[data-toggle='code.delete.confirm']").data({$toggle:c,code:e}),d.modal("show");break;case"delete.confirm":e=e.code,a.ajax(e.url,{async:!1,type:"POST",data:{id:e.id},dataType:"json",success:function(a){b.respond(a,{success:function(){d.modal("hide"),c.data("$toggle").addClass("disabled"),b.reload()}})}})}})};return c}),define("template/set",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find("form");d.submitter({done:function(a){b.respond(a)}})};return c}),define("wechat/set",["jquery","welife"],function(a,b){"use strict";var c=function(){var c=a(".mainbody"),d=c.find("form");d.submitter({disableAfterDone:!0,done:function(a){b.respond(a,{success:function(){b.reload()}})}}),require(["ZeroClipboard"],function(d){c.find(".copy-to-clipboard").each(function(){var c=a(this).data(),e=new d(this);e.on("ready",function(){e.on("aftercopy",function(){b.msg(c.copiedMessage,2)})})})})};return c});