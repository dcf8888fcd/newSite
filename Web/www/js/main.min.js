!function(a,b){"use strict";var c=function(){var a,b,c=document.getElementsByTagName("script"),d=c.length;for(b=0;d>b;b++)if(a=c[b].src,-1!==a.indexOf("require.js")){a=a.replace(/\/js\/require\.js.*$/,"");break}return a}(),d={baseUrl:c,paths:{ZeroClipboard:"./js/ZeroClipboard.min",echarts:"./js/echarts"}};d.paths["echarts/chart/line"]="./js/echarts",d.paths["echarts/chart/bar"]="./js/echarts",d.paths["echarts/chart/pie"]="./js/echarts",require.config(d);var e={},f=a._pageConfig;e.DEFAULTS={name:"we",version:"0.0.1"},e.MESSAGES={loading:"正在加载……",keyword:"请添加关键词",content:"内容不能为空",error:{loading:"加载失败"}},f&&b.extend(e.DEFAULTS,f),e.base=function(){var c=this,d=this.moduleParts,f=d.length>0?d[0]:!1,g=d.length>1?d.slice(0,2).join("."):!1,h=d.length>2?d.slice(0,3).join("."):!1;if(f){switch(f){case"activity":case"coupon":f="market";break;case"material":f="message"}switch(g){case"message.manage":g="message.home"}switch(h){case"message.sms.manage":g="message.sms";break;case"message.sms.record":case"message.sms.balance":case"message.sms.invoice":h="message.sms.recharge"}c.$main.find(".sidebar > .nav > li").each(function(){var a,c=b(this),d=c.data("module"),e=!1;h&&(a=c.find("[data-module='"+h+"']"),a.length&&(e=!0,c.addClass("open").find(".collapse").addClass("in"),a.addClass("active"))),!e&&g&&(a=c.find("[data-module='"+g+"']"),a.length&&(e=!0,c.addClass("open").find(".collapse").addClass("in"),a.addClass("active"))),e||f!==d||c.addClass("active"),c.click(function(){c.toggleClass("open")})})}"localhost"===a.location.host&&(console.log("No cache!"),b.ajaxSetup({cache:!1})),b.fn.submitter.setDefaults({ajaxOptions:{type:"post",cache:!1,dataType:"json"},messages:{start:"提交开始",done:"提交成功",fail:"提交失败",end:"提交结束"},start:function(){},done:function(){},fail:function(){console.log(arguments),e.msg("网络连接超时或服务器没有响应，请稍候再试",5)},end:function(){}}),e.$body.message({toggle:!1}),e.msg=function(a,b,c){"hide"===a?e.$body.message("hide",b,c):"string"==typeof a&&""!==a&&e.$body.message("show",a,b,c)},function(){var a=e.$main.find(".we-pagination-group form"),b=a.find("input[name='page']"),c=function(){var a=parseInt(b.val(),10)||0,c=!1;return a>0?c=!0:a="",b.val(a),c};b.on("change keyup",c),a.submit(function(a){return c()?void 0:(a.preventDefault(),!1)})}()},e.init=function(){var a,c;this.$body=b("body"),this.$main=this.$body.find(".main"),a=this.$main.data("module"),a&&(a=a.replace("new","_new_")),this.module=a,this.moduleParts=a?a.split("."):[],this.base(),console.log("Current Module: "+this.module),this.module&&(c=this,b.each(this.moduleParts,function(a,b){c="undefined"!=typeof c[b]?c[b]:{}}),b.isFunction(c)&&(console.log(this.module+" is running..."),c()))},a.WeLife=e,b(function(){require(["checkbox","radio","timeinputer","placeholder","submitter","message","validate"],function(){e.init()})})}(window,jQuery),function(a){"function"==typeof define&&define.amd?define("checkbox",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.defaults=a.extend({},b.defaults,a.isPlainObject(d)?d:{}),this.$checkbox=this.$element.find(":checkbox"),this.defaults.toggle&&this.toggle()};b.defaults={toggle:!0},b.prototype={constructor:b,check:function(){var b,c=this.$element;c.hasClass("disabled")||c.hasClass("readonly")||c.hasClass("checked")||(b=a.Event("check.we.checkbox"),c.trigger(b),b.isDefaultPrevented()||(c.addClass("checked"),this.$checkbox.prop("checked",!0),c.trigger("checked.we.checkbox")))},uncheck:function(){var b,c=this.$element;c.hasClass("disabled")||c.hasClass("readonly")||!c.hasClass("checked")||(b=a.Event("uncheck.we.checkbox"),c.trigger(b),b.isDefaultPrevented()||(c.removeClass("checked"),this.$checkbox.prop("checked",!1),c.trigger("unchecked.we.checkbox")))},toggle:function(){this.$element.hasClass("checked")?this.uncheck():this.check()},enable:function(){this.$element.removeClass("disabled"),this.$checkbox.prop("disabled",!1)},disable:function(){this.$element.addClass("disabled"),this.$checkbox.prop("disabled",!0)}},a.fn.checkbox=function(c){return this.each(function(){var d=a(this),e=d.data("we.checkbox");e||d.data("we.checkbox",e=new b(this,c)),"string"==typeof c&&a.isFunction(e[c])&&e[c]()})},a.fn.checkbox.constructor=b,a(document).on("click.we.checkbox","[data-toggle='checkbox']",function(b){var c=a(this),d=c.data();"checkbox"!==b.target.type&&b.preventDefault(),d=c.data("we.checkbox")?"toggle":d,c.checkbox(d)})}),function(a){"function"==typeof define&&define.amd?define("message",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.defaults=a.extend({},b.defaults,a.isPlainObject(d)?d:{}),this.$message=a(b.template),this.$message.appendTo("body"),this.defaults.toggle&&this.toggle()};b.defaults={toggle:!0,message:"",duration:2e3,state:"default"},b.states=["default","primary","success","info","warning","danger"],b.template='<div class="we-message fade"><span class="message"></span></div>',b.prototype={constructor:b,show:function(c,d,e,f){var g,h=this.$message,i=this.defaults;if(!this.transitioning&&!h.hasClass("in")&&(g=a.Event("show.we.message"),this.$element.trigger(g),!g.isDefaultPrevented()))return-1===a.inArray(d,b.states)&&(d=parseInt(d,10)||0,d=d>0&&6>d?b.states[d]:i.state),e&&(this.duration=e),h.show().get(0).offsetHeight,h.find(".message").attr("class","message "+d).text(c),this.transitioning=!0,!a.support.transition||f?void this.shown():void h.one(a.support.transition.end,a.proxy(this.shown,this)).emulateTransitionEnd(150).addClass("in")},shown:function(){this.transitioning=!1,this.$element.trigger("shown.we.message"),setTimeout(a.proxy(this.hide,this),this.duration||this.defaults.duration||2e3)},hide:function(b){var c,d=this.$message;if((!this.transitioning||d.hasClass("in"))&&(c=a.Event("hide.we.message"),this.$element.trigger(c),!c.isDefaultPrevented()))return d.removeClass("in"),this.transitioning=!0,!a.support.transition||b?void this.hidden():void d.one(a.support.transition.end,a.proxy(this.hidden,this)).emulateTransitionEnd(150)},hidden:function(){this.transitioning=!1,this.$message.hide(),this.$element.trigger("hidden.we.message")},toggle:function(){this.$message.hasClass("in")?this.hide():this.show()}},a.fn.message=function(c){var d=[].slice.call(arguments,1);return this.each(function(){var e=a(this),f=e.data("we.message");f||e.data("we.message",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&f[c].apply(f,d)})},a.fn.message.constructor=b}),function(a){"function"==typeof define&&define.amd?define("placeholder",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(b){this.$element=a(b),this.placeholder=this.$element.attr("placeholder"),this.contenteditable="true"===this.$element.prop("contenteditable")?!0:!1,this.init()};b.prototype={constructor:b,support:{placeholder:"undefined"!=typeof a('<input type="text">').prop("placeholder")},init:function(){this.support.placeholder&&!this.contenteditable||!this.placeholder||(this.addListener(),this.$element.trigger("blur"))},addListener:function(){this.$element.on({focus:a.proxy(this.focus,this),blur:a.proxy(this.blur,this)})},removeListener:function(){this.$element.off({focus:this.focus,blur:this.blur})},show:function(){var a=this.$element,b=this.placeholder;this.$element.addClass("placeholder"),this.contenteditable?a.text(b):a.val(b)},hide:function(){var a=this.$element;this.$element.removeClass("placeholder"),this.contenteditable?a.text(""):a.val("")},focus:function(){var a=this.$element,b=this.contenteditable?a.text():a.val();b===this.placeholder&&this.hide()},blur:function(){var a=this.$element,b=this.contenteditable?a.text():a.val();""===b&&this.show()},destory:function(){this.removeListener(),this.$element.data("placeholder",null)}},a.fn.placeholder=function(c){return this.each(function(){var d=a(this),e=d.data("placeholder");e||d.data("placeholder",e=new b(this,c)),"string"==typeof c&&a.isFunction(e[c])&&e[c]()})},a.fn.placeholder.constructor=b,a(function(){a("input[placeholder], textarea[placeholder], [contenteditable][placeholder]").placeholder()})}),function(a,b,c){"use strict";c.popoverNotice=function(a,c){var d=a?a.find(".we-notice-toggle"):b(".we-notice-toggle");return c?void d.popover("destroy"):void d.each(function(){var a=b(this);a.popover({trigger:"hover",content:a.find(".notice-template").text(),html:!0,template:'<div class="popover we-popover-notice" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})})},c.popoverConfirm=function(a,c){var d=b.isPlainObject(a)?a:{},e=function(){return'<div class="popover we-popover-confirm" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'},f=function(a){var b='<div class="popover-message">'+a+'</div><div class="popover-buttons"><button class="btn we-btn-sm" type="button" data-toggle="popover.confirm.submit">确认</button><button class="btn we-btn-sm" type="button" data-toggle="popover.confirm.cancel">取消</button></div>';return b},g={trigger:"click",content:f(d.message),html:!0,placement:"bottom",template:e()},h="click.bs.popover.confirm"+(d.namespace||""),i="[data-toggle='popover.confirm"+(d.namespace||"")+"']";return"destroy"===a||c?void b(document).off(h):void b(document).on(h,i,function(c){var d,e,h,i=b(this);c.preventDefault(),i.hasClass("disabled")||(i.data("bs.popover")?i.popover():(d=i.data(),e=b.extend({},a),h=b.extend({},g),d.message&&(h.content=f(d.message)),i.popover(h).popover("show"),i.on("hidden.bs.popover",function(){i.data("bs.popover").$tip.off("click.popover.confirm").off("click.popover.cancel")}).on("shown.bs.popover",function(){i.data("bs.popover").$tip.on("click.popover.confirm","[data-toggle='popover.confirm.submit']",function(){b.isFunction(e.confirm)&&i.one("hidden.bs.popover",function(){e.confirm.call(this)}),i.popover("hide")}).on("click.popover.cancel","[data-toggle='popover.confirm.cancel']",function(){b.isFunction(e.cancel)&&i.one("hidden.bs.popover",function(){e.cancel.call(this)}),i.popover("hide")})})))})}}(window,jQuery,WeLife),function(a){"function"==typeof define&&define.amd?define("radio",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=a("body"),c=function(b){this.$element=a(b),this.$radio=this.$element.find(":radio")};c.prototype={constructor:c,check:function(c){var d,e=this.$element;e.hasClass("disabled")||e.hasClass("readonly")||e.hasClass("checked")||(d=a.Event("check.we.radio"),e.trigger(d),d.isDefaultPrevented()||(b.find("[data-name='"+e.attr("data-name")+"']").radio("uncheck"),e.addClass("checked"),this.$radio.prop("checked",!0),c!==!1&&e.trigger("checked.we.radio")))},uncheck:function(b){var c,d=this.$element;d.hasClass("disabled")||d.hasClass("readonly")||!d.hasClass("checked")||(c=a.Event("uncheck.we.radio"),d.trigger(c),c.isDefaultPrevented()||(d.removeClass("checked"),this.$radio.prop("checked",!1),b!==!1&&d.trigger("unchecked.we.radio")))},enable:function(){this.$element.removeClass("disabled"),this.$radio.prop("disabled",!1)},disable:function(){this.$element.addClass("disabled"),this.$radio.prop("disabled",!0)}},a.fn.radio=function(b){return this.each(function(){var d=a(this),e=d.data("we.radio");e||d.data("we.radio",e=new c(this)),"string"==typeof b&&a.isFunction(e[b])&&e[b]()})},a.fn.radio.constructor=c,a(document).on("click.we.radio","[data-toggle='radio']",function(b){"radio"!==b.target.type&&b.preventDefault(),a(this).radio("check")})}),function(a){"function"==typeof define&&define.amd?define("submitter",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){d=a.isPlainObject(d)?d:{},this.$form=a(c),this.defaults=a.extend(!0,{},b.defaults,d),this.init()};b.prototype={constructor:b,support:{formData:!!window.FormData},init:function(){var b,c,d,e=this.$form,f=this.defaults.ajaxOptions.url||this.defaults.url||e.attr("action")||"";f&&(this.action=this.url=f,c={type:e.attr("method")||"GET"},b={beforeSend:a.proxy(this.start,this),success:a.proxy(this.done,this),error:a.proxy(this.fail,this),complete:a.proxy(this.end,this)},this.ajaxOptions=a.extend({},c,this.defaults.ajaxOptions,b),this.defaults.async||this.initIframe(),e.find(":file").length>0&&!this.support.formData&&(this.defaults.async=!1,this.initIframe()),this.preSubmit=!1,this.preventSubmit=!1,this.defaults.resetAfterDone&&(d=e.find(":reset"),0===d.length&&(d=a('<button type="reset" style="display:none;">Reset</button>'),e.append(d)),this.$reset=d),this.formTarget=e.attr("target"),this.enable())},setDefaults:function(b){var c=this.defaults;a.isPlainObject(b)?a.extend(c,b):"string"==typeof b&&(c[b]=arguments[1])},enable:function(){this.$form.on("click",":submit",a.proxy(this.click,this)),this.$form.on("submit",a.proxy(this.submit,this))},disable:function(){this.$form.off("click",":submit",this.click),this.$form.off("submit",this.submit).attr("target",this.formTarget),this.$form=null,this.$iframe&&(this.$iframe.off("load").remove(),this.$iframe=null),this.$reset=null,this.ajaxOptions=null,this.defaults=null},click:function(b){var c=a(b.target).data(),d=this.$form.data(c.submit);this.preventSubmit="preview"===c.submit,"string"==typeof d&&""!==d&&(this.url=d,this.$form.attr("action",this.url),this.preSubmit=!0)},submit:function(){return!this.defaults.isValidated()||this.preventSubmit?!1:this.defaults.async?(this.ajaxSubmit(),!1):void this.start(null)},start:function(){this.$form.find(":submit").prop("disabled",!0),a.isFunction(this.defaults.start)&&this.defaults.start("submitStart"),a.isFunction(this.defaults.ajaxOptions.beforeSend)&&this.defaults.ajaxOptions.beforeSend(arguments)},done:function(b){a.isFunction(this.defaults.done)&&this.defaults.done(b,"submitSuccess"),a.isFunction(this.defaults.ajaxOptions.success)&&this.defaults.ajaxOptions.success(arguments),this.defaults.resetAfterDone&&this.$reset&&this.$reset.click()},fail:function(){a.isFunction(this.defaults.fail)&&this.defaults.fail("submitError"),a.isFunction(this.defaults.ajaxOptions.error)&&this.defaults.ajaxOptions.error(arguments)},end:function(){this.defaults.disableAfterDone||this.$form.find(":submit").prop("disabled",!1),a.isFunction(this.defaults.end)&&this.defaults.end("submitComplete"),a.isFunction(this.defaults.ajaxOptions.complete)&&this.defaults.ajaxOptions.complete(arguments),this.preSubmit&&(this.url=this.action,this.$form.attr("action",this.action),this.preSubmit=!1)},ajaxSubmit:function(){var b=a.extend({},this.ajaxOptions);this.support.formData?(b.data=new FormData(this.$form[0]),b.type="POST",b.processData=!1,b.contentType=!1):b.data=this.$form.serialize(),a.ajax(this.url,b)},initIframe:function(){var b="submitter-"+Math.random().toString().replace("0.",""),c=a('<iframe name="'+b+'" style="display:none;"></iframe>'),d=this;c.on("load",function(){var b,c,e;try{c=this.contentWindow,e=this.contentDocument,e=e?e:c.document,b=e?e.body.innerText:null,b="string"==typeof b?a.parseJSON(b):b}catch(f){d.fail(null,"submitError",f.message)}b&&(a.isPlainObject(b)?d.done(b,"submitSuccess",null):d.fail(null,"submitError","The response data must be JSON."),d.end(null,"submitComplete"))}),this.defaults.ajaxOptions.type&&this.$form.attr("method",this.defaults.ajaxOptions.type),this.$form.attr("target",b).after(c),this.$iframe=c}},b.defaults={async:!0,resetAfterDone:!1,disableAfterDone:!1,url:void 0,ajaxOptions:{dataType:"json"},messages:{start:"Submit start.",done:"Submit done.",fail:"Submit fail.",end:"Submit end."},isValidated:function(){return!0},start:function(){},done:function(){},fail:function(){},end:function(){}},b.setDefaults=function(c){a.extend(b.defaults,c)},a.fn.submitter=function(c){var d=[].slice.call(arguments,1);return this.each(function(){var e=a(this),f=e.data("submitter");f||e.data("submitter",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&f[c].apply(f,d)})},a.fn.submitter.Constructor=b,a.fn.submitter.setDefaults=b.setDefaults}),function(a,b,c){"use strict";c.textEditor=function(c,d){var e=c?c.find(".we-editor"):b(".we-editor"),f=e.find(".editor-output"),g=e.find(".editor-input"),h=/<ul>.*<\/ul>/m,i=/[\r\n]+/g,j=function(){f.val(g.html().replace(/\s{2,}/g,"")).data("text",b.trim(g.text().replace(/\s{2,}/g,""))),f.trigger("change")},k=function(c){var d,e=g.html(),k=b.trim(g.text());return k.length?(h.test(e)||(k=k.split(i),e="<ul><li>"+k.join("</li><li>")+"</li></ul>",g.html(e),c&&a.getSelection&&(this.focus(),d=a.getSelection(),d.selectAllChildren(this),d.collapseToEnd())),void j()):(f.val(""),void g.empty())};return d?void g.off():(j(),void g.on({keyup:function(a){var b=a.which;(13===b||a.ctrlKey&&86===b)&&k.call(this,!0)},blur:function(){k.call(this)}}))}}(window,jQuery,WeLife),function(a){"function"==typeof define&&define.amd?define("timeinputer",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.defaults=a.extend({},b.DEFAULTS,a.isPlainObject(d)?d:{}),this.init()},c=function(a){return Math.abs(parseInt(a,10))},d=function(a){return 10>a?"0"+a:a};b.prototype={constructor:b,support:{timeInput:"time"===a('<input type="time">').prop("type")},init:function(){var c,d=this.$element;this.support.timeInput||(this.$inputer=c=a(b.TEMPLATE),d.hide().after(c),this.$hours=c.find("[data-input='hh']"),this.$minutes=c.find("[data-input='mm']"),this.$buttons=c.find("[data-input='+'], [data-input='-']"),this.$inputs=this.$hours.add(this.$minutes),this.activate(this.$hours,!0),this.inputing=null,this.valid=!1,this.addListeners(),this.initTime(),this.output())},initTime:function(){var a,b,e,f,g=this.defaults,h=g.time||this.$element.val();/^\d{2}:\d{2}$/.test(h)&&(h=h.match(/\d{2}/g),e=c(h[0]),f=c(h[1]),!isNaN(e)&&!isNaN(f)&&24>e&&60>f&&(a=!0,this.$hours.val(d(e)),this.$minutes.val(d(f)))),!a&&g.now&&(b=new Date,this.$hours.val(d(b.getHours())),this.$minutes.val(d(b.getMinutes())))},addListeners:function(){this.$inputer.on({mousedown:a.proxy(this.mousedown,this),mouseup:a.proxy(this.mouseup,this)}),this.$inputs.on({keydown:a.proxy(this.keydown,this),keyup:a.proxy(this.keyup,this),blur:a.proxy(this.blur,this),paste:a.proxy(this.paste,this)}),this.$buttons.on({mouseout:a.proxy(this.mouseout,this)})},removeListeners:function(){this.$inputer.off({mousedown:this.mousedown,mouseup:this.mouseup}),this.$inputs.off({keydown:this.keydown,keyup:this.keyup,blur:this.blur,paste:this.paste}),this.$buttons.off({mouseout:this.mouseout})},activate:function(a,b){var c;this.$inputs.removeClass("active"),b||a.addClass("active").focus(),this.$active=a,this.active=c=a.data("input"),this.max="hh"===c?24:60},input:function(a,b){var c=this.getVal()||0,d=this.max;b?c=(c+a+d)%d:10>c?(c=10*c+a,c>d&&(c=a),c===d&&(c=0)):c=a,this.setVal(c),this.output()},keydown:function(a){var b=a.which;if(b>=48&&57>=b)a.preventDefault(),this.input(b-48);else if(b>=37&&40>=b)switch(a.preventDefault(),b){case 37:this.activate(this.$hours);break;case 38:this.input(1,!0);break;case 39:this.activate(this.$minutes);break;case 40:this.input(-1,!0)}else(b>=65&&90>=b||b>=186&&192>=b||b>=219&&222>=b)&&a.preventDefault()},keyup:function(){this.validate()},blur:function(){this.validate()},paste:function(a){a.preventDefault()},mousedown:function(b){var c=a(b.target).data("input");switch(c){case"hh":case"mm":this.valid=!1,this.activate("hh"===c?this.$hours:this.$minutes);break;case"+":case"-":this.$active.addClass("active"),this.inputing=setInterval(a.proxy(function(){this.input("+"===c?1:-1,!0)},this),50)}},mouseout:function(){clearInterval(this.inputing)},mouseup:function(){clearInterval(this.inputing)},getVal:function(){return c(this.$active.val())},setVal:function(a){this.$active.val(isNaN(a)?"":d(a))},output:function(){var a,b=this.$hours.val(),c=this.$minutes.val();b&&c&&(a=b+":"+c,this.$element.val(a))},validate:function(){var a,b;this.valid||(a=this.getVal(),b=this.max,isNaN(a)?this.setVal(a):a>=b&&this.setVal(a%b),this.valid=!0)},destroy:function(){this.$inputs.removeClass("active"),this.removeListeners(),this.$element.removeData("timeinputer")}},b.DEFAULTS={now:!1,time:!1},b.TEMPLATE='<div class="timeinputer"><input data-input="hh" type="text" name="hour" value="--" maxlength="2"><span data-input=":">:</span><input data-input="mm" type="text" name="minute" value="--" maxlength="2"><button data-input="+" type="button">+</button><button data-input="-" type="button">-</button></div>',b.setDefaults=function(c){a.extend(b.DEFAULTS,c)},b.other=a.fn.timeinputer,a.fn.timeinputer=function(c){var d,e=[].slice.call(arguments,1);return this.each(function(){var f,g=a(this),h=g.data("timeinputer");h||g.data("timeinputer",h=new b(this,c)),"string"==typeof c&&a.isFunction(f=h[c])&&(d=f.apply(h,e))}),"undefined"!=typeof d?d:this},a.fn.timeinputer.constructor=b,a.fn.timeinputer.setDefaults=b.setDefaults,a.fn.timeinputer.noConflict=function(){return a.fn.timeinputer=b.other,this},a(function(){a("input[type='time']").timeinputer()})}),function(a){"function"==typeof define&&define.amd?define("validate",["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.isPlainObject(d)?d:{},this.defaults=a.extend(!0,{},b.defaults),this.valid=!1,this.init()};b.defaults={rules:{},trim:!1,trimOverflow:!1,charCodeLength:!1,filter:null,showErrors:null,hideErrors:null},b.regexps={email:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,nonempty:/\S+/,number:/^\d+$/,password:/^.{6,20}$/,chinese:/[\u4e00-\u9fa5]+/g,name:/^[a-zA-Z\u4e00-\u9fa5]+$/,phone:/^\d{11}$/},b.rules=["number","email","password","required","minlength","maxlength","min","max"],b.messages={required:"此项为必填项",email:"请输入有效的电子邮件",url:"请输入有效的网址",date:"请输入有效的日期",dateISO:"请输入有效的日期 (YYYY-MM-DD)",number:"请输入正确的数字",digits:"只可输入数字",creditcard:"请输入有效的信用卡号码",equalTo:"你的输入不相同",extension:"请输入有效的后缀",maxlength:"最多 %s 个字",minlength:"最少 %s 个字",rangelength:"请输入长度为 %s 至 %s 之間的字串",range:"请输入 %s 至 %s 之间的数值",max:"请输入不大于 %s 的数值",min:"请输入不小于 %s 的数值",name:"姓名只能包含汉字和字母",phone:"手机号码必须为11位数字"},b.prototype={constructor:b,init:function(){this.update(),this.addListener()},update:function(c){var d=this.$element,e=d.attr("type");c=a.isPlainObject(c)?c:{},a.each(b.rules,function(a,b){var f=b===e?e:d.attr(b);f&&(/^\d+$/.test(f)&&(f=parseFloat(f)),c[b]=f)}),a.extend(!0,this.defaults,{rules:c},this.options)},addListener:function(){this.$element.on("keyup change",a.proxy(this.validate,this)),this.defaults.trim&&this.$element.on("change",a.proxy(this.trim,this))},trim:function(){var b=this.$element;b.val(a.trim(b.val()))},validate:function(c){var d,e=this,f=this.defaults,g=this.$element,h=g.get(0),i=g.val(),j=f.showErrors,k=f.hideErrors,l=!0;return g.hasClass("disabled")?l:(a.isFunction(f.filter)&&(i=f.filter.call(h,i)),f.trim&&(i=a.trim(i)),a.each(f.rules,function(c,g){var m=e[c];return a.isFunction(m)&&(l=m.call(e,i,g)),l?void(a.isFunction(k)&&k(h)):(d=b.messages[c],d&&-1!==d.indexOf("%s")&&("number"==typeof g?(f.charCodeLength&&(g/=2),d=d.replace("%s",g)):a.isArray(g)&&a.each(g,function(a,b){d=d.replace("%s",b)})),a.isFunction(j)&&j(h,d),!1)}),this.valid=l,!l&&f.preventInput&&c.preventDefault(),l)},required:function(){return b.regexps.nonempty.test(this.$element.val())},number:function(){return b.regexps.number.test(this.$element.val())},min:function(a,b){return a=parseFloat(a),!isNaN(a)&&a>=b},max:function(a,b){return a=parseFloat(a),!isNaN(a)&&b>=a},minlength:function(a,b){var c="string"==typeof a?a.length:0;return c>=b},maxlength:function(a,b){var c,d=this.defaults,e="string"==typeof a?a.length:0,f=0,g="";if(e&&d.charCodeLength){for(c=0;e>c;c++)f+=a.charCodeAt(c)>255?2:1,b>=f&&(g+=a.charAt(c));e=f,f>b&&d.trimOverflow&&(e=b,this.$element.val(g))}return b>=e},name:function(){return b.regexps.name.test(this.$element.val())},phone:function(){return b.regexps.phone.test(this.$element.val())}},a.fn.validate=function(c){var d;return this.each(function(){var e=a(this),f=e.data("we.validate");f||e.data("we.validate",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&(d=f[c]())}),"undefined"!=typeof d?d:this},a.fn.validate.constructor=b,a.fn.validate.setDefaults=function(c){a.isPlainObject(c)&&a.extend(!0,b.defaults,c)}}),function(a,b,c){"use strict";c.cardSelector=function(a){var d=a?a.find(".card-selector"):b(".card-selector"),e=d.find(".card-style-id"),f=d.find(".card-style-name"),g=d.find(".card-style"),h=g.find(".card-style-list"),i=g.find(".card-style-template").text();d.on("click","[data-toggle^='card']",function(){var a,d=b(this),j=d.data(),k=j.toggle.replace("card.","");if(!d.hasClass("disabled")&&!d.hasClass("selected"))switch(k){case"load":j.loaded?g.modal("show"):b.ajax(j.url,{data:j,dataType:"json",beforeSend:function(){c.msg(c.MESSAGES.loading,3),d.addClass("disabled")},success:function(a){var f=_.template(i),j="";0===a.errcode?(c.msg("hide"),d.data("loaded",!0),g.modal("show"),b.isArray(a.result)&&(b.each(a.result,function(){j+=f(arguments[1])}),h.html(j).find("[data-id='"+e.val()+"']").addClass("selected"))):c.msg(a.errmsg,5)},error:function(){c.msg(c.MESSAGES.error.loading,5),console.log(arguments)},complete:function(){d.removeClass("disabled")}});break;case"select":h.find(".selected").removeClass("selected"),d.addClass("selected");break;case"selected":a=h.find(".selected"),a.length&&(j=a.data(),e.val(j.id),f.text(j.name)),g.modal("hide")}})}}(window,jQuery,WeLife),function(a,b){"use strict";var c=function(a,d){this.element=a,this.$element=b(a),this.defaults=b.extend({},c.defaults,this.$element.data(),b.isPlainObject(d)?d:{}),this.caches={},this.cacheId=0,this.options=null,this.chart=null,this.charting=!1,this.active=!1,this.defaults.toggle&&this.toggle()};c.defaults={cacheId:0,type:"line",params:null,options:null,url:"",width:0/0,height:0/0,overview:"",toggle:!0},c.prototype={constructor:c,init:function(){var a=this.defaults;b.isPlainObject(a.options)&&(this.options=a.options,this.cacheId=a.cacheId||0,this.cache(this.cacheId,this.options)),"string"==typeof a.params&&(a.params=b.parseJSON(a.params)),this.$source=b(a.source),this.$category=b(a.category),this.$source.addClass("hide"),this.$category.addClass("hide"),this.addListeners(),this.active=!0},addListeners:function(){this.$category.on("checked.we.radio",b.proxy(this.changeCategory,this))},removeListeners:function(){this.$category.off("checked.we.radio")},changeCategory:function(a){var c,d,e=b(a.target);this.$element.hasClass("charted")&&(c=e.find(":radio"),d=b.extend({},e.data(),c.data()),d[c.attr("name")]=c.val(),d["we.radio"]=null,this.load(d.url,d,function(){this.initChart()}))},cache:function(a,c){var d=this.caches;return a=parseInt(a,10)||this.cacheId,b.isPlainObject(c)?void(d[a]=c):d[a]},load:function(a,c,d){var e,f=this,g=this.defaults;if(d||(b.isFunction(a)?(d=a,a=!1):b.isFunction(c)?(d=c,c=null):d=b.noop),a=a||g.url,c=b.isPlainObject(c)?c:{},b.extend(c,g.params),"undefined"!=typeof c.cacheId){if(e=this.cache(c.cacheId))return this.options=e,this.cacheId=c.cacheId,void d.call(this);if(b.isPlainObject(c.options))return this.options=c.options,c.cacheId&&(this.cacheId=c.cacheId),this.cache(this.cacheId,c.options),void d.call(this)}"string"==typeof a&&a&&b.ajax(a,{data:c,dataType:"json",success:function(a){"object"==typeof a&&(f.options=a,c.cacheId&&(f.cacheId=c.cacheId),f.cache(f.cacheId,a),d.call(f))}})},initChart:function(){require(["echarts","echarts/chart/"+this.defaults.type],b.proxy(function(a){this.chart&&(this.chart.clear(),this.chart.dispose(),this.chart=null),this.chart=a.init(this.element),this.chart.setOption(this.options),this.shown()},this))},setOptions:function(a){b.isPlainObject(a)&&(this.options=a,this.cache(this.cacheId,a),this.initChart())},getOptions:function(){return this.options},show:function(){var a=this.$element;this.charting||a.hasClass("charted")||(this.active||this.init(),this.charting=!0,a.addClass("charted loading"),this.options?this.initChart():this.load(function(){this.initChart()}))},shown:function(){var a=this.defaults,b=this.options?this.options.total||0:0,c=a.overview;b="<b>"+b+"</b>",c="string"==typeof c?c.replace("%s",b):b,this.$element.removeClass("loading").closest(".we-chart").find(".chart-overview").html(c),this.$source.removeClass("hide"),this.$category.removeClass("hide"),this.charting=!1},hide:function(){var a=this.$element;a.hasClass("charted")&&(a.removeClass("charted"),this.hidden())},hidden:function(){this.cacheId>0&&(this.cacheId=this.defaults.cacheId,this.options=this.cache(this.cacheId),this.$category.radio("uncheck")),this.$source.addClass("hide"),this.$category.addClass("hide")},toggle:function(){this.$element.hasClass("charted")?this.hide():this.show()}},b.fn.chart=function(a){var d,e=[].slice.call(arguments,1);return this.each(function(){var f=b(this),g=f.data("we.chart");g||f.data("we.chart",g=new c(this,a)),"string"==typeof a&&b.isFunction(g[a])&&(d=g[a].apply(g,e))}),"undefined"!=typeof d?d:this},b.fn.chart.constructor=c,b(document).on("click.we.chart","[data-toggle='chart']",function(a){var c=b(this),d=c.data(),e=b(d.target||c.attr("href"));a.preventDefault(),c.hasClass("active")||(c.addClass("active").siblings(".active").removeClass("active"),e.addClass("active").siblings(".active").removeClass("active").chart("hide")),d=e.data("we.chart")?"toggle":d,e.chart(d)}),b(function(){b(".active[data-toggle='chart']").click(),b("[data-toggle='chart.render']").chart()})}(window,jQuery,WeLife),function(a,b,c){"use strict";c.colorSelector=function(a){var d=a?a.find(".color-selector"):b(".color-selector"),e=d.find(".color-style-id"),f=d.find(".color-style-name"),g=d.find(".color-style"),h=g.find(".color-style-list"),i=g.find(".color-style-template").text();d.on("click","[data-toggle^='color']",function(){var a,d=b(this),j=d.data(),k=j.toggle.replace("color.","");if(!d.hasClass("disabled")&&!d.hasClass("selected"))switch(k){case"load":j.loaded?g.modal("show"):b.ajax(j.url,{data:j,dataType:"json",beforeSend:function(){c.msg(c.MESSAGES.loading,3),d.addClass("disabled")},success:function(a){var f=_.template(i),j="";0===a.errcode?(c.msg("hide"),d.data("loaded",!0),g.modal("show"),b.isArray(a.result)&&(b.each(a.result,function(){j+=f(arguments[1])}),h.html(j).find("[data-id='"+e.val()+"']").addClass("selected"))):c.msg(a.errmsg,5)},error:function(){c.msg(c.MESSAGES.error.loading,5),console.log(arguments)},complete:function(){d.removeClass("disabled")}});break;case"select":h.find(".selected").removeClass("selected"),d.addClass("selected");break;case"selected":a=h.find(".selected"),a.length&&(j=a.data(),e.val(j.id),f.css("background-color",j.color)),g.modal("hide")}})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.couponEditor=function(a){function d(a){var c=k.hasClass("in");c||p.addClass("disabled").prop("disabled",!0),b.ajax(a.remote,{data:a,success:function(b){c?k.empty().html(b):k.html(b).collapse("show"),"create"===a.page&&e(),"search"===a.page&&f()},error:function(){c||p.removeClass("disabled").prop("disabled",!1),console.log(arguments)}})}function e(){var a=k.find(".coupon-create"),d=a.find(".we-form"),e=d.find(".input-type"),f=d.find(".input-value"),i=d.find(".input-name-prefix"),j=d.find(".input-name"),l=d.find(".input-term"),m=d.find(".term-absolute"),n=d.find(".term-relative"),o=n.find(".input-term-count"),p=d.find(".input-shop"),q=d.find(".input-restriction"),r=a.find(".voucher-detail"),s=_.template(a.find("#voucher-detail-template").text()),t={},u={count:function(){return n.is(":visible")?o.validate("validate"):!0}};n.is(":visible")&&(n.data("active",!0),o.validate()),m.is(":visible")&&(m.data("active",!0),c.date(a,{startDate:new Date})),a.on("click","[data-toggle^='coupon']",function(){var i=b(this),k=i.data(),v=k.toggle.replace("coupon.","");switch(v){case"relative":n.removeClass("hide"),m.addClass("hide"),n.data("active")||(n.data("active",!0),o.validate()),n.parent().find(".highlight").addClass("hide");break;case"absolute":n.addClass("hide"),m.removeClass("hide"),m.data("active")||(m.data("active",!0),c.date(a,{startDate:new Date})),m.parent().find(".highlight").addClass("hide");break;case"create":if(f.length&&!f.validate("validate"))return;
if(!(j.validate("validate")&&u.count()&&q.validate("validate")))return;l.val(function(){var a=b(this).val();return n.hasClass("hide")?m.hasClass("hide")||(a=["absolute",m.find(".input-term-start").val(),m.find(".input-term-end").val()]):a=["relative",n.find(".input-term-count").val(),n.find(".input-term-unit").val()],b.isArray(a)?a.join():a}),t.value=f.val(),t.name=j.val(),t.term=l.val().split(/\s*\,\s*/),t.shop=p.closest(".form-group").hasClass("hide")?"":p.data("shop"),t.restriction=q.val(),r.html(s(t)),d.addClass("hide"),r.removeClass("hide");break;case"cancel":h();break;case"apply":if(f.length&&!f.validate("validate"))return;if(!(j.validate("validate")&&u.count()&&q.validate("validate")))return;l.val(function(){var a=b(this).val();return n.hasClass("hide")?m.hasClass("hide")||(a=["absolute",m.find(".input-term-start").val(),m.find(".input-term-end").val()]):a=["relative",n.find(".input-term-count").val(),n.find(".input-term-unit").val()],b.isArray(a)?a.join():a}),k[e.attr("name")]=e.val(),k[j.attr("name")]=j.val(),f.length?k[f.attr("name")]=f.val():k.value="",k[l.attr("name")]=l.val(),k[p.attr("name")]=p.val(),k[q.attr("name")]=q.val(),b.ajax(k.url,{type:"POST",data:k,dataType:"json",success:function(a){c.respond(a,{success:function(){g(a.result)}})}});break;case"modify":d.removeClass("hide"),r.addClass("hide")}}),f.validate(),f.on("keyup change",function(){var a=parseInt(b(this).val(),10);i.text(a&&a>0?a+"元":"")}),j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),n.find(".input-term-count").validate(),q.validate({filter:function(){return b(this).data("text")}}),c.popoverNotice(a),c.shop(a),c.textEditor(a)}function f(){var a=k.find(".coupon-search"),c=i.find(".voucher-list"),d=_.template(i.find(".voucher-list-template").text()),e=i.find(".voucher-load"),f=e.find("a"),j=i.find(".detail-modal"),l=j.find(".modal-body"),m=_.template(j.find(".modal-body-template").text());f.data("originalText",f.text()),a.on("click","[data-toggle^='coupon']",function(a){var i=b(this),k=i.data(),n=k.toggle.replace("coupon.","");if(!i.hasClass("disabled"))switch(a.preventDefault(),n){case"detail":j.data("coupon",k=i.closest("li").data()),k=b.extend({},k),k.name=k.value?k.name.replace(/^\d+\u5143/,""):k.name,k.term=k.term.split(/\s*\,\s*/),l.empty().html(m(k)),j.modal("show");break;case"detailApply":j.one("hidden.bs.modal",function(){g(j.data("coupon"))}).modal("hide");break;case"cancel":h();break;case"apply":g(i.closest("li").data());break;case"load":b.ajax(k.url,{data:k,dataType:"json",beforeSend:function(){f.addClass("disabled").text(f.data("loading"))},success:function(a){var f,g="";0===a.errcode?(i.data("pageId",++k.pageId),f=a.result,f.data.length>0&&(b.each(f.data,function(a,b){b.name=b.value?b.name.replace(/^\d+\u5143/,""):b.name,b.term=b.term.split(/\s*\,\s*/),g+=d(b)}),c.append(g)),f.more||e.addClass("hide")):console.log(a.errmsg)},complete:function(){f.removeClass("disabled").text(f.data("originalText"))}})}}),a.on("keyup",".input-search",function(a){var c=b(this),d=c.next("button");d.data(c.attr("name"),c.val()),13===a.which&&(a.preventDefault(),d.click())})}function g(a){a=b.extend({},a),a.value&&(a.name=a.name.replace(/^\d+\u5143/,"")),m.append(o(a)),k.hasClass("in")&&h(),m.children().length>=3&&p.addClass("hide")}function h(){k.one("hidden.bs.collapse",function(){k.empty(),p.removeClass("disabled").prop("disabled",!1)}).collapse("hide")}var i=a?a.find(".coupon-settings"):b(".coupon-settings"),j=i.find(".we-coupon"),k=i.find(".we-sandbox"),l=i.find(".coupon-condition"),m=j.find(".coupon-list"),n=m.data("existedCoupons"),o=_.template(j.find(".coupon-list-template").text()),p=j.find(".coupon-toggle"),q=j.find(".coupon-menu"),r=i.find(".preview-modal"),s=r.find(".modal-body"),t=_.template(r.find(".modal-body-template").text());b.isArray(n)&&n.length&&b.each(n,function(a,b){g(b)}),q.add(k).on("click","[data-toggle='page']",function(a){a.preventDefault(),d(b(this).data())}),m.on("click","[data-toggle='coupon.preview']",function(a){var c=b(this).closest("li").data();a.preventDefault(),c=b.extend({},c),c.value&&(c.name=c.name.replace(/^\d+\u5143/,"")),c.term=c.term.split(/\s*\,\s*/),s.empty().html(t(c)),r.modal("show")}),l.find(".condition-type").on("change",function(){l.find(".condition-unit").text(b(this).find(":selected").data("unit"))}),c.popoverConfirm({message:"确定要删除此券么？",confirm:function(){console.log("Yes"),b(this).popover("destroy").closest("li").remove(),m.children().length<3&&p.removeClass("hide")},cancel:function(){console.log("No")}})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.date=function(a,c){var d,e=a?a.find(".we-date-group"):b(".we-date-group"),f=e.find(".date-start"),g=e.find(".date-end"),h=e.find(".date-time"),i=new Date,j={autoclose:!0,format:"yyyy-mm-dd",language:"zh-CN",customDateRange:!1,startViewDate:i,endViewDate:function(a){return new Date(a.getFullYear(),a.getMonth()+1,a.getDate())}(new Date)},k=function(a,b){b=[b.getFullYear(),b.getMonth()+1,b.getDate()],b[1]=b[1]<10?"0"+b[1]:b[1],b[2]=b[2]<10?"0"+b[2]:b[2],a.val(b.join("-"))};b.isPlainObject(c)&&b.extend(j,c),j.endDate&&(j.startViewDate>j.endDate&&(j.startViewDate=j.endDate),j.endViewDate>j.endDate&&(j.endViewDate=j.endDate),j.startViewDate===j.endViewDate&&(j.startViewDate=function(a){var b;return b=j.customDateRange?new Date(a.valueOf()-j.customDateRange):new Date(a.getFullYear(),a.getMonth()-1,a.getDate())}(j.endDate))),f.datepicker(j),!f.val()&&j.startViewDate&&(k(f,j.startViewDate),f.datepicker("update")),g.length&&(f.on("changeDate",function(){var a,b=f.datepicker("getDate"),c=g.datepicker("getDate");b>c&&k(g,b),j.customDateRange&&(a=new Date(b.valueOf()+j.customDateRange),j.endDate&&(a=a<j.endDate?a:j.endDate),c>a&&k(g,a),g.datepicker("setEndDate",a)),g.datepicker("setStartDate",b)}),g.datepicker(j),!g.val()&&j.endViewDate&&(k(g,j.endViewDate),g.datepicker("update")),f.trigger("changeDate")),h.length&&(d=h.val(),d&&"00:00"!==d||h.val(function(){var a=i.getHours(),b=i.getMinutes();return a=10>a?"0"+a:a,b=10>b?"0"+b:b,a+":"+b})),e.find(".caret").click(function(){b(this).parent().find("input").focus()})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.exporter=function(a){var d=a?a.find(".we-exporter"):b(".we-exporter"),e=d.find(".export-toggle"),f=d.find(".export-progress"),g=d.find(".export-result"),h=d.find(".progressbar"),i=d.find(".percentage"),j=d.find(".exported-name"),k=d.find(".exported-url");e.on("click",function(a){var d=b(this).data(),l=new XMLHttpRequest;a.preventDefault(),l.onprogress=function(a){var b;a.lengthComputable&&(b=a.loaded/a.total*100+"%",h.width(b),i.text(b))},b.ajax(d.url,{type:"POST",data:d,dataType:"json",xhr:function(){return l},beforeSend:function(){e.addClass("hide"),f.removeClass("hide")},success:function(a){var b=a.result;0===a.errcode?(j.text(b.name),k.attr("href",b.url),f.addClass("hide"),g.removeClass("hide")):(c.msg(a.errmsg,5),e.removeClass("hide"),f.addClass("hide"))}})})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.keywordEditor=function(a){function d(){j.val(""),k.text(m.helpText.replace("%s",m.maxlength)),l.checkbox("uncheck")}function e(a){a.keyword&&j.val(a.keyword),a.matched&&l.checkbox("check")}var f=a?a.find(".keyword-editor"):b(".keyword-editor"),g=f.find(".keyword-list"),h=_.template(f.find(".keyword-template").text()),i=f.find(".keyword-modal"),j=i.find(".keyword-content"),k=i.find(".keyword-help-text"),l=i.find(".we-checkbox"),m=j.data(),n=null;m.maxlength=j.attr("maxlength"),i.on("hidden.bs.modal",function(){n=null,d()}).on("shown.bs.modal",function(){j.focus().trigger("keyup")}),j.on("keyup blur",function(){var a=b.trim(j.val()).length;a<=m.maxlength&&k.text(m.helpText.replace("%s",m.maxlength-a))}),j.on("change blur",function(){j.val(b.trim(j.val()))}),f.on("click","[data-toggle^='keyword']",function(){var a,f,k,o=b(this),p=o.data("toggle").replace("keyword.","");if(!o.hasClass("disabled")&&!o.hasClass("selected"))switch(p){case"show":g.children().length<o.data("maxlength")?i.modal("show"):c.msg(o.data("message"),4);break;case"add":a=j.val(),f=l.hasClass("checked"),a?(k=h({keyword:a,matched:f}),n?(n.replaceWith(k),n=null):g.removeClass("hide").append(k),i.modal("hide"),d()):c.msg(m.required,4);break;case"del":o.parent().remove();break;case"edit":n=o.parent(),e(n.data()),i.modal("show")}})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.messageEditor=function(d){var e,f=d?d.find(".message-editor"):b(".message-editor"),g=f.find(".editor-menu"),h=f.find(".editor-input"),i=f.find(".editor-output"),j=f.find(".editor-type"),k=f.find(".editor-help"),l=f.find(".editor-modal"),m=l.find(".editor-modal-menu > li"),n=l.find(".editor-material-list"),o=n.children(),p=_.template(l.find(".editor-material-template").text()),q=l.find(".editor-material-load > a"),r=l.find("[data-toggle='material.selected']"),s=h.data(),t={},u=q.data(),v={page:1},w=function(a){b.isPlainObject(a)&&b.extend(v,a),b.ajax(u.url,{data:v,dataType:"json",beforeSend:function(){q.addClass("disabled").text(q.data("loading"))},success:function(a){var d,e=[];0===a.errcode?(d=a.result,b.isArray(d.data)&&(e=d.data,b.each(e,function(a,b){x(p(b))})),d.more||(q.parent().addClass("hide"),1===v.page&&0===e.length&&l.find(".we-nothing").removeClass("hide")),v.page++):c.msg(a.errmsg,5)},complete:function(){q.removeClass("disabled").text(q.data("originalText"))}})},x=function(a){var c=n.height(),d=0;o.each(function(a){var e=b(this).height();c>e&&(c=e,d=a)}),o.eq(d).append("<li>"+a+"</li>")},y=function(){var a=g.find(".active > a").data("toggle").replace("message.","");a&&(t[a]=h.html())},z=function(a){return a.replace(/<(\/?\w+)?[^<]*>/gim,function(a,b){var c="";switch(b.toLowerCase()){case"br":case"/h1":case"/h2":case"/h3":case"/h4":case"/h5":case"/h6":case"/p":case"/div":c="<br>"}return c}).replace(/&nbsp;/g," ")},A=function(){var a,b,c=g.find(".active > a").data();j.val(c.type).data("typeName",c.typeName),"true"===h.prop("contenteditable")?B():(a=h.html(),b=h.find(".material").data("id"),i.val(b).data("content",a).trigger("change"))},B=function(b){var c,d,e,f,g,j=h[0],l=!0;"false"!==h.prop("contenteditable")&&(c=h.html(),c=c.replace(/&nbsp;/g," ").replace(/\s+$/,""),/<[^<]+>/.test(c)&&(d=z(c),d!==c&&(c=d,h.html(c),13===b&&a.getSelection&&(e=a.getSelection(),e.selectAllChildren(j),e.collapseToEnd()))),f=c.replace(/<br>/g," ").length,f<s.minLength?g=s.minText.replace("%s",s.minLength):f>s.maxLength?(l=!1,g=s.maxText.replace("%s",s.maxLength).replace("%s",f-s.maxLength)):s.required&&0===f?(l=!1,g=s.helpText.replace("%s",s.maxLength)):g=s.helpText.replace("%s",s.maxLength-f),k.text(g),h.data("valid",l),i.val(c).data("content",c).trigger("change"))};return"undefined"!=typeof h.attr("disabled")?(g.find("a").addClass("disabled"),h.prop("contenteditable",!1).data("valid",!0),f.find(".editor-clear").addClass("hide"),void f.find(".editor-btns").addClass("invisible")):(b.trim(h.text()).length&&h.data("valid",!0),A(),q.data("originalText",q.text()),g.on("click","[data-toggle^='message']",function(a){var c=b(this),d=c.parent(),f=d.hasClass("active"),g=c.data(),i=g.toggle.replace("message.","");if(a.preventDefault(),!c.hasClass("disabled"))switch(e=d,y(),i){case"text":f||(e.addClass("active").siblings().removeClass("active"),h.prop("contenteditable",!0),h.empty().html(t[i]),A());break;case"single":case"multiple":f||(r.addClass("disabled"),q.text(q.data("loading")).addClass("disabled")),l.one("shown.bs.modal",function(){f?1===v.page&&w(g):(v.page=1,o.empty(),w(g))}).one("hidden.bs.modal",function(){e&&!e.hasClass("active")&&(v.page=1,o.empty())}),m.removeClass("active"),"single"===i?m.first().addClass("active"):m.last().addClass("active"),l.modal("show")}}),B(),h.on("keyup blur",function(a){B(a.which)}),h.on("paste",function(){console.log("Pasted!"),setTimeout(function(){B()},50)}),void l.on("click","[data-toggle^='material']",function(){var a,c=b(this),d=c.data(),f=d.toggle.replace("material.","");if(!c.hasClass("disabled"))switch(f){case"load":w();break;case"select":c.hasClass("selected")||(o.find(".selected").removeClass("selected"),c.addClass("selected"),r.addClass("disabled"),r.hasClass("disabled")&&r.removeClass("disabled"));break;case"selected":a=o.find(".selected"),a.length&&(a=a.clone().removeClass("selected").removeAttr("data-toggle"),h.prop("contenteditable",!1).empty().html(a),k.empty(),e&&!e.hasClass("active")&&e.addClass("active").siblings().removeClass("active"),A()),l.modal("hide")}}))}}(window,jQuery,WeLife),function(a,b,c){"use strict";var d=b(document);c.shop=function(a,e){function f(){var a=i.val();if(a){if(o)return void p.filter("[data-shop-id='"+a+"']").radio("check");"all"===a.toLowerCase()?(m.checkbox("check"),p.checkbox("check")):(a=a.match(/\d+/g),a&&a.length&&(m.checkbox("uncheck"),p.checkbox("uncheck"),b.each(a,function(a,b){p.filter("[data-shop-id='"+b+"']").checkbox("check")})))}}function g(a){var c,d;b.isArray(a)&&(c=s({shops:a}),p.append(c),p=p.children(),o=p.filter(".we-radio").length>0,o||(p.checkbox("enable"),d=p.length,e||p.on("checked.we.checkbox",function(){p.filter(".checked").length===d&&(n=!1,m.checkbox("check"))}),p.on("unchecked.we.checkbox",function(){p.filter(".checked").length!==d&&(n=!1,m.checkbox("uncheck"))})),f(),l.collapse("toggle"))}var h=a?a.find(".we-shop-container"):b(".we-shop-container"),i=h.find(".shop-checked-ids"),j=h.find(".shop-toggle"),k=h.find(".shop-checked-list"),l=h.find(".we-shop"),m=l.find(".shop-check-all"),n=!0,o=!1,p=l.find(".shop-list"),q=p.data("viewTemplate"),r=q?b(q):l.find(".shop-list-template"),s=_.template(r.text()),t=l.find(".shop-confirm"),u=l.find(".shop-cancel"),v=j.data(),w=!1;j.click(function(){w?(f(),l.collapse("toggle")):c.shop.data?(w=!0,g(c.shop.data)):b.ajax(v.url,{data:v,dataType:"json",success:function(a){0===a.errcode?(w=!0,c.shop.data=a.result,g(a.result)):console.log(a.errmsg)}})}),m.on({"checked.we.checkbox":function(){n&&p.checkbox("check"),n=!0},"unchecked.we.checkbox":function(){n&&p.checkbox("uncheck"),n=!0}}),t.click(function(){var a=[],d=[];m.hasClass("checked")?(d.push("全部门店"),a.push("all")):p.filter(".checked").each(function(){var c=b(this);d.push(c.text()),a.push(c.data("shopId"))}),d.length?(k.html("<li>"+d.join("</li><li>")+"</li>"),i.val(a.join()).data("shop",d.join("&nbsp;&nbsp;")).trigger("change.we.shop"),l.collapse("hide"),j.text("更改")):c.msg("请选择门店",4)}),u.click(function(){l.collapse("hide")}),l.on("shown.bs.collapse",function(){var a=this;d.on("click.we.shop",function(b){for(var c=b.target,d=!0;"BODY"!==c.tagName;){if(c===a){d=!1;break}c=c.parentNode}d&&l.collapse("hide")})}).on("hidden.bs.collapse",function(){d.off("click.we.shop")})},c.shop.data=null}(window,jQuery,WeLife),function(a,b,c){"use strict";c.timeRange=function(){function a(a){var c=s.children().length,d=b(j);c>0&&d.find(".time-range-title").addClass("hide"),c>=3?d.find(".btn-plus").addClass("hide"):a&&s.find(".btn-plus").addClass("hide"),a&&d.find(".time-range-item").val(a),s.append(d)}function c(){u=0,v=0,w=0,d="",e="",r.removeClass("active enable"),l.removeClass("hide"),m.removeClass("show"),n.empty()}var d,e,f,g,h=b(".we-time-range-group"),i=h.find(".time-range-toggle"),j=h.find("#time-range-template").text(),k=h.find(".time-range"),l=k.find(".time-range-help"),m=k.find(".time-range-note"),n=m.find(".time-range-hours"),o=k.find(".time-range-confirm"),p=k.find(".time-range-cancel"),q=k.find(".time-table-list"),r=q.children(),s=h.find(".time-range-list"),t=s.data("existedTimeRanges"),u=0,v=0,w=0;b.isArray(t)&&t.length&&(i.addClass("hide"),s.addClass("show"),b.each(t,function(b,c){a(c)})),i.click(function(){i.addClass("hide"),s.addClass("show"),a()}),s.on("click","[data-toggle^='time.range']",function(){var d,e,g=b(this),h=g.data("toggle");switch(f=null,h){case"time.range.val":f=g,g.after(k),c(),k.addClass("show");break;case"time.range.add":c(),a(),g.addClass("hide");break;case"time.range.del":s.after(k),g.parent().remove(),d=s.find(".btn-plus"),e=s.find(".time-range-title"),e.addClass("hide"),e.first().removeClass("hide"),d.addClass("hide"),d.last().removeClass("hide"),s.children().length||(i.removeClass("hide"),s.removeClass("show"))}}),r.each(function(a){b(this).attr("data-index",a)}),q.on("click","li",function(){var a,c=b(this),f=w;c.hasClass("active")||(a=c.data("index"),0===u?(u++,v=a,l.addClass("hide"),m.addClass("show")):1===u?(u++,v>a?(w=v,v=a):w=a,r.slice(v+1,w).addClass("enable")):2===u&&(v>a?(r.slice(a+1,v).addClass("enable"),r.slice(v+1,w).removeClass("enable"),w=v,v=a):a>w?(r.slice(w,a).addClass("enable"),w=a):(v+w)/2>a?(r.slice(v+1,a+1).removeClass("enable"),f=v,v=a):(r.slice(a,w).removeClass("enable"),w=a),r.eq(f).removeClass("active")),c.addClass("active"),d=r.eq(v).text(),e=w?r.eq(w).text():"",g=d+" - "+e,n.text(g))}),o.click(function(){d&&e&&f.val(g),k.removeClass("show")}),p.click(function(){k.removeClass("show")})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.uploader=function(d){var e=d&&"undefined"!=typeof d.selector?d:b(".we-uploader"),f=e.find(".upload-step-one"),g=e.find(".upload-step-two"),h=e.find(".upload-step-three"),i=e.find(".progressbar"),j=e.find(".percentage"),k=e.find(".upload-preview"),l=e.find(".upload-view"),m=e.find(".js-uploaded"),n=e.find(".js-uploaded-id"),o=e.find(":file"),p=e.find(".help-block"),q=o.attr("name"),r=o.data(),s=!!a.FormData,t=function(a){var b;a.lengthComputable&&(b=a.loaded/a.total*100+"%",i.width(b),j.text(b))},u=function(a){var e,i=new XMLHttpRequest;s&&(e=new FormData,e.append(q,a),i.upload.onprogress=t,b.ajax(r.url,{type:"POST",data:e,dataType:"json",processData:!1,contentType:!1,xhr:function(){return i},beforeSend:function(){f.addClass("hide"),g.removeClass("hide"),k.html(a.name+" <span>"+(Math.round(a.size/1024)+"KB")+"<span")},success:function(e){var i;0===e.errcode?(i=e.result,m.val(i.url).data("imageId",i.id),n.val(i.id),l.html('<img src="'+i.url+'" alt="'+a.name+'">'),g.addClass("hide"),h.removeClass("hide"),b.isFunction(d.done)&&d.done(i)):(c.msg(e.errmsg,5),f.removeClass("hide"),g.addClass("hide"),k.empty())},complete:function(){o.val(null)}}))};return"destroy"===d?(o.off(),void c.popoverConfirm("destroy")):(d&&"undefined"!=typeof d.selector&&(d=arguments[1]),d=b.isPlainObject(d)?d:{},o.on("change",function(){var a,b,c,d=this.files;d&&d.length>0&&(a=d[0],b=a.size/1024,/image\/(jpg|jpeg|png|gif)/.test(a.type)?b<=r.maxsize?u(a):c=p.data("size").replace(/\d+/,r.maxsize):c=p.data("type"),c?(p.text(c),o.val(null)):p.text(""))}),c.popoverConfirm({namespace:d.namespace,message:"确定要删除该图片吗？",confirm:function(){m.val(""),n.val(""),l.empty(),k.empty(),p.text(""),f.removeClass("hide"),g.addClass("hide"),h.addClass("hide"),b.isFunction(d.fail)&&d.fail()}}),void(m.val()&&(f.addClass("hide"),g.addClass("hide"),h.removeClass("hide"),l.html('<img src="'+m.val()+'" alt="">'))))}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.assign=function(b,d){b&&"string"==typeof b&&(d="number"==typeof d?d:2e3,"reload"===b?c.reload(d):setTimeout(function(){a.location.assign(b)},d))},c.reload=function(b){b="number"==typeof b?b:2e3,setTimeout(function(){a.location.reload()},b)},c.showError=function(a,b){var c=a.closest(".form-group").find(".control-label").next(),d=c.find(".highlight");d.length?b?(a.focus(),d.text(b).removeClass("hide")):d.empty().addClass("hide"):c.append('<p class="help-block highlight">'+(b||"")+"</p>")},c.respond=function(a,d){if(b.isPlainObject(a))switch(a.errcode){case 0:c.msg(a.errmsg,2),c.$main.find(".form-group .highlight").empty().addClass("hide"),(a.returnurl||a.redirect)&&c.assign(a.returnurl||a.redirect),d&&b.isFunction(d.success)&&d.success();break;case 1:c.msg(a.errmsg,5),c.$main.find("form :submit").prop("disabled",!1);break;case 100:c.msg(a.errmsg,5),function(a){var d=c.$main.find("form");b.each(a,function(a,b){var e,f=d.find("[name^='"+a.replace("[]","")+"']");try{if("activityExisted"===a)return e=c.$main.find(".existed-modal"),e.find(".modal-body").text(b.message),"continue"===b.style?(e.find(".btn-primary").removeClass("hide"),e.find(".btn-default").text("取消")):"break"===b.style&&(e.find(".btn-primary").addClass("hide"),e.find(".btn-default").text("确定")),void e.modal("show")}catch(g){console.log(g.message)}f.length&&c.showError(f,b)})}(a.result),d&&b.isFunction(d.error)&&d.error();break;default:c.msg(a.errmsg,5)}},require(["validate"],function(){b.fn.validate.setDefaults({showErrors:function(a,d){c.showError(b(a),d)},hideErrors:function(a){c.showError(b(a))}})}),c.util={back:function(){a.history.back()},captcha:function(){var a=b(this),c=a.data("originalSrc");a.is("img")&&(c||a.data("originalSrc",c=a.attr("src").replace(/\?.*?$/,"")),a.attr("src",c+"?timestamp="+(new Date).getTime()))},toggle:function(){var a=b(this).data();a.target&&(b(a.target).removeClass("hide"),a.parent&&b(a.parent).addClass("hide"))},formatNumber:function(a,b){var c,d=[];for(b="number"==typeof b?a.toFixed(b).toString().substr(-++b):"",a=parseInt(a,10)||0,a=a.toString().split(""),c=a.length;c>0;c-=3)d.unshift((a[c-3]||"")+(a[c-2]||"")+(a[c-1]||""));return d.join()+b}},b(document).on("click","[data-click]",function(){var a=b(this).data("click"),d=c[a]||c.util[a];b.isFunction(d)&&d.call(this)})}(window,jQuery,WeLife),function(a,b,c){"use strict";c.user={},c.login=function(){var a=b(".user-login"),d=a.find(".we-form");d.submitter({done:function(a){c.respond(a)}})},c.forgot={},c.forgot.auth=function(){var a=b(".user-forgot-auth"),d=a.find(".we-form"),e=d.find(".we-resend > .btn"),f=d.find(".input-captcha"),g=e.text(),h=e.data(),i=parseInt(g.replace(/\D+/,""),10),j=g.replace(/\d+/,""),k=function(){var a,b=i||60;e.addClass("disabled"),a=setInterval(function(){e.text(b--+j),0>=b&&(clearInterval(a),e.text(h.text).removeClass("disabled"))},1e3)};k(),e.click(function(){var a=b(this);a.hasClass("disabled")||(a.addClass("disabled"),b.ajax(h.url,{type:"post",data:h,dataType:"json",success:function(a){0===a.errcode?(f.focus(),k()):c.msg(a.errmsg,5)}}))})},c.password=function(){}}(window,jQuery,WeLife),function(a,b,c){"use strict";var d=b(".mainbody"),e=d.find(".we-form"),f=e.find(".input-name"),g=e.find(".coupon-list"),h={name:function(){var a=b.trim(f.val()),c=f.closest(".form-group").find(".help-block");return f.val(a),a?(c.addClass("hide"),!0):(c.removeClass("hide"),f.focus(),!1)},coupon:function(){return 0===g.children().length?(c.msg("请设置赠券",4),!1):!0}};c.market={},c.market._new_={},c.market._new_.care=function(){var a,d=b(".market-new-care"),e=d.find(".we-step"),f=d.find(".we-alert"),g=d.find(".we-form"),i=g.find(".form-input"),j=i.find(".input-name"),k=i.find(".coupon-list"),l=i.find(".input-coupon"),m=i.find(".input-start-date"),n=i.find(".input-end-date"),o=g.find(".form-next"),p=o.find(".input-type"),q=o.find(".input-content"),r=g.find(".form-output"),s=g.find(".form-output-template").text(),t=!0,u={};d.on("click","[data-toggle^='activity']",function(){var c=b(this),d=c.data(),v=d.toggle.replace("activity.","");switch(a=v,v){case"next":t=!0;break;case"skip":t=!1,f.addClass("hide"),e.find("li:eq(1)").addClass("active"),i.addClass("hide"),o.removeClass("hide");break;case"prev":f.removeClass("hide"),e.removeClass("hide").find("li:eq(1)").removeClass("active"),i.removeClass("hide"),o.addClass("hide"),r.addClass("hide");break;case"save":if(!h.message())break;t&&(u.coupons=[],l.val(function(){var a=[];return k.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),u.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),u.name=j.val(),u.startDate=m.val(),u.endDate=n.val()),u.messageType=p.data("typeName"),u.messageContent=q.data("content"),r.empty().html(_.template(s,u)),e.addClass("hide"),o.addClass("hide"),r.removeClass("hide");break;case"confirm":g.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":e.removeClass("hide"),o.removeClass("hide"),r.addClass("hide")}}),h.message=function(){return q.val()?!0:(c.msg("消息内容不能为空",4),!1)},j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.popoverNotice(d),c.couponEditor(d),c.date(d,{startDate:new Date,endViewDate:function(a){return new Date(a.getFullYear()+1,a.getMonth(),a.getDate())}(new Date)}),c.messageEditor(d),g.submitter({isValidated:function(){return"next"===a?h.name()&&j.validate("validate")&&h.coupon():h.message()},done:function(b){c.respond(b,{success:function(){"next"===a&&(f.addClass("hide"),e.find("li:eq(1)").addClass("active"),i.addClass("hide"),o.removeClass("hide"))}})}})},c.market._new_.fill=function(){var a,d=b(".market-new-fill"),e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),i=f.find(".coupon-list"),j=f.find(".input-coupon"),k=f.find(".input-restriction"),l=e.find(".form-output"),m=d.find(".existed-modal"),n=m.data("existed"),o=e.find(".form-output-template").text(),p={};n&&d.find("button[data-toggle='activity.save']").attr("type","button"),d.on("click","[data-toggle^='activity']",function(){var c=b(this),d=c.data(),g=d.toggle.replace("activity.","");switch(a=g,g){case"save":n&&m.modal("show");break;case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":f.removeClass("hide"),l.addClass("hide")}}),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.popoverNotice(d),c.couponEditor(d),c.textEditor(d),e.submitter({isValidated:function(){return n?!1:g.validate("validate")&&h.coupon()},done:function(d){c.respond(d,{success:function(){"save"===a&&(p.coupons=[],j.val(function(){var a=[];return i.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),p.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),p.name=g.val(),p.restriction=k.val(),l.empty().html(_.template(o,p)),f.addClass("hide"),l.removeClass("hide"))}})}})},c.market._new_.remind=function(){var a,d=b(".market-new-remind"),e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),i=f.find(".coupon-list"),j=f.find(".input-coupon"),k=f.find(".input-date"),l=f.find(".input-time"),m=e.find(".form-output"),n=e.find(".form-output-template").text(),o={};d.on("click","[data-toggle^='activity']",function(){var c=b(this),d=c.data(),g=d.toggle.replace("activity.","");switch(a=g,g){case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":f.removeClass("hide"),m.addClass("hide")}}),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.couponEditor(d),c.date(d,{startDate:new Date}),c.shop(d),e.submitter({isValidated:function(){return g.validate("validate")&&h.coupon()},done:function(d){c.respond(d,{success:function(){"save"===a&&(o.coupons=[],j.val(function(){var a=[];return i.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),o.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),o.name=g.val(),o.date=k.val(),o.time=l.val(),m.empty().html(_.template(n,o)),f.addClass("hide"),m.removeClass("hide"))}})}})},c.market._new_.member=function(a){var d,e=a||b(".market-new-member"),f=e.find(".we-form"),g=f.find(".form-input"),i=g.find(".input-name"),j=g.find(".coupon-list"),k=g.find(".input-coupon"),l=g.find(".input-date"),m=g.find(".input-time"),n=g.find(".input-shop"),o=f.find(".form-output"),p=f.find(".form-output-template").text(),q={};e.on("click","[data-toggle^='activity']",function(){var a=b(this),c=a.data(),e=c.toggle.replace("activity.","");switch(d=e,e){case"confirm":f.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":g.removeClass("hide"),o.addClass("hide")}}),i.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.couponEditor(e),c.date(e,{startDate:new Date}),c.shop(e),f.submitter({isValidated:function(){return i.validate("validate")&&h.coupon()},done:function(a){c.respond(a,{success:function(){"save"===d&&(q.coupons=[],k.val(function(){var a=[];return j.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),q.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),q.name=i.val(),q.date=l.val(),q.time=m.val(),q.shop=n.closest(".form-group").hasClass("hide")?"":n.data("shop"),o.empty().html(_.template(p,q)),g.addClass("hide"),o.removeClass("hide"))}})}})},c.market.old={},c.market.old.active=function(){c.market._new_.member(b(".market-old-active"))},c.market.old.silent=function(){c.market._new_.member(b(".market-old-silent"))},c.market.old.member=function(){c.market._new_.member(b(".market-old-member"))},c.market.sales={},c.market.sales.count=function(a){var d,e=a||b(".market-sales-count"),f=e.find(".we-alert"),g=e.find(".we-form"),i=g.find(".form-input"),j=i.find(".input-name"),k=i.find(".input-type"),l=i.find(".input-amount"),m=i.find(".coupon-list"),n=i.find(".input-coupon"),o=i.find(".input-time-range"),p=i.find(".input-shop"),q=i.find(".input-restriction"),r=g.find(".form-output"),s=g.find(".form-output-template").text(),t={};e.on("click","[data-toggle^='activity']",function(){var a=b(this),c=a.data(),e=c.toggle.replace("activity.","");switch(d=e,e){case"confirm":g.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":i.removeClass("hide"),f.removeClass("hide"),r.addClass("hide")}}),j.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),l.validate(),k.on("change",function(){"次"===k.find(":selected").data("unit")?l.prop("max",20).validate("update"):l.prop("max",999999).validate("update")}),q.validate({filter:function(){return b(this).data("text")}}),c.popoverNotice(e),c.couponEditor(e),c.date(e,{startDate:new Date,endViewDate:function(a){return new Date(a.getFullYear()+1,a.getMonth(),a.getDate())}(new Date)}),c.shop(e,!0),c.textEditor(e),g.submitter({isValidated:function(){return j.validate("validate")&&l.validate("validate")&&h.coupon()&&q.validate("validate")},done:function(e){c.respond(e,{success:function(){"save"===d&&(t.startDate=i.find(".input-start-date").val(),t.endDate=i.find(".input-end-date").val(),t.timeRange="",a&&(t.timeRange=function(){var a=[];return i.find(".time-range-item").each(function(){a.push(b(this).val())}),o.val(a.join()),a.length?a.join(" / "):""}()),t.coupons=[],n.val(function(){var a=[];return m.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),t.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),t.name=j.val(),t.amount=l.val(),k.length&&(t.amountUnit=i.find(".condition-unit").text()),t.shop=p.closest(".form-group").hasClass("hide")?"":p.data("shop"),t.restriction=q.val(),r.empty().html(_.template(s,t)),i.addClass("hide"),f.addClass("hide"),r.removeClass("hide"))}})}})},c.market.sales.spend=function(){c.market.sales.count(b(".market-sales-spend")),c.timeRange()},c.market.member={},c.market.member.all=function(){var a,d=b(".market-member-all"),e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),i=f.find(".coupon-list"),j=f.find(".input-coupon"),k=f.find(".input-date"),l=f.find(".input-time"),m=f.find(".input-shop"),n=e.find(".form-output"),o=e.find(".form-output-template").text(),p={};d.on("click","[data-toggle^='activity']",function(){var c=b(this),d=c.data(),g=d.toggle.replace("activity.","");switch(a=g,g){case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":f.removeClass("hide"),n.addClass("hide")}}),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.couponEditor(d),c.date(d,{startDate:new Date}),c.shop(d),e.submitter({isValidated:function(){return g.validate("validate")&&h.coupon()},done:function(d){c.respond(d,{success:function(){"save"===a&&(p.coupons=[],j.val(function(){var a=[];return i.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),p.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),p.name=g.val(),p.date=k.val(),p.time=l.val(),p.shop=m.closest(".form-group").hasClass("hide")?"":m.data("shop"),n.empty().html(_.template(o,p)),f.addClass("hide"),n.removeClass("hide"))
}})}})},c.market.member.birthday=function(){var a,d=b(".market-member-birthday"),e=d.find(".we-form"),f=e.find(".form-input"),g=f.find(".input-name"),i=f.find(".coupon-list"),j=f.find(".input-coupon"),k=f.find(".input-restriction"),l=e.find(".form-output"),m=d.find(".existed-modal"),n=m.data("existed"),o=e.find(".form-output-template").text(),p={};n&&d.find("button[data-toggle='activity.save']").attr("type","button"),d.on("click","[data-toggle^='activity']",function(){var c=b(this),d=c.data(),g=d.toggle.replace("activity.","");switch(a=g,g){case"save":n&&m.modal("show");break;case"confirm":e.submitter("setDefaults",{disableAfterDone:!0});break;case"modify":f.removeClass("hide"),l.addClass("hide")}}),g.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),c.popoverNotice(d),c.couponEditor(d),c.textEditor(d),e.submitter({isValidated:function(){return n?!1:g.validate("validate")&&h.coupon()},done:function(d){c.respond(d,{success:function(){"save"===a&&(p.coupons=[],j.val(function(){var a=[];return i.find("li").each(function(){var c=b(this),d=b(this).data();d.value&&(d=b.extend({},d),d.name=d.name.replace(/^\d+\u5143/,"")),p.coupons.push(d),d.count=c.find(".coupon-input").val(),a.push(d.id+","+d.count)}),a.join(";")}),p.name=g.val(),p.restriction=k.val(),l.empty().html(_.template(o,p)),f.addClass("hide"),l.removeClass("hide"))}})}})},c.coupon={},c.coupon.manage=function(){var a=b(".coupon-manage"),d=a.find(".voucher-list"),e=a.find(".voucher-modal"),f=e.find(".voucher-detail"),g=_.template(e.find("#voucher-detail-template").text());d.on("click","[data-toggle='voucher.detail']",function(a){var c=b(this).closest("li").data();a.preventDefault(),c=b.extend({},c),c.name=c.value?c.name.replace(/^\d+\u5143/,""):c.name,c.term=c.term.split(/\s*\,\s*/),f.html(g(c)),e.modal("show")}),c.popoverConfirm({message:"确定要删除此券么？",confirm:function(){var a=b(this),d=a.data("id");b.ajax(c.DEFAULTS.ajaxDeleteUrl,{async:!1,type:"POST",data:{id:d},dataType:"json",success:function(b){c.respond(b,{success:function(){a.closest("li").remove()}})}})}})},c.coupon.create=function(){var a=b(".coupon-create"),d=a.find(".we-form"),e=d.find(".form-input"),f=d.find(".input-value"),g=d.find(".input-name-prefix"),i=d.find(".input-name"),j=d.find(".input-term"),k=d.find(".term-absolute"),l=d.find(".term-relative"),m=l.find(".input-term-count"),n=d.find(".input-shop"),o=d.find(".input-restriction"),p=d.find(".form-output"),q=d.find(".form-output-template").text(),r={};h.count=function(){return l.is(":visible")?m.validate("validate"):!0},l.is(":visible")&&(l.data("active",!0),m.validate()),k.is(":visible")&&(k.data("active",!0),c.date(a,{startDate:new Date})),a.on("click","[data-toggle^='coupon']",function(){var d=b(this),g=d.data(),s=g.toggle.replace("coupon.","");switch(s){case"relative":l.removeClass("hide"),k.addClass("hide"),l.data("active")||(l.data("active",!0),m.validate()),l.parent().find(".highlight").addClass("hide");break;case"absolute":l.addClass("hide"),k.removeClass("hide"),k.data("active")||(k.data("active",!0),c.date(a,{startDate:new Date})),k.parent().find(".highlight").addClass("hide");break;case"save":if(f.length&&!f.validate("validate"))return;if(!(i.validate("validate")&&h.count()&&o.validate("validate")))return;j.val(function(){var a=b(this).val();return l.hasClass("hide")?k.hasClass("hide")||(a=["absolute",k.find(".input-term-start").val(),k.find(".input-term-end").val()]):a=["relative",l.find(".input-term-count").val(),l.find(".input-term-unit").val()],b.isArray(a)?a.join():a}),r.value=f.val(),r.name=i.val(),r.term=j.val().split(/\s*\,\s*/),r.shop=n.closest(".form-group").hasClass("hide")?"":n.data("shop"),r.restriction=o.val(),p.html(_.template(q,r)),e.addClass("hide"),p.removeClass("hide");break;case"cancel":e.removeClass("hide"),p.addClass("hide")}}),f.validate(),f.on("keyup change",function(){var a=parseInt(b(this).val(),10);g.text(a&&a>0?a+"元":"")}),i.validate({charCodeLength:!0,trimOverflow:!0,trim:!0}),o.validate({filter:function(){return b(this).data("text")}}),c.popoverNotice(a),c.shop(a),c.textEditor(a),d.submitter({disableAfterDone:!0,isValidated:function(){return i.validate("validate")&&o.validate("validate")},done:function(b){c.respond(b,{error:function(){a.find("[data-toggle='coupon.cancel']").click()}})}})},c.activity={},c.activity.manage=function(){var d=b(".activity-manage"),e=d.find(".activity-list"),f=d.find(".activity-modal"),g=f.find(".activity-detail"),h=_.template(f.find("#activity-detail-template").text());e.on("click","[data-toggle='activity.detail']",function(a){var c=b(this).closest("tr").data();a.preventDefault(),c.message=c.message||"",c.shop=c.shop||"",g.html(h(c)),f.modal("show")}),c.popoverConfirm({message:"确定删除该活动？",confirm:function(){var a=b(this),d=a.data("id");b.ajax(c.DEFAULTS.ajaxDeleteUrl,{async:!1,type:"POST",data:{id:d},dataType:"json",success:function(b){c.respond(b,{success:function(){a.closest("tr").remove()}})}})}}),c.popoverConfirm({namespace:".terminate",message:"确定终止该活动？",confirm:function(){var d=b(this),e=d.data("id");b.ajax(c.DEFAULTS.ajaxTerminateUrl,{async:!1,type:"POST",data:{id:e},dataType:"json",success:function(b){0===b.errcode?a.location.reload():console.log(b.errmsg)}})}})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.message={},c.message.home=function(){function a(){return console.log(i.val()),i.val()?"true"!==j.prop("contenteditable")||j.data("valid")?!0:(c.msg("消息内容字数超出限制",4),!1):(c.msg("消息内容不能为空",4),!1)}var d=b(".message-home"),e=d.find("form"),f=e.find(".form-input"),g=e.find(".input-date"),h=e.find(".input-time"),i=e.find(".input-content"),j=e.find(".editor-input"),k=e.find(".send-remain-note > b"),l=e.find("[data-toggle='message.save']"),m=e.find(".form-output"),n=_.template(e.find(".form-output-template").text()),o={};d.on("click","[data-toggle^='message']",function(){var c=b(this),d=c.data(),e=d.toggle.replace("message.","");if(!c.hasClass("disabled")&&!c.prop("disabled"))switch(e){case"save":if(!a())break;o.date=g.val(),o.time=h.val(),o.content=i.data("content"),m.empty().html(n(o)),f.addClass("hide"),m.removeClass("hide");break;case"cancel":f.removeClass("hide"),m.addClass("hide")}}),c.messageEditor(d),c.date(d,{startDate:new Date}),g.on("changeDate",function(){var a=b(this);b.ajax(a.data("url"),{type:"POST",data:{date:a.val(),oldDate:a.data("oldDate")},dataType:"json",success:function(a){var b;0===a.errcode?(b=a.result.number,b&&b>0?l.removeClass("disabled").prop("disabled",!1):a.result.savable?l.removeClass("disabled").prop("disabled",!1):(l.addClass("disabled").prop("disabled",!0),b=0),k.text(b)):console.log(a.errmsg)}})}),e.submitter({disableAfterDone:!0,isValidated:function(){return a()},done:function(a){c.respond(a)}})},c.message.manage=function(){var d=b(".message-manage"),e=d.find(".message-modal"),f=e.find(".message-detail"),g=_.template(e.find(".message-detail-template").text());d.on("click","[data-toggle^='message']",function(a){var c,d=b(this),h=d.data(),i=h.toggle.replace("message.","");switch(a.preventDefault(),i){case"detail":c=d.closest("tr"),h=c.data(),h.type>0&&(h.content=c.find(".message-content").html()),f.empty().html(g(h)),e.modal("show")}}),c.popoverConfirm({message:"确定删除该消息？",confirm:function(){var c=b(this),d=c.data();b.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(b){0===b.errcode?a.location.reload():console.log(b.errmsg)}})}})},c.message.sms=function(){function a(a){a?t.count=a:a=t.count,t.total=t.people*a,t.charge=(t.total*t.rate).toFixed(2),q.text(a),r.text(t.total),s.text(t.charge),t.charge>t.balance?(v.addClass("disabled"),u.removeClass("hide")):(v.removeClass("disabled"),u.addClass("hide"))}function d(c){var d;c&&p.data("value",c),d=p.data(),d[d.name]=d.value,b.ajax(d.url,{async:!1,type:"POST",data:d,dataType:"json",success:function(b){var c;try{c=b.result.members||0,t.people=c,p.text(c),a()}catch(d){console.log(d.message)}}})}var e=b(".message-sms"),f=e.find("form"),g=f.find(".radio-group > .we-radio"),h=f.find(".we-date-group"),i=f.find(".input-date"),j=f.find(".input-time"),k=f.find(".input-shop"),l=f.find(".input-content"),m=f.find(".sms-charge"),n=m.find("[data-expicted='rate']"),o=m.find("[data-expicted='balance']"),p=m.find("[data-expicted='people']"),q=m.find("[data-expicted='count']"),r=m.find("[data-expicted='total']"),s=m.find("[data-expicted='charge']"),t={totalMembers:p.data("totalMembers")||0,rate:parseFloat(n.text())||0,balance:parseFloat(o.text())||0,people:parseInt(p.text(),10)||0,count:0,total:0,charge:0},u=f.find(".sms-notice"),v=f.find("[data-toggle='message.save']"),w=e.find(".message-modal"),x=w.find(".message-detail"),y=w.find("#message-detail-template").text();c.date(e,{startDate:new Date}),c.shop(e),d(),k.on("change.we.shop",function(){d(k.val())}),g.on("checked.we.radio",function(){1===b(this).data("value")?h.removeClass("hide"):h.addClass("hide")}),function(){var c=b(".smsbox"),d=c.find(".smsbox-input"),e=c.find("[data-counter='input']"),f=parseInt(d.attr("maxlength"),10),g=e.data("text"),h=c.find("[data-counter='msg']"),i=h.data("text"),j=h.data("msgLength");isNaN(f)||d.on("keyup blur",function(){var b,c=d.val(),k=c.length;return k>f?void d.val(c.substr(0,f)):(d.data("count",b=Math.ceil(k/j)),e.text(g.replace("%s",f-k)),h.text(i.replace("%s",b)),void a(b))})}(),e.on("click","[data-toggle^='message']",function(){var a=b(this),c=a.data(),d=c.toggle.replace("message.","");switch(d){case"save":if(!l.validate("validate"))break;c={content:l.val(),people:t.people,count:t.count},c.total=c.people*c.count,c.charge=.1*c.total,c.time=0===g.filter(".checked").data("value")?"立即发送":[i.val(),j.val()].join(" "),x.html(_.template(y,c)),w.modal("show")}}),f.submitter({isValidated:function(){return!0},done:function(a){c.respond(a,{success:function(){w.modal("hide")}})}})},c.message.sms.manage=function(){var a=b(".message-sms-manage"),d=a.find(".message-modal"),e=d.find(".message-detail"),f=d.find("#message-detail-template").text();a.on("click","[data-toggle^='message']",function(){var a=b(this),c=a.data(),g=c.toggle.replace("message.","");switch(g){case"detail":e.html(_.template(f,a.closest("tr").data())),d.modal("show")}}),c.popoverConfirm({message:"确定要删除么？",confirm:function(){var a=b(this),d=a.data();b.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(b){c.respond(b,{success:function(){a.closest("tr").remove()}})}})}})},c.message.sms.recharge=function(){var a=b(".message-sms-recharge"),d=a.find("form"),e=d.find(".input-amount"),f=d.find(".input-payment"),g=d.find(".recharge-modal"),h=g.find(".recharge-detail"),i=g.find("#recharge-detail-template").text();e.validate(),a.on("click","[data-toggle^='recharge']",function(){var a=b(this),c=a.data(),d=c.toggle.replace("recharge.","");switch(d){case"preview":if(!e.validate("validate"))break;c={amount:e.val(),payment:f.filter(".checked").data("payment")},h.html(_.template(i,c)),g.modal("show")}}),d.submitter({isValidated:function(){return e.validate("validate")},done:function(a){c.respond(a,{success:function(){g.modal("hide")}})}})},c.message.sms.invoice=function(){var a=b(".message-sms-invoice"),d=a.find("form");d.submitter({done:function(a){c.respond(a)}})},c.material={},c.material.manage=function(){c.popoverConfirm({message:"确定删除该素材？",confirm:function(){var c=b(this),d=c.data();b.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(b){0===b.errcode?a.location.reload():console.log(b.errmsg)}})}}),c.popoverConfirm({namespace:".edit",message:"确定编辑该素材？",confirm:function(){var c=b(this),d=c.data("url")||c.attr("href");d&&a.location.assign(d)}})},c.material.create=function(){var d,e=b(".material-create"),f=e.find(".material"),g=f.data(),h=f.offset().top,i=f.find(".material-item").length>0?5:6,j=f.find(".material-mini-template").text(),k=e.find("form"),l=k.find(".material-editor"),m=k.find("#inputTitle"),n=k.find("#inputImage"),o=k.find("#inputImageId"),p=k.find(".we-file > :file"),q=k.find(".image-title"),r=k.find(".thumb-title"),s=k.find(".upload-step-one"),t=k.find(".upload-step-three"),u=k.find("#inputVisible"),v=k.find(".material-summary-toggle"),w=k.find(".material-summary"),x=k.find("#inputSummary"),y=k.find("#inputContent"),z=k.find(".auto-save-info"),A=k.find(".material-link-toggle"),B=k.find(".material-link"),C=k.find("#inputLink"),D=!1,E=!1,F={title:m.attr("name"),image:n.attr("name"),imageId:o.attr("name"),visible:u.attr("name"),summary:x.attr("name"),content:y.attr("name"),link:C.attr("name")},G=f.find(".active"),H=function(){var a=function(a){return"number"==typeof a||"boolean"==typeof a?a=String(a):"object"==typeof a&&null!==a&&(a=b.isFunction(a.toString)?a.toString():a),a||""};f.find(".material-unit").each(function(){var c=b(this),d=c.data();c.find("[data-view='title']").text(function(){var c=a(d[F.title]);return c?c:b(this).attr("placeholder")}),c.find("[data-view='summary']").html(function(){var b=a(d[F.summary]);return b?b.replace(/[\r\n]+/gim,"<br>"):""}),c.find("[data-view='image']").html(function(){var b=a(d[F.image]);return b?'<img src="'+b+'">':""})})},I=function(){var a=G.data(),b=a[F.title],c=a[F.image],e=a[F.imageId],f=a[F.visible],g=a[F.summary],i=a[F.content],j=a[F.link],k=G.hasClass("material-mini"),z='<img src="'+c+'" alt="">';a&&(l.css("marginTop",G.offset().top-h),m.val(b),q.toggleClass("hide",k),r.toggleClass("hide",!k),s.toggleClass("hide",!!c),t.toggleClass("hide",!c),n.val(c),o.val(e),c?t.find(".upload-view").html(z):(s.find(".help-block").empty(),t.find(".upload-view").empty()),k?p.data("maxsize",20):p.data("maxsize",50),u.parent().toggleClass("checked",f),u.prop("checked",f),v.toggleClass("hide",!!g),w.toggleClass("hide",!g),x.val(g),y.val(i),d.setContent(i),A.toggleClass("hide",!!j),B.toggleClass("hide",!j),C.val(j))},J=function(){var a=k.serializeArray();b.each(a,function(a,b){"on"===b.value&&(b.value=!0),G.data(b.name,b.value)}),G.data(F.visible,!!u.prop("checked"))},K={localStorage:a.localStorage||{getItem:b.noop,setItem:b.noop,removeItem:b.noop},token:c.DEFAULTS.token||"com.dianping.welife",formatDate:function(a){var b=new Date(a),c=[b.getHours(),b.getMinutes(),b.getSeconds()];return a=[b.getFullYear(),b.getMonth()+1,b.getDate()],a[1]=a[1]<10?"0"+a[1]:a[1],a[2]=a[2]<10?"0"+a[2]:a[2],c[0]=c[0]<10?"0"+c[0]:c[0],c[1]=c[1]<10?"0"+c[1]:c[1],c[2]=c[2]<10?"0"+c[2]:c[2],a.join("/")+" "+c.join(":")},getData:function(){var a=this.localStorage.getItem("localMaterial");try{"string"==typeof a&&(a=JSON.parse(a))}catch(c){console.log(c.message)}return a=b.isPlainObject(a)?a:{},console.log("Get: ",a),a},setData:function(a){console.log("Set: ",a);try{(a.single.messages||a.multiple.messages)&&(a={}),"string"!=typeof a&&(a=JSON.stringify(a))}catch(b){console.log(b.message)}this.localStorage.setItem("localMaterial",a)},getOriginalMaterial:function(){var a;return a=5===i?{messages:[{link:"",content:"",visible:!0,image:"",title:"",imageId:"",summary:""}]}:{messages:[{link:"",content:"",visible:!0,image:"",title:"",imageId:""},{link:"",content:"",visible:!0,image:"",title:"",imageId:""}]}},setMaterial:function(){var a,c,d,e,h=f.find(".material-unit"),j=this.getData(),k=new Date,l=this.formatDate(k);return j.token!==this.token&&(j={token:this.token,single:{create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()},multiple:{create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()}}),J(),E=!1,c=5===i?"single":"multiple",d=g.id?"modify":"create",a=j[c],b.isPlainObject(a)?a=a[d]:(j[c]={create:this.getOriginalMaterial(),modify:this.getOriginalMaterial()},a=j[c][d]),b.isPlainObject(a)||(a=j[c][d]={messages:[]}),h.each(function(c){var d=b(this).data();_.isEqual(d,a.messages[c])||(E=!0,a.id=g.id,a.date=k,a.messages[c]=d)}),h.length<a.messages.length&&(E=!0,a.messages=a.messages.slice(0,h.length)),this.setData(j),E&&(e="（自动保存："+l+"）",z.text(e)),e},removeMaterial:function(){var a,c,d=this.getData();d.token===this.token&&(a=5===i?"single":"multiple",c=g.id?"modify":"create",b.isPlainObject(d[a])&&(d[a][c]=this.getOriginalMaterial()),this.setData(d),z.empty())},restoreMaterial:function(){var a,c,d,e,h,k,l=this.getData(),m="";if(l.token===this.token){if(h=5===i?"single":"multiple",k=g.id?"modify":"create",a=l[h],b.isPlainObject(a)&&(a=a[k]),b.isPlainObject(a)||(a={messages:[]}),!g.id||g.id===a.id){if(6===i){for(e=a.messages.length,e>8&&(e=8),8===e&&f.find(".material-add").addClass("hide"),e-=f.find(".material-unit").length;e>0;)m+=j,e--;f.find(".material-add").before(m)}f.find(".material-unit").each(function(e){var f=b(this),g=a.messages[e];b.isPlainObject(g)&&(d=!0,c=a.date,b.each(g,function(a,b){f.data(a,b)}))})}d&&c&&(c=this.formatDate(c),z.html(function(){return"<span>（已载入 "+c+' 的草稿）</span><a href="javascript:void(0);" data-toggle="material.reset">取消</a>'}))}},autoSaveMaterial:function(){this.autoSave=setInterval(function(){K.setMaterial()},12e4)},destroy:function(){this.autoSave&&clearInterval(this.autoSave)}};K.restoreMaterial(),K.autoSaveMaterial(),d=UE.getEditor("inputContent",{toolbars:[["bold","italic","underline","|","insertorderedlist","insertunorderedlist","|","simpleupload","|","removeformat","forecolor","backcolor"]],initialFrameWidth:500,initialFrameHeight:200,autoHeightEnabled:!1,autoFloatEnabled:!1,enableAutoSave:!1,maximumWords:2e4,elementPathEnabled:!1}),d.ready(function(){H(),I()}),m.on("keyup blur",function(){var a=b(this),c=G.find("[data-view='title']"),d=b.trim(a.val());c.text(d?d:c.data("placeholder")),a.val(d)}),x.on("keyup blur",function(){var a=b(this).val();a=a.replace(/[\r\n]+/gim,"<br>"),G.find("[data-view='summary']").html(a)}),c.uploader({done:function(a){G.find("[data-view='image']").html('<img src="'+a.url+'">')},fail:function(){G.find("[data-view='image']").empty()}}),6===i&&f.find(".material-unit").length>2&&f.find(".material-mini").find(".icon-remove").removeClass("disabled"),e.on("click","[data-toggle^='material']",function(){var d,e,h=b(this),k=h.data(),l=k.toggle.replace("material.",""),m=!0;if(!h.prop("disabled")&&!h.hasClass("disabled"))switch(l){case"summary":v.addClass("hide"),w.removeClass("hide");break;case"link":A.addClass("hide"),B.removeClass("hide");break;case"modify":J(),e=h.closest(".material-unit"),h.addClass("disabled"),f.find(".active").removeClass("active").find(".icon-modify").removeClass("disabled"),G=e,G.addClass("active"),I();break;case"remove":e=h.closest(".material-unit"),J(),G=e.prev(),G.addClass("active"),I(),e.remove(),d=f.find(".material-unit"),d.length<=2&&d.find(".icon-remove").addClass("disabled"),d.length<8&&f.find(".material-add").removeClass("hide");break;case"add":J(),d=f.find(".material-unit"),e=h.parent(),d.length>=2&&d.filter(".material-mini").find(".icon-remove").removeClass("disabled"),d.length>=7&&e.addClass("hide"),d.filter(".active").removeClass("active").find(".icon-modify").removeClass("disabled"),G=b(j),G.addClass("active"),e.before(G),I();break;case"save":J(),b.extend(k,g),k.type=k.type||i,k.messages=[],d=f.find(".material-unit"),d.each(function(a){var d,e=b(this).data();return console.log(a),e.title?e.image?e.content||(d="%s正文不能为空"):(d="%s封面图片不能为空",6===i&&a>0&&(d="%s缩略图不能为空")):d="%s标题不能为空",d?(m=!1,d=d.replace("%s",5===i?"":"第"+(a+1)+"条消息的"),c.msg(d,4),!1):void k.messages.push(e)}),m&&b.ajax(k.url,{type:"POST",data:k,dataType:"json",beforeSend:function(){h.prop("disabled",!0).addClass("disabled")},success:function(a){0===a.errcode?(c.msg(a.errmsg,2),D=!0,K.removeMaterial(),K.destroy(),c.assign(a.returnurl||a.redirect)):(c.msg(a.errmsg,5),h.prop("disabled",!1).removeClass("disabled"))},complete:function(){}});break;case"reset":K.removeMaterial(),D=!0,a.location.reload()}}),b(a).on("beforeunload",function(){var a;return!D&&(a=K.setMaterial(),E)?a||"页面即将跳转……":void 0})}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.prepaid={},c.prepaid.home=function(){var a=b(".prepaid-home"),d=a.find(".we-form"),e=d.find(".form-start"),f=d.find(".prepaid-state"),g=f.data("prepaidState"),h=f.find(".prepaid-open"),i=f.find(".prepaid-close"),j=d.find(".prepaid-popover"),k=d.find(".form-input"),l=d.find(".prepaid-rule-list"),m=d.find(".prepaid-rule-template").text(),n=d.find(".prepaid-term"),o=d.find(".prepaid-restriction"),p=d.find(".form-output"),q=d.find(".form-output-template").text(),r={},s=function(){var a=!0;return l.find("input[type='number']").each(function(){var d,e=b(this),f=b.trim(e.val()),g=parseFloat(f,10)||0;return f?1>g?d="请输入大于1的整数":f%1>0&&(d="请输入整数"):d="请输入正整数金额",d?(this.focus(),c.msg(d,4),a=!1):void 0}),a},t=function(){var a=[],c=!0;return l.find(".prepaid-note").addClass("hide"),l.find(".prepaid-value").each(function(d){var e=b(this),f=parseInt(e.val(),10);d>0&&b.each(a,function(a,b){f==b&&(c=!1,e.parent().find(".prepaid-note").removeClass("hide"))}),a.push(f)}),c},u=function(){l.find("input").prop("disabled",!0),l.find("button").prop("disabled",!0).addClass("disabled"),n.find(".we-radio").addClass("disabled"),n.find(".form-control").prop("disabled",!0),d.find(".editor-input").prop("contenteditable",!1).addClass("disabled"),d.find("button[data-toggle='prepaid.save']").data("disabled",!0).text("修改")},v=function(){l.find("input").prop("disabled",!1),l.find("button").prop("disabled",!1).removeClass("disabled"),n.find(".we-radio").removeClass("disabled"),n.find(".form-control").prop("disabled",!1),d.find(".editor-input").prop("contenteditable",!0).removeClass("disabled"),d.find("button[data-toggle='prepaid.save']").data("disabled",!1).text("保存")};"open"===g?(h.find(".we-radio").radio("check"),i.removeClass("disabled").find(".we-radio").radio("uncheck").addClass("disabled"),j.removeClass("in"),k.removeClass("hide"),o.validate()):i.addClass("disabled"),f.find(".we-radio").on("checked.we.radio",function(a){var c=b(this),d=c.data("state");if("open"===d)j.collapse("hide"),k.removeClass("hide");else if("close"===d){if(!c.parent().hasClass("disabled"))return void a.preventDefault();j.collapse("show"),k.addClass("hide"),p.addClass("hide")}}),l.find(".prepaid-value").on("change",t),l.on("click","[data-toggle^='rule']",function(a){var c,d,e,f,g,h=b(this),i=h.data("toggle").replace("rule.","");a.preventDefault(),h.hasClass("disabled")||("add"===i?(c=b(m),c.find(".prepaid-value").on("change",t),l.append(c),h.addClass("hide"),h.siblings(".prepaid-del").removeClass("hide"),e=l.children(),e.length>=10&&e.last().find(".prepaid-add").addClass("hide")):"del"===i&&(d=h.closest("li"),f=d.prev(),g=d.next(),d.empty().remove(),g.length||f.find(".prepaid-add").removeClass("hide"),e=l.children(),e.length<2&&e.first().find(".prepaid-del").addClass("hide"),e.length<10&&e.last().find(".prepaid-add").removeClass("hide")))}),a.on("click","[data-toggle^='prepaid']",function(){var a=b(this),c=a.data(),d=c.toggle.replace("prepaid.","");if(!a.hasClass("disabled"))switch(d){case"save":if(a.data("disabled")){v();break}if(!(t()&&s()&&o.validate("validate")))return;r.rules=[],l.children().each(function(){var a=b(this);r.rules.push({prepaid:a.find(".prepaid-value").val(),present:a.find(".present-value").val()})}),r.term=function(){var a=n.find(":radio:checked"),b=Number(a.val()),c=[];return 0===b?c.push(0):1===b&&(c.push(1),c.push(a.siblings(".prepaid-term-count").val()),c.push(a.siblings(".prepaid-term-unit").find(":selected").text())),c}(),r.restriction=o.val(),p.empty().html(_.template(q,r)),e.addClass("hide"),k.addClass("hide"),p.removeClass("hide");break;case"cancel":e.removeClass("hide"),k.removeClass("hide"),p.addClass("hide")}}),c.textEditor(a),c.popoverConfirm({message:"确定关闭储值功能？",confirm:function(){var a=b(this),c=a.data();b.ajax(c.url,{async:!1,type:"POST",data:{close:!0},dataType:"json",success:function(a){0===a.errcode?location.reload():console.log(a.errmsg)}})}}),"open"===g&&u()}}(window,jQuery,WeLife),function(a,b,c){"use strict";var d=new Date,e=function(){return new Date(d.getFullYear(),d.getMonth(),d.getDate()-1)}(),f=function(){return e.valueOf()-new Date(d.getFullYear(),d.getMonth()-1,d.getDate()-1).valueOf()}(),g=function(){return e.valueOf()-new Date(d.getFullYear(),d.getMonth()-3,d.getDate()-1).valueOf()}();c.statistic={},c.statistic.common=function(){var a=b(".statistic-common");c.date(a,{customDateRange:f,endDate:e}),c.popoverNotice(a)},c.statistic.common.member=function(){var a=b(".statistic-common-member");c.date(a,{customDateRange:f,endDate:e}),c.popoverNotice(a)},c.statistic.common.spend=function(){var a=b(".statistic-common-spend");c.date(a,{customDateRange:f,endDate:e}),c.popoverNotice(a)},c.statistic.common.recharge=function(){var a=b(".statistic-common-recharge");c.date(a,{customDateRange:f,endDate:e}),c.popoverNotice(a)},c.statistic.market=function(){var a=b(".statistic-market"),d=a.find(".cost-percentage"),f=d.find(".percentage-input"),h=d.find(".percentage-submit"),i=a.find(".percentage-output"),j=a.find(".percentage-reserve"),k=a.find(".total-marketing-earning"),l=a.find(".chart-coupon-usage"),m=a.find(".chart-marketing-earning"),n=a.find(".table"),o=n.find("tbody > tr"),p=n.find(".we-checkbox"),q=a.find("#compare-btn"),r=!1,s=function(){var a=Math.abs(parseInt(f.val(),10))||0;a>100&&(a=a.toString().substr(0,2)),f.val(a),i.text(a),j.text(100-a)},t=function(){var a=Math.abs(parseInt(f.val(),10)/100)||0;o.each(function(){var c=b(this),d=c.data();b.isEmptyObject(d)||(d.marketingEarning=parseInt((d.spendValue+d.rechargeValue)*(1-a)-d.couponUsed*d.couponValue*a,10),c.data("marketingEarning",d.marketingEarning).find("[data-name='marketing-earning']").text(d.marketingEarning))}),clearTimeout(r),r=setTimeout(function(){v({couponUsage:!1})},200),k.text(function(){var d=b(this).data();return c.util.formatNumber(.6*(d.spendValue+d.rechargeValue)-d.couponUsed*d.couponValue*a,2)})},u=function(a){var b=p.filter(".checked").length<2;q.prop("disabled",b),b&&a&&c.msg("最少选2个",4)},v=function(a){var c,d,e={couponUsage:!0,marketingEarnings:!0},f=p.filter(".checked"),g=f.length;2>g||g>5||(a=b.extend(e,a),a.couponUsage&&(c=l.chart("getOptions"),c.xAxis[0].data=[],c.series[0].data=[],f.each(function(){var a=b(this).closest("tr").data();c.xAxis[0].data.push(a.name),c.series[0].data.push(parseFloat(a.couponUsage)||0)}),l.chart("setOptions",c)),a.marketingEarnings&&(d=m.chart("getOptions"),d.xAxis[0].data=[],d.series[0].data=[],f.each(function(){var a=b(this).closest("tr").data();d.xAxis[0].data.push(a.name),d.series[0].data.push(a.marketingEarning)}),m.chart("setOptions",d)))};c.date(a,{customDateRange:g,endDate:e}),u(),p.on("check.we.checkbox",function(a){p.filter(".checked").length>=5&&(c.msg("最多选5个",4),a.preventDefault())}),p.on("checked.we.checkbox unchecked.we.checkbox",u),q.on("click",function(){q.prop("disabled")||q.hasClass("disabled")||v()}),f.on("keyup blur",s),f.on("change",s),f.on("paste",function(){setTimeout(function(){s()},50)}),h.on("click",t)},c.statistic.market.detail=function(){var a=b(".statistic-market-detail");c.date(a,{customDateRange:g,endDate:e})},c.statistic.trade={},c.statistic.trade.spend=function(){var a=b(".statistic-trade-spend");c.date(a,{customDateRange:f,endDate:e}),c.exporter(a),c.popoverNotice(a)},c.statistic.trade.recharge=function(){var a=b(".statistic-trade-recharge");c.date(a,{customDateRange:f,endDate:e}),c.exporter(a)}}(window,jQuery,WeLife),function(a,b,c){"use strict";c.setting={},c.setting.account=function(){var d=b(".setting-account"),e=d.find(".account-disable-modal"),f=d.find(".account-reset-modal"),g=d.find(".account-reset-success-modal"),h=d.find(".account-conflict-modal");h.data("conflicted")&&h.modal({backdrop:!1,keyboard:!1}),d.on("click","[data-toggle^='account']",function(){var d=b(this),h=d.data(),i=h.toggle.replace("account.","");if(!d.hasClass("disabled"))switch(i){case"disable":e.data("ajaxData",h).modal();break;case"disable.confirm":h=e.data("ajaxData"),b.ajax(h.url,{type:"POST",data:{id:h.id},dataType:"json",success:function(b){0===b.errcode?(e.modal("hide"),a.location.reload()):c.msg(b.errmsg,5)}});break;case"reset":f.data("ajaxData",h).modal();break;case"reset.confirm":h=f.data("ajaxData"),b.ajax(h.url,{type:"POST",data:{id:h.id},dataType:"json",success:function(a){0===a.errcode?(f.modal("hide"),g.modal()):c.msg(a.errmsg,5)}})}}),require(["ZeroClipboard"],function(a){var b,e=d.find("#copyToClipboard"),f=e.data();b=new a(e.get(0)),b.on("ready",function(){b.on("aftercopy",function(){c.msg(f.copiedMessage,2)})})})},c.setting.account.create=function(){var a=b(".setting-account-create"),d=a.find(".we-form"),e=d.find("[data-section='role']"),f=e.find(".we-radio"),g=d.find("#inputName"),h=d.find("#inputPhone"),i=d.find("[data-section='shop']"),j=d.find("[data-section='right']"),k=i.find(".shop-toggle"),l=i.find(".shop-checked-ids"),m=i.find(".shop-checked-list"),n=function(){var a=l.val(),b=l.data("shop");return/all/i.test(a)&&(a="",b=""),[a,b]}(),o=function(a){i.is(":hidden")||(a?(k.addClass("hide").text(""),l.val("all").data("shop","全部门店"),m.html("<li>全部门店</li>")):(k.removeClass("hide").text("选择门店"),l.val(n[0]).data("shop",n[1]),m.html(n[1]?"<li>"+n[1]+"</li>":"")))},p=function(){var a=f.filter(".checked").data("role");switch(a){case 1:o(!0),j.addClass("hide");break;case 2:o(),j.addClass("hide");break;case 3:o(),j.removeClass("hide")}};p(),f.on("checked.we.radio",p),g.validate({rules:{name:""}}),h.validate({rules:{phone:""}}),c.shop(a),d.submitter({disableAfterDone:!0,isValidated:function(){return i.is(":visible")&&!i.find(".shop-checked-ids").val()?(c.msg("请选择门店",4),!1):g.validate("validate")&&h.validate("validate")},done:function(a){c.respond(a)}})},c.setting.membercard=function(){},c.setting.membercard.modify=function(){function a(){return s.find(".js-uploaded-id").val()?!0:(c.showError(s,"请上传卡面 logo"),!1)}function d(){return t.find(".js-uploaded-id").val()?!0:(c.showError(t,"请上传通用 logo"),!1)}function e(){return u.find(".js-uploaded-id").val()?!0:(c.showError(u,"请上传自定义卡"),!1)}function f(){return v.find(".js-uploaded-id").val()?!0:(c.showError(v,"请上传自定义卡背景图"),!1)}function g(){return w.find(".js-uploaded-id").val()?!0:(c.showError(w,"请上传自定义卡通用 logo"),!1)}var h,i,j=b(".setting-membercard-modify"),k=j.find(".we-form"),l=k.find("[data-section='type']"),m=l.find(".we-radio"),n=l.find(".card-style-toggle"),o=l.find(".load-card-template"),p=k.find("[data-section='style']"),q=k.find("[data-section='name']"),r=q.find(".we-radio"),s=k.find("[data-section='logo.face']"),t=k.find("[data-section='logo.base']"),u=k.find("[data-section='face']"),v=k.find("[data-section='back']"),w=k.find("[data-section='logo']"),x=k.find("[data-section='color']"),y=function(){switch(h=m.filter(".checked").data("type")){case 1:n.removeClass("hide"),o.addClass("hide"),p.removeClass("hide"),q.removeClass("hide"),u.addClass("hide"),v.addClass("hide"),w.addClass("hide"),x.addClass("hide"),z();break;case 2:n.addClass("hide"),o.removeClass("hide"),p.addClass("hide"),q.addClass("hide"),s.addClass("hide"),t.addClass("hide"),u.removeClass("hide"),v.removeClass("hide"),w.removeClass("hide"),x.removeClass("hide")}},z=function(){switch(i=r.filter(".checked").data("type")){case 1:s.addClass("hide"),t.addClass("hide");break;case 2:s.removeClass("hide"),t.removeClass("hide")}};y(),m.on("checked.we.radio",y),r.on("checked.we.radio",z),c.cardSelector(j),c.colorSelector(j),j.find(".we-uploader").each(function(){var a=b(this),d=a.closest(".form-group");c.uploader(a,{namespace:"."+d.data("section")}),c.popoverNotice(d)}),k.submitter({disableAfterDone:!0,isValidated:function(){var b=!0;return 2===h?b=e()&&f()&&g():2===i&&(b=a()&&d()),b},done:function(a){c.respond(a)}})},c.setting.autoreply=function(){c.popoverConfirm({message:"确定删除该关键词？",confirm:function(){var a=b(this),d=a.data();b.ajax(d.url,{async:!1,type:"POST",data:{id:d.id},dataType:"json",success:function(b){0===b.errcode?a.closest("tr").addClass("hide"):c.msg(b.errmsg,5)}})}})},c.setting.autoreply.create=function(){function a(){return g.val()?"true"!==h.prop("contenteditable")||h.data("valid")?!0:(c.msg("回复内容字数超出限制",4),!1):(c.msg("回复内容不能为空",4),!1)}var d=b(".setting-autoreply-create"),e=d.find("form"),f=e.find("#inputName"),g=e.find(".input-content"),h=e.find(".editor-input"),i=e.find(".keyword-list");c.keywordEditor(d),c.messageEditor(d),f.on("change blur",function(){f.val(b.trim(f.val()))
}),e.submitter({disableAfterDone:!0,isValidated:function(){return i.find("li").length?a():(c.msg(c.MESSAGES.keyword,4),!1)},done:function(a){c.respond(a)}})},c.setting.code2d=function(){var a=b(".setting-code2d"),d=a.find(".code-delete-modal");a.on("click","[data-toggle^='code']",function(){var a=b(this),e=a.data(),f=e.toggle.replace("code.","");if(!a.hasClass("disabled"))switch(f){case"delete":d.find("[data-toggle='code.delete.confirm']").data("code",e),d.modal("show");break;case"delete.confirm":e=a.data("code"),b.ajax(e.url,{async:!1,type:"POST",data:{id:e.id},dataType:"json",success:function(a){c.respond(a,{success:function(){d.modal("hide"),c.reload()}})}})}})},c.setting.code2d.create=function(){var a=b(".setting-code2d-create"),d=a.find("form"),e=d.find(".code-data"),f=d.find(".code-list"),g={code:"",shopOnly:!1,shopId:"",shopName:"",readonly:!1},h=e.val(),i=_.template(d.find(".code-list-template").text()),j=function(a){var d,e,g="";b.isArray(a)?(e=a.length,b.each(a,function(a,b){b.index=a,b.length=e,g+=i(b)})):b.isPlainObject(a)&&(e=f.children().length,a.index=e,a.length=e+1,g=i(a)),d=b(g),d.each(function(){var a=b(this);a.find(".we-checkbox").on("checked.we.checkbox",function(){b(this).siblings(".we-shop-container").removeClass("hide")}).on("unchecked.we.checkbox",function(){b(this).siblings(".we-shop-container").addClass("hide")}),c.shop(a)}),f.append(d),e=f.children().length,e>1&&f.find(".input-code-del").first().removeClass("hide")},k=function(a){var c=[];b.isArray(a)&&(b.each(a,function(a,b){c.push({code:b.name,shopOnly:!0,shopId:b.id,shopName:b.name,readonly:!0})}),j(c))},l=function(){var a,d=f.find("> li > .input-code-name"),e=!0;return d.each(function(c,e){var f=b(this),g=f.val(),h=!1;return!f.prop("readonly")&&(d.each(function(d){var f=b(this);return this!==e&&f.val()===g?(h=!0,a="第 "+(d+1)+" 条二维码的名称与第 "+(c+1)+" 条二维码的名称重复，请修改后重试！",f.focus(),!1):void 0}),h)?!1:void 0}),a&&(e=!1,c.msg(a,4)),e},m=function(){var a=[];f.children().each(function(){var c=b(this),d=c.find(".input-code-name"),e=c.find(".input-code-shop-only"),f=c.find(".input-code-shop-id");a.push({code:d.val(),shopOnly:e.prop("checked"),shopId:f.val(),shopName:f.data("shop"),readonly:d.prop("readonly")})});try{e.val(JSON.stringify(a))}catch(c){console.log(c.message)}};j(function(a){try{a=b.parseJSON(a)}catch(c){a=null,console.log(c)}return a||(a=b.extend({},g)),a}(h)),a.on("click","[data-toggle^='code']",function(){var a=b(this),d=a.data(),e=d.toggle.replace("code.","");if(!a.hasClass("disabled"))switch(e){case"add":a.addClass("hide"),d=b.extend({},g),j(d);break;case"bulk":a.addClass("hide"),f.find(".input-code-add").last().addClass("hide"),c.shop.data?k(c.shop.data):b.ajax(d.url,{data:d,dataType:"json",success:function(a){0===a.errcode?(c.shop.data=a.result,k(a.result)):console.log(a.errmsg)}})}}),c.popoverConfirm({message:"确定要删除么？",confirm:function(){b(this).closest(".code-item").empty().remove(),f.find(".input-code-add").last().removeClass("hide"),1===f.children().length&&f.find(".input-code-del").first().addClass("hide")}}),d.submitter({isValidated:function(){return l()?(m(),!0):!1},done:function(a){c.respond(a)}})},c.setting.code2d.detail=function(){var a=b(".setting-code2d-detail"),d=a.find(".download-modal"),e=a.find(".code-delete-modal"),f=d.find("table a");a.on("click","[data-toggle^='code']",function(){var a=b(this),g=a.data(),h=g.toggle.replace("code.","");if(!a.hasClass("disabled"))switch(h){case"more":f.each(function(){var a=b(this),c=[];b.each(a.data(),function(a,b){c.push(a+"="+b)}),a.attr("href",g.url+(c.length?"?"+c.join("&"):""))}),d.modal("show");break;case"delete":e.find("[data-toggle='code.delete.confirm']").data("code",g),e.modal("show");break;case"delete.confirm":g=a.data("code"),b.ajax(g.url,{async:!1,type:"POST",data:{id:g.id},dataType:"json",success:function(a){c.respond(a,{success:function(){e.modal("hide"),c.reload()}})}})}})},c.setting.template=function(){var a=b(".setting-template"),d=a.find("form");d.submitter({done:function(a){c.respond(a)}})},c.setting.wechat=function(){var a=b(".setting-wechat"),d=a.find("form");d.submitter({disableAfterDone:!0,done:function(a){c.respond(a,{success:function(){c.reload()}})}}),require(["ZeroClipboard"],function(d){a.find(".copy-to-clipboard").each(function(){var a=b(this).data(),e=new d(this);e.on("ready",function(){e.on("aftercopy",function(){c.msg(a.copiedMessage,2)})})})})}}(window,jQuery,WeLife);